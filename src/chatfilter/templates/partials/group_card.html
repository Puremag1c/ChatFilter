<div class="group-card" id="group-{{ group.id }}">
    <h3>{{ group.name }}</h3>

    <span class="status-badge {{ group.status.value }}">{{ group.status.value }}</span>

    <div class="group-stats">
        <div class="stat-row">
            <span>{{ _("Total chats") }}:</span>
            <strong>{{ stats.total }}</strong>
        </div>
        <div class="stat-row">
            <span>{{ _("Analyzed") }}:</span>
            <strong>{{ stats.analyzed }} / {{ stats.total }}</strong>
        </div>
        <div class="stat-row">
            <span>{{ _("Failed") }}:</span>
            <strong>{{ stats.failed }}</strong>
        </div>
    </div>

    <!-- Progress bar -->
    <div class="progress-bar">
        {% set progress_pct = (stats.analyzed / stats.total * 100) if stats.total > 0 else 0 %}
        <div class="progress-fill" style="width: {{ progress_pct }}%"></div>
    </div>

    <!-- Type breakdown -->
    <div class="type-breakdown">
        {% if stats.pending > 0 %}
        <span class="type-badge pending">{{ _("Pending") }}: {{ stats.pending }}</span>
        {% endif %}
        {% if stats.groups > 0 %}
        <span class="type-badge group">{{ _("Groups") }}: {{ stats.groups }}</span>
        {% endif %}
        {% if stats.forums > 0 %}
        <span class="type-badge forum">{{ _("Forums") }}: {{ stats.forums }}</span>
        {% endif %}
        {% if stats.channels_with_comments > 0 %}
        <span class="type-badge channel-comments">{{ _("Channels+") }}: {{ stats.channels_with_comments }}</span>
        {% endif %}
        {% if stats.channels_no_comments > 0 %}
        <span class="type-badge channel-no-comments">{{ _("Channels") }}: {{ stats.channels_no_comments }}</span>
        {% endif %}
        {% if stats.dead > 0 %}
        <span class="type-badge dead">{{ _("Dead") }}: {{ stats.dead }}</span>
        {% endif %}
        {% if stats.skipped_moderation > 0 %}
        <span class="type-badge dead" title="{{ _('These chats require approval to join. Metrics requiring join are N/A') }}">{{ _("Skipped (moderation)") }}: {{ stats.skipped_moderation }}</span>
        {% endif %}
    </div>

    <!-- Action buttons -->
    <div class="group-actions">
        <button class="btn btn-secondary btn-sm"
                hx-get="/api/groups/modal/settings/{{ group.id }}"
                hx-target="#modal-container"
                hx-swap="innerHTML">
            {{ _("Configure analysis") }}
        </button>

        {% if group.status.value == 'in_progress' %}
        <button class="btn btn-warning btn-sm"
                hx-post="/api/groups/{{ group.id }}/stop"
                hx-swap="none">
            {{ _("Stop analysis") }}
        </button>
        {% elif group.status.value == 'completed' %}
        <button class="btn btn-outline-secondary btn-sm"
                hx-post="/api/groups/{{ group.id }}/reanalyze?mode=increment"
                hx-swap="none">
            {{ _("Дополнить анализ") }}
        </button>
        <button class="btn btn-warning btn-sm"
                hx-get="/api/groups/modal/reanalyze-confirm/{{ group.id }}"
                hx-target="#modal-container"
                hx-swap="innerHTML">
            {{ _("Перезапустить анализ") }}
        </button>
        {% else %}
        <button class="btn btn-primary btn-sm"
                hx-post="/api/groups/{{ group.id }}/start"
                hx-swap="none">
            {{ _("Start analysis") }}
        </button>
        {% endif %}

        {% if stats.analyzed > 0 %}
        <button class="btn btn-success btn-sm"
                hx-get="/api/groups/{{ group.id }}/export/modal"
                hx-target="#modal-container"
                hx-swap="innerHTML">
            {{ _("Download results") }}
        </button>
        {% endif %}

        <button class="btn btn-danger btn-sm"
                hx-delete="/api/groups/{{ group.id }}"
                hx-swap="none"
                hx-confirm="{{ _('Delete group? This cannot be undone.') }}">
            {{ _("Delete") }}
        </button>
    </div>

    {% if error_message %}
    <script>
        ToastManager.error('{{ error_message | replace("'", "\\'") }}', {
            title: 'Cannot Start Analysis',
            duration: 8000
        });
    </script>
    {% endif %}
</div>
