{% if proxies %}
<div class="proxy-pool-table-container">
    <table class="proxy-pool-table" role="table" aria-label="{{ _("Proxy servers list") }}">
        <thead>
            <tr>
                <th scope="col">{{ _("Status") }}</th>
                <th scope="col">{{ _("Name") }}</th>
                <th scope="col">{{ _("Type") }}</th>
                <th scope="col">{{ _("Address") }}</th>
                <th scope="col">{{ _("Auth") }}</th>
                <th scope="col">{{ _("Sessions") }}</th>
                <th scope="col">{{ _("Actions") }}</th>
            </tr>
        </thead>
        <tbody>
            {% for proxy in proxies %}
            <tr id="proxy-row-{{ proxy.id }}" class="{% if not proxy.is_available %}proxy-disabled{% endif %}">
                <td data-label="{{ _("Status") }}">
                    {% if proxy.status == 'working' %}
                    <span class="proxy-status-badge proxy-status-working" title="{{ _("Working - last checked") }}: {{ proxy.last_ping_at.strftime('%H:%M') if proxy.last_ping_at else _('Never') }}">
                        <span class="status-icon">&#x1F7E2;</span>
                        <span class="status-text">{{ _("Working") }}</span>
                    </span>
                    {% elif proxy.status == 'no_ping' %}
                    <span class="proxy-status-badge proxy-status-no-ping" title="{{ _("Failed") }}: {{ proxy.consecutive_failures }}x {{ _("consecutive failures") }}">
                        <span class="status-icon">&#x1F534;</span>
                        <span class="status-text">{{ _("No ping") }}</span>
                    </span>
                    {% else %}
                    <span class="proxy-status-badge proxy-status-untested" title="{{ _("Not yet tested") }}">
                        <span class="status-icon">&#x26AA;</span>
                        <span class="status-text">{{ _("Untested") }}</span>
                    </span>
                    {% endif %}
                </td>
                <td data-label="{{ _("Name") }}">
                    <span class="proxy-name">{{ proxy.name }}</span>
                </td>
                <td data-label="{{ _("Type") }}">
                    <span class="proxy-type-badge proxy-type-{{ proxy.type }}">{{ proxy.type | upper }}</span>
                </td>
                <td data-label="{{ _("Address") }}">
                    <code class="proxy-address">{{ proxy.host }}:{{ proxy.port }}</code>
                </td>
                <td data-label="{{ _("Auth") }}">
                    {% if proxy.has_auth %}
                    <span class="auth-badge auth-yes" title="{{ _("Authentication required") }}">
                        <span class="auth-icon">&#x1F510;</span>
                        <span class="auth-text">{{ proxy.username }}</span>
                    </span>
                    {% else %}
                    <span class="auth-badge auth-no" title="{{ _("No authentication") }}">
                        <span class="auth-icon">&#x1F513;</span>
                        <span class="auth-text">{{ _("None") }}</span>
                    </span>
                    {% endif %}
                </td>
                <td data-label="{{ _("Sessions") }}">
                    <span class="usage-count {% if proxy.usage_count > 0 %}usage-active{% endif %}">
                        {{ proxy.usage_count }}
                    </span>
                </td>
                <td data-label="{{ _("Actions") }}">
                    <div class="proxy-actions">
                        <button class="btn btn-sm btn-secondary proxy-retest-btn"
                                data-proxy-id="{{ proxy.id }}"
                                data-proxy-name="{{ proxy.name }}"
                                hx-post="/api/proxies/{{ proxy.id }}/retest"
                                hx-swap="none"
                                hx-on::after-request="htmx.trigger('#proxy-list', 'refresh')"
                                hx-indicator="#proxy-retest-spinner-{{ proxy.id }}"
                                title="{{ _("Test proxy connection") }}"
                                aria-label="{{ _('Retest proxy') }} {{ proxy.name }}">
                            <span class="btn-text">{{ _("Test") }}</span>
                            <span id="proxy-retest-spinner-{{ proxy.id }}" class="htmx-indicator spinner-small"></span>
                        </button>
                        <button class="btn btn-sm btn-secondary proxy-edit-btn"
                                data-proxy-id="{{ proxy.id }}"
                                data-proxy-name="{{ proxy.name }}"
                                data-proxy-type="{{ proxy.type }}"
                                data-proxy-host="{{ proxy.host }}"
                                data-proxy-port="{{ proxy.port }}"
                                data-proxy-username="{{ proxy.username }}"
                                title="{{ _("Edit this proxy") }}"
                                aria-label="{{ _('Edit proxy') }} {{ proxy.name }}">
                            {{ _("Edit") }}
                        </button>
                        <button class="btn btn-sm btn-danger proxy-delete-btn"
                                data-proxy-id="{{ proxy.id }}"
                                data-proxy-name="{{ proxy.name }}"
                                data-proxy-usage-count="{{ proxy.usage_count }}"
                                title="{{ _("Delete this proxy") }}"
                                aria-label="{{ _('Delete proxy') }} {{ proxy.name }}">
                            {{ _("Delete") }}
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state">
    <div class="empty-state-icon">&#x1F310;</div>
    <h3>{{ _("No Proxies Configured") }}</h3>
    <p>{{ _("Add a proxy server to route Telegram connections through it.") }}</p>
</div>
{% endif %}
