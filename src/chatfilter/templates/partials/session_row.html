{# Single session row partial #}
{# Receives: session (with session_id, state, error_message) #}
<tr id="session-{{ session.session_id }}" class="account-row">
    <td class="account-name-cell">
        <span class="account-name">{{ session.session_id }}</span>
    </td>
    <td class="account-status-cell">
        <span class="account-status status-{{ session.state }}"{% if session.error_message %} title="{{ session.error_message }}"{% endif %}>
            {%- if session.state == 'disconnected' -%}
                <span class="status-icon" aria-hidden="true">‚úì</span>
                {{ _("Ready") }}
            {%- elif session.state == 'connected' -%}
                <span class="status-icon" aria-hidden="true">‚óè</span>
                {{ _("Connected") }}
            {%- elif session.state == 'connecting' -%}
                <span class="status-icon spinner-small" aria-hidden="true"></span>
                {{ _("Connecting") }}
            {%- elif session.state == 'disconnecting' -%}
                <span class="status-icon spinner-small" aria-hidden="true"></span>
                {{ _("Disconnecting") }}
            {%- elif session.state == 'banned' -%}
                <span class="status-icon" aria-hidden="true">‚õî</span>
                {{ _("Banned") }}
            {%- elif session.state == 'flood_wait' -%}
                <span class="status-icon" aria-hidden="true">‚è≥</span>
                {{ _("Flood Wait") }}
            {%- elif session.state == 'proxy_error' -%}
                <span class="status-icon" aria-hidden="true">üîå</span>
                {{ _("Proxy Error") }}
            {%- elif session.state == 'not_configured' -%}
                <span class="status-icon" aria-hidden="true">‚ö†</span>
                {{ _("Not configured") }}
            {%- elif session.state == 'proxy_missing' -%}
                <span class="status-icon" aria-hidden="true">‚úó</span>
                {{ _("Proxy missing") }}
            {%- elif session.state == 'error' -%}
                <span class="status-icon" aria-hidden="true">‚úó</span>
                {{ _("Error") }}
            {%- else -%}
                <span class="status-icon" aria-hidden="true">?</span>
                {{ session.state }}
            {%- endif -%}
        </span>
    </td>
    <td class="account-actions-cell">
        <div class="account-actions">
            {# Connection button #}
            <div class="session-connection-btn-wrapper" id="session-connection-{{ session.session_id }}">
                {% if session.state == 'connected' %}
                <button class="btn btn-sm btn-warning session-disconnect-btn"
                        hx-post="/api/sessions/{{ session.session_id }}/disconnect"
                        hx-target="#session-{{ session.session_id }}"
                        hx-swap="outerHTML"
                        hx-indicator="#connection-spinner-{{ session.session_id }}"
                        aria-label="{{ _('Disconnect session') }}">
                    <span class="btn-text">{{ _("Disconnect") }}</span>
                    <span id="connection-spinner-{{ session.session_id }}" class="htmx-indicator spinner"></span>
                </button>
                {% elif session.state == 'disconnected' %}
                <button class="btn btn-sm btn-success session-connect-btn"
                        hx-post="/api/sessions/{{ session.session_id }}/connect"
                        hx-target="#session-{{ session.session_id }}"
                        hx-swap="outerHTML"
                        hx-indicator="#connection-spinner-{{ session.session_id }}"
                        aria-label="{{ _('Connect session') }}">
                    <span class="btn-text">{{ _("Connect") }}</span>
                    <span id="connection-spinner-{{ session.session_id }}" class="htmx-indicator spinner"></span>
                </button>
                {% elif session.state == 'connecting' or session.state == 'disconnecting' %}
                {# Operation in progress - show disabled button #}
                <button class="btn btn-sm btn-secondary session-connect-btn" disabled
                        aria-label="{{ _('Please wait') }}">
                    <span class="btn-text">{{ _("Wait...") }}</span>
                    <span class="spinner"></span>
                </button>
                {% elif session.state in ['error', 'proxy_error', 'flood_wait'] %}
                {# Error states that can be retried #}
                <button class="btn btn-sm btn-danger session-connect-btn"
                        hx-post="/api/sessions/{{ session.session_id }}/connect"
                        hx-target="#session-{{ session.session_id }}"
                        hx-swap="outerHTML"
                        hx-indicator="#connection-spinner-{{ session.session_id }}"
                        aria-label="{{ _('Retry connection') }}"
                        title="{{ session.error_message or _('Connection error') }}">
                    <span class="btn-text">{{ _("Retry") }}</span>
                    <span id="connection-spinner-{{ session.session_id }}" class="htmx-indicator spinner"></span>
                </button>
                {% elif session.state == 'needs_api_id' %}
                {# Needs API credentials - show configure button #}
                <button class="btn btn-sm btn-warning session-connect-btn" disabled
                        aria-label="{{ _('Configure API credentials') }}"
                        title="{{ _('Please configure API ID and hash in Edit section') }}">
                    <span class="btn-text">{{ _("Configure") }}</span>
                </button>
                {% elif session.state == 'needs_code' %}
                {# Waiting for verification code - disabled, auth flow in progress #}
                <button class="btn btn-sm btn-info session-connect-btn" disabled
                        aria-label="{{ _('Waiting for code') }}"
                        title="{{ _('Please enter the verification code in auth modal') }}">
                    <span class="btn-text">{{ _("Enter Code") }}</span>
                </button>
                {% elif session.state == 'needs_2fa' %}
                {# Waiting for 2FA - disabled, auth flow in progress #}
                <button class="btn btn-sm btn-info session-connect-btn" disabled
                        aria-label="{{ _('Waiting for 2FA') }}"
                        title="{{ _('Please enter 2FA password in auth modal') }}">
                    <span class="btn-text">{{ _("Enter 2FA") }}</span>
                </button>
                {% elif session.state == 'banned' %}
                {# Banned - cannot retry, account issue #}
                <button class="btn btn-sm btn-danger session-connect-btn" disabled
                        aria-label="{{ _('Account banned') }}"
                        title="{{ session.error_message or _('This account has been banned by Telegram') }}">
                    <span class="btn-text">{{ _("Banned") }}</span>
                </button>
                {% else %}
                {# proxy_missing or unknown - disabled #}
                <button class="btn btn-sm btn-secondary session-connect-btn" disabled
                        aria-label="{{ _('Not configured') }}"
                        title="{{ _('Configure session first') }}">
                    <span class="btn-text">{{ _("Connect") }}</span>
                </button>
                {% endif %}
            </div>
            <button class="btn btn-sm btn-secondary session-config-btn"
                    data-session-id="{{ session.session_id }}"
                    hx-get="/api/sessions/{{ session.session_id }}/config"
                    hx-target="#session-config-{{ session.session_id }}"
                    hx-swap="innerHTML"
                    aria-label="{{ _('Configure account') }}"
                    aria-expanded="false"
                    aria-controls="session-config-{{ session.session_id }}">
                {{ _("Edit") }}
            </button>
            <button class="btn btn-sm btn-danger session-delete-btn"
                    data-session-id="{{ session.session_id }}"
                    data-lock="session:{{ session.session_id }}:delete"
                    aria-label="{{ _('Delete account') }}">
                {{ _("Delete") }}
            </button>
        </div>
    </td>
</tr>
<tr class="config-row" id="session-config-row-{{ session.session_id }}" style="display: none;">
    <td colspan="3">
        <div class="session-config-panel" id="session-config-{{ session.session_id }}"></div>
    </td>
</tr>
