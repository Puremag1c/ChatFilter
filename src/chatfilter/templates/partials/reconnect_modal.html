{# Reconnect Modal for Expired Sessions #}
<div id="reconnect-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="reconnect-modal-title">
    <div class="modal-dialog" role="document">
        <div class="modal-header">
            <span class="modal-icon warning" aria-hidden="true">ðŸ”‘</span>
            <h2 class="modal-title" id="reconnect-modal-title">{{ _("Reconnect Session") }}</h2>
            <button class="modal-close" onclick="document.getElementById('reconnect-modal').remove()" aria-label="{{ _('Close') }}">Ã—</button>
        </div>

        <div class="modal-body">
            <p class="modal-description">
                {{ _("Your session has expired and needs to be re-authenticated. A verification code will be sent to your phone.") }}
            </p>

            <form id="reconnect-form"
                  hx-post="/api/sessions/{{ session_id }}/send-code"
                  hx-target="#reconnect-result"
                  hx-swap="innerHTML"
                  hx-indicator="#reconnect-spinner">

                <div class="form-group">
                    <label for="reconnect-session-id">{{ _("Session ID") }}</label>
                    <input type="text"
                           id="reconnect-session-id"
                           value="{{ session_id }}"
                           disabled
                           class="form-control-plaintext"
                           readonly>
                </div>

                <div class="form-group">
                    <label for="reconnect-phone">{{ _("Phone Number") }}</label>
                    <input type="text"
                           id="reconnect-phone"
                           value="{{ phone }}"
                           disabled
                           class="form-control-plaintext"
                           readonly>
                    <small class="form-hint">{{ _("The verification code will be sent to this number") }}</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="reconnect-api-id"
                               data-tooltip="{{ _('Your Telegram API ID from my.telegram.org') }}"
                               data-tooltip-position="right">{{ _("API ID") }}</label>
                        <input type="number"
                               id="reconnect-api-id"
                               name="api_id"
                               required
                               value="{{ current_api_id or '' }}"
                               placeholder="{{ _('e.g., 12345678') }}"
                               min="1"
                               aria-describedby="reconnect-api-id-hint"
                               aria-required="true">
                        <small id="reconnect-api-id-hint" class="form-hint">{{ _("Numeric ID from my.telegram.org/apps") }}</small>
                    </div>

                    <div class="form-group">
                        <label for="reconnect-api-hash"
                               data-tooltip="{{ _('Your Telegram API Hash from my.telegram.org') }}"
                               data-tooltip-position="right">{{ _("API Hash") }}</label>
                        <input type="text"
                               id="reconnect-api-hash"
                               name="api_hash"
                               required
                               value="{{ current_api_hash or '' }}"
                               placeholder="{{ _('e.g., 0123456789abcdef...') }}"
                               pattern="[a-fA-F0-9]+"
                               minlength="32"
                               maxlength="32"
                               aria-describedby="reconnect-api-hash-hint"
                               aria-required="true">
                        <small id="reconnect-api-hash-hint" class="form-hint">{{ _("32-character hex string from my.telegram.org/apps") }}</small>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('reconnect-modal').remove()">
                        {{ _("Cancel") }}
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">{{ _("Send Code") }}</span>
                        <span id="reconnect-spinner" class="htmx-indicator spinner"></span>
                    </button>
                </div>
            </form>

            <div id="reconnect-result" role="region" aria-live="polite" aria-atomic="true"></div>
        </div>
    </div>
</div>

<script>
// Close modal on background click
document.getElementById('reconnect-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        this.remove();
    }
});

// Close modal on Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const modal = document.getElementById('reconnect-modal');
        if (modal) modal.remove();
    }
});
</script>
