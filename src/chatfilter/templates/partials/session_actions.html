{# Session action buttons partial - can be rendered independently for loading states #}
<div class="account-actions">
    {# Connection button #}
    <div class="session-connection-btn-wrapper" id="session-connection-{{ session.session_id }}">
        {% if session.state == 'connected' %}
        <button class="btn btn-sm btn-warning session-disconnect-btn"
                hx-post="/api/sessions/{{ session.session_id }}/disconnect"
                hx-target="#session-{{ session.session_id }}"
                hx-swap="outerHTML"
                hx-disabled-elt="this"
                onclick="this.disabled=true"
                aria-label="{{ _('Disconnect session') }}">
            {{ _("Disconnect") }}
        </button>
        {% elif session.state == 'disconnected' %}
        <button class="btn btn-sm btn-success session-connect-btn"
                hx-post="/api/sessions/{{ session.session_id }}/connect"
                hx-target="#session-{{ session.session_id }}"
                hx-swap="outerHTML"
                hx-disabled-elt="this"
                onclick="this.disabled=true"
                aria-label="{{ _('Connect session') }}">
            {{ _("Connect") }}
        </button>
        {% elif session.state == 'connecting' or session.state == 'disconnecting' %}
        {# Operation in progress - show disabled button #}
        <button class="btn btn-sm btn-secondary session-connect-btn" disabled
                aria-label="{{ _('Please wait') }}">
            <span class="btn-text">{{ _("Wait...") }}</span>
            <span class="spinner"></span>
        </button>
        {% elif session.state == 'corrupted_session' %}
        {# Corrupted session - show message, user must delete #}
        <button class="btn btn-sm btn-danger session-connect-btn" disabled
                aria-label="{{ _('Session corrupted') }}"
                title="{{ session.error_message or _('Session file is corrupted. Please delete and recreate.') }}">
            <span class="btn-text">{{ _("Corrupted") }}</span>
        </button>
        {% elif session.state in ['error', 'flood_wait'] %}
        {# Error states that can be retried #}
        <button class="btn btn-sm btn-danger session-connect-btn"
                hx-post="/api/sessions/{{ session.session_id }}/connect"
                hx-target="#session-{{ session.session_id }}"
                hx-swap="outerHTML"
                hx-disabled-elt="this"
                onclick="this.disabled=true"
                aria-label="{{ _('Retry connection') }}"
                title="{{ session.error_message or _('Connection error') }}">
            {{ _("Retry") }}
        </button>
        {% elif session.state in ['needs_api_id', 'proxy_error', 'proxy_missing'] %}
        {# Configuration needed - open config panel via Edit action #}
        <button class="btn btn-sm btn-warning session-config-btn"
                data-session-id="{{ session.session_id }}"
                hx-get="/api/sessions/{{ session.session_id }}/config"
                hx-target="#session-config-{{ session.session_id }}"
                hx-swap="innerHTML"
                hx-disabled-elt="this"
                onclick="this.disabled=true"
                aria-label="{{ _('Configure account') }}"
                aria-expanded="false"
                aria-controls="session-config-{{ session.session_id }}"
                {% if session.error_message %}title="{{ session.error_message }}"{% endif %}>
            {{ _("Edit") }}
        </button>
        {% elif session.state == 'needs_code' %}
        {# Verification code required #}
        <button class="btn btn-sm {% if session.error_message %}btn-warning{% else %}btn-info{% endif %} session-code-modal-btn"
                data-session-id="{{ session.session_id }}"
                {% if session.auth_id %}data-auth-id="{{ session.auth_id }}"{% endif %}
                {% if session.error_message %}title="{{ session.error_message }}"{% endif %}
                aria-label="{{ _('Enter verification code') }}">
            <span class="btn-text">
                {%- if session.error_message -%}
                    {{ _("Retry Verification") }}
                {%- else -%}
                    {{ _("Enter Verification Code") }}
                {%- endif -%}
            </span>
            <span class="spinner" style="display: none;"></span>
        </button>
        {% elif session.state == 'needs_2fa' %}
        {# 2FA password required #}
        <button class="btn btn-sm {% if session.error_message %}btn-warning{% else %}btn-info{% endif %} session-2fa-modal-btn"
                data-session-id="{{ session.session_id }}"
                {% if session.auth_id %}data-auth-id="{{ session.auth_id }}"{% endif %}
                {% if session.error_message %}title="{{ session.error_message }}"{% endif %}
                aria-label="{{ _('Enter 2FA password') }}">
            <span class="btn-text">
                {%- if session.error_message -%}
                    {{ _("Retry 2FA") }}
                {%- else -%}
                    {{ _("Enter 2FA Password") }}
                {%- endif -%}
            </span>
            <span class="spinner" style="display: none;"></span>
        </button>
        {% elif session.state == 'banned' %}
        {# Banned - cannot retry, account issue #}
        <button class="btn btn-sm btn-danger session-connect-btn" disabled
                aria-label="{{ _('Account banned') }}"
                title="{{ session.error_message or _('This account has been banned by Telegram') }}">
            <span class="btn-text">{{ _("Banned") }}</span>
        </button>
        {% else %}
        {# Unknown state - disabled #}
        <button class="btn btn-sm btn-secondary session-connect-btn" disabled
                aria-label="{{ _('Unknown state') }}"
                title="{{ _('Unknown session state') }}">
            <span class="btn-text">{{ _("Wait...") }}</span>
        </button>
        {% endif %}
    </div>
    <button class="btn btn-sm btn-secondary session-config-btn"
            data-session-id="{{ session.session_id }}"
            hx-get="/api/sessions/{{ session.session_id }}/config"
            hx-target="#session-config-{{ session.session_id }}"
            hx-swap="innerHTML"
            hx-disabled-elt="this"
                onclick="this.disabled=true"
            aria-label="{{ _('Configure account') }}"
            aria-expanded="false"
            aria-controls="session-config-{{ session.session_id }}">
        {{ _("Edit") }}
    </button>
    <button class="btn btn-sm btn-danger session-delete-btn"
            data-session-id="{{ session.session_id }}"
            data-lock="session:{{ session.session_id }}:delete"
            aria-label="{{ _('Delete account') }}">
        {{ _("Delete") }}
    </button>
</div>
