============================= test session starts ==============================
platform darwin -- Python 3.12.11, pytest-9.0.2, pluggy-1.6.0 -- /Users/m/Zen/Code/ChatFilter/.venv/bin/python
cachedir: .pytest_cache
hypothesis profile 'default'
rootdir: /Users/m/Zen/Code/ChatFilter
configfile: pyproject.toml
testpaths: tests
plugins: anyio-4.12.1, timeout-2.4.0, asyncio-1.3.0, hypothesis-6.151.5
timeout: 30.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 1954 items

<Dir ChatFilter>
  <Package tests>
    <Package integration>
      <Module test_auth_flow_fixes.py>
        Integration tests for auth flow fixes (Bug1, Bug2, Bug3).
        
        Test Scenarios:
        1. Code -> 2FA transition: verify-code with 2FA returns needs_2fa row with button
        2. 2FA -> Connected: verify-2fa success returns connected session_row
        3. Language switch: EN->RU translates nav menu
        4. Full flow: verify-code needs_2fa -> verify-2fa connected (no page refresh)
        <Class TestVerifyCodeNeeds2FA>
          Test 1: verify-code with SessionPasswordNeededError returns needs_2fa row.
          
          Bug1 fix: verify-code on needs_2fa returns <tr> with needs_2fa state,
          not a <div> form.
          <Function test_verify_code_returns_session_row_on_needs_2fa>
            verify-code with 2FA required returns <tr> with needs_2fa state and 2FA button.
        <Class TestVerify2FASuccess>
          Test 2: verify-2fa success returns connected session_row.
          
          Bug2 fix: verify-2fa on success returns <tr> with connected state,
          not a <div> toast.
          <Function test_verify_2fa_returns_session_row_on_success>
            verify-2fa success returns <tr> with connected state.
        <Class TestLanguageSwitchTranslation>
          Test 3: EN->RU language switch translates nav menu.
          
          Bug3 fix: After removing env.install_gettext_translations() race condition,
          the ContextVar-based translation correctly switches languages.
          <Function test_nav_menu_en_default>
            Default (EN) nav menu has English labels.
          <Function test_nav_menu_ru_via_cookie>
            RU locale via cookie translates nav menu items.
        <Class TestFullAuthFlowNoRefresh>
          Test 4: Full flow Code->2FA->Connected without page refresh.
          
          Simulates: verify-code(needs_2fa) -> verify-2fa(connected).
          Both responses are <tr> elements that can replace each other via HTMX outerHTML.
          <Function test_code_to_2fa_to_connected_flow>
            Full auth flow: verify-code returns needs_2fa row, then verify-2fa returns connected row.
    <Module test_8_state_model.py>
      Test enforcement of 8-state model (SPEC requirement #5).
      
      This test ensures that only the 8 allowed states exist in the codebase:
      - disconnected
      - connecting
      - connected
      - needs_code
      - needs_2fa
      - needs_config
      - banned
      - error
      
      Removed states that should NOT appear anywhere:
      - session_expired
      - corrupted_session
      - needs_api_id
      - proxy_missing
      - proxy_error
      - needs_account_info
      - needs_setup
      - flood_wait
      <Function test_only_8_states_in_python_code>
        Verify only 8 allowed states appear in Python source code state assignments.
      <Function test_only_8_states_in_templates>
        Verify only 8 allowed states appear in HTML templates.
      <Function test_only_8_states_in_javascript>
        Verify only 8 allowed states appear in JavaScript files.
      <Function test_only_8_states_documented>
        Verify exactly 8 states are documented as the canonical set.
      <Function test_no_state_creep_in_recent_commits>
        Regression guard: Check that no removed states were reintroduced in recent commits.
        
        This test focuses on actual state assignments (state=), not error message dictionaries.
    <Module test_account_info.py>
      Tests for AccountInfo model and subscription limits.
      <Class TestAccountInfoModel>
        Test AccountInfo model validation and computed properties.
        <Function test_valid_account_info>
          Test that valid account info is accepted.
        <Function test_negative_user_id>
          Test that negative user_id is rejected.
        <Function test_zero_user_id>
          Test that zero user_id is rejected.
        <Function test_negative_chat_count>
          Test that negative chat_count is rejected.
        <Function test_optional_fields>
          Test that optional fields can be None.
      <Class TestAccountLimits>
        Test chat subscription limit calculations.
        <Function test_standard_chat_limit>
          Test that standard accounts have 500 chat limit.
        <Function test_premium_chat_limit>
          Test that premium accounts have 1000 chat limit.
        <Function test_remaining_slots_standard>
          Test remaining slots calculation for standard account.
        <Function test_remaining_slots_premium>
          Test remaining slots calculation for premium account.
        <Function test_remaining_slots_at_limit>
          Test remaining slots when at limit.
        <Function test_remaining_slots_over_limit>
          Test remaining slots when over limit (capped at 0).
      <Class TestLimitDetection>
        Test limit threshold detection.
        <Function test_is_at_limit_false>
          Test is_at_limit when under limit.
        <Function test_is_at_limit_true>
          Test is_at_limit when at limit.
        <Function test_is_at_limit_over>
          Test is_at_limit when over limit.
        <Function test_is_near_limit_false>
          Test is_near_limit when well under limit.
        <Function test_is_near_limit_true>
          Test is_near_limit at 90% threshold.
        <Function test_is_near_limit_just_under_threshold>
          Test is_near_limit just under 90% threshold.
        <Function test_is_critical_false>
          Test is_critical when under critical threshold.
        <Function test_is_critical_true>
          Test is_critical at 98% threshold.
        <Function test_is_critical_premium>
          Test is_critical threshold for premium account.
      <Class TestUsageCalculation>
        Test usage percentage calculation.
        <Function test_usage_percent_empty>
          Test usage percentage with zero chats.
        <Function test_usage_percent_half>
          Test usage percentage at 50%.
        <Function test_usage_percent_full>
          Test usage percentage at 100%.
        <Function test_usage_percent_over_limit>
          Test usage percentage over 100%.
      <Class TestDisplayName>
        Test display_name computed property.
        <Function test_display_name_with_username>
          Test display name when username is set.
        <Function test_display_name_with_first_name_only>
          Test display name when only first_name is set.
        <Function test_display_name_fallback_to_id>
          Test display name falls back to user_id.
      <Class TestCanJoinChats>
        Test can_join_chats method.
        <Function test_can_join_single_chat>
          Test can join single chat when under limit.
        <Function test_can_join_multiple_chats>
          Test can join multiple chats when enough slots.
        <Function test_cannot_join_at_limit>
          Test cannot join when at limit.
        <Function test_cannot_join_insufficient_slots>
          Test cannot join when insufficient slots.
        <Function test_can_join_exact_slots>
          Test can join when exact number of slots.
      <Class TestFakeFactory>
        Test AccountInfo.fake() factory method.
        <Function test_fake_default_values>
          Test fake creates valid default account.
        <Function test_fake_custom_values>
          Test fake accepts custom values.
      <Class TestThresholdConstants>
        Test threshold constants are correctly defined.
        <Function test_standard_limit>
          Test standard chat limit constant.
        <Function test_premium_limit>
          Test premium chat limit constant.
        <Function test_warning_threshold>
          Test warning threshold constant.
        <Function test_critical_threshold>
          Test critical threshold constant.
    <Module test_analysis_router.py>
      Tests for the analysis router.
      <Class TestAnalysisStatusEndpoint>
        Tests for GET /api/analysis/{task_id}/status endpoint.
        <Function test_get_status_valid_task>
          Test getting status of a valid task.
        <Function test_get_status_invalid_uuid>
          Test getting status with invalid UUID format.
        <Function test_get_status_nonexistent_task>
          Test getting status of non-existent task.
      <Class TestAnalysisResultsEndpoint>
        Tests for GET /api/analysis/{task_id}/results endpoint.
        <Function test_get_results_completed_task>
          Test getting results of a completed task.
        <Function test_get_results_in_progress_task>
          Test getting results of an in-progress task.
        <Function test_get_results_failed_task>
          Test getting results of a failed task.
        <Function test_get_results_invalid_uuid>
          Test getting results with invalid UUID.
        <Function test_get_results_pending_task>
          Test getting results of a pending (not started) task.
        <Function test_get_results_timeout_task>
          Test getting results of a timed-out task with partial results.
        <Function test_get_results_cancelled_task>
          Test getting results of a cancelled task with partial results.
        <Function test_get_results_nonexistent_task>
          Test getting results for non-existent task.
        <Function test_get_results_clears_orphaned_session>
          Test that viewing results clears the orphaned task from session.
      <Class TestProgressStreamEndpoint>
        Tests for GET /api/analysis/{task_id}/progress SSE endpoint.
        <Function test_progress_stream_invalid_uuid>
          Test SSE stream with invalid UUID.
        <Function test_progress_stream_nonexistent_task>
          Test SSE stream for non-existent task.
        <Function test_progress_stream_valid_task>
          Test SSE endpoint accepts valid task and returns correct response type.
          
          Note: Full SSE streaming tests require integration testing with a real
          async client. This unit test only verifies the endpoint accepts valid
          tasks and returns the correct content-type. The actual SSE stream would
          block in sync mode, so we skip reading the stream content.
        <Function test_progress_stream_completed_task_immediate_close>
          Test SSE stream for completed task sends completion and closes.
        <Function test_progress_stream_failed_task>
          Test SSE stream for failed task sends error event.
        <Function test_progress_stream_cancelled_task>
          Test SSE stream for cancelled task sends cancelled event.
        <Function test_progress_stream_timeout_task>
          Test SSE stream for timed-out task sends timeout event.
      <Class TestStartAnalysisEndpoint>
        Tests for POST /api/analysis/start endpoint.
        <Function test_start_analysis_no_session>
          Test starting analysis with no session selected.
        <Function test_start_analysis_no_chats>
          Test starting analysis with no chats selected.
        <Function test_start_analysis_message_limit_too_low>
          Test starting analysis with message limit below minimum.
        <Function test_start_analysis_message_limit_too_high>
          Test starting analysis with message limit above maximum.
        <Function test_start_analysis_session_not_found>
          Test starting analysis with non-existent session.
        <Function test_start_analysis_all_chats_invalid>
          Test starting analysis when all selected chats are invalid/stale.
        <Function test_start_analysis_some_chats_invalid>
          Test starting analysis when some chats are invalid.
        <Function test_start_analysis_validation_timeout>
          Test starting analysis when chat validation times out.
        <Function test_start_analysis_validation_error>
          Test starting analysis when chat validation raises an error.
        <Function test_start_analysis_queue_full>
          Test starting analysis when task queue is full.
        <Function test_start_analysis_duplicate_task>
          Test starting analysis when an identical task already exists.
        <Function test_start_analysis_success>
          Test successful analysis start.
      <Class TestCancelAnalysisEndpoint>
        Tests for POST /api/analysis/{task_id}/cancel endpoint.
        <Function test_cancel_invalid_task_id>
          Test cancelling with invalid task ID format.
        <Function test_cancel_nonexistent_task>
          Test cancelling non-existent task.
        <Function test_cancel_completed_task>
          Test cancelling already completed task.
        <Function test_cancel_pending_task>
          Test cancelling pending task.
        <Function test_cancel_in_progress_task>
          Test cancelling in-progress task.
      <Class TestForceCancelAnalysisEndpoint>
        Tests for POST /api/analysis/{task_id}/force_cancel endpoint.
        <Function test_force_cancel_invalid_task_id>
          Test force cancelling with invalid task ID format.
        <Function test_force_cancel_nonexistent_task>
          Test force cancelling non-existent task.
        <Function test_force_cancel_completed_task>
          Test force cancelling already completed task.
        <Function test_force_cancel_in_progress_task>
          Test force cancelling in-progress task.
        <Function test_force_cancel_with_custom_reason>
          Test force cancelling with custom reason.
      <Class TestCheckOrphanedEndpoint>
        Tests for GET /api/analysis/check_orphaned endpoint.
        <Function test_check_orphaned_no_session_task>
          Test checking for orphaned task when none exists in session.
        <Function test_check_orphaned_invalid_task_id>
          Test checking orphaned task with invalid UUID in session.
        <Function test_check_orphaned_task_not_found>
          Test checking orphaned task that no longer exists.
        <Function test_check_orphaned_task_completed>
          Test checking orphaned task that is completed.
        <Function test_check_orphaned_task_failed>
          Test checking orphaned task that failed.
        <Function test_check_orphaned_task_in_progress>
          Test checking orphaned task still in progress.
        <Function test_check_orphaned_already_notified>
          Test checking orphaned task that was already notified.
      <Class TestDismissNotificationEndpoint>
        Tests for POST /api/analysis/{task_id}/dismiss_notification endpoint.
        <Function test_dismiss_notification>
          Test dismissing orphaned task notification.
        <Function test_dismiss_notification_different_task>
          Test dismissing notification for different task.
      <Class TestResultsPage>
        Tests for the results page.
        <Function test_results_page_no_task_id>
          Test results page without task ID shows empty state.
        <Function test_results_page_with_valid_task>
          Test results page with valid task ID shows results.
        <Function test_results_page_with_invalid_task>
          Test results page with invalid task ID shows error.
    <Module test_analyzer.py>
      Tests for chat analyzer module.
      <Class TestComputeMetrics>
        Tests for compute_metrics function.
        <Function test_empty_messages>
          Test that empty message list returns empty metrics.
        <Function test_single_message>
          Test metrics for a single message.
        <Function test_multiple_messages_same_author>
          Test that same author is counted once.
        <Function test_multiple_unique_authors>
          Test counting of unique authors.
        <Function test_anonymous_authors_counted_as_chat>
          Test that anonymous authors (sender=None) are counted as the chat itself.
          
          In Telegram channels and groups with anonymous admins, sender_id can be None.
          The current implementation assigns chat_id as the author_id for these messages,
          meaning all anonymous messages in a chat are counted as ONE author (the chat).
          
          This is a deliberate design decision:
          - Pros: Simple, consistent, prevents zero unique_authors in anonymous-only chats
          - Cons: May undercount if multiple people post anonymously
          
          Alternative approaches considered:
          - Skip anonymous messages: Would lose message count data
          - Count each as unique: Would overcount if same person posts multiple times
        <Function test_mixed_anonymous_and_regular_authors>
          Test unique author counting with mix of anonymous and regular authors.
        <Function test_history_hours_calculation>
          Test that history hours is calculated correctly.
        <Function test_unsorted_messages>
          Test that unsorted messages are handled correctly.
        <Function test_fractional_hours>
          Test that fractional hours are calculated correctly.
        <Function test_preserves_timezone_info>
          Test that timestamp timezone info is preserved.
      <Class TestMessagesPerHour>
        Tests for messages_per_hour computed property.
        <Function test_empty_metrics_returns_zero>
          Test that empty metrics returns 0 messages per hour.
        <Function test_single_message_returns_zero>
          Test that single message (history_hours=0) returns 0.
        <Function test_normal_calculation>
          Test normal messages per hour calculation.
        <Function test_fractional_rate>
          Test fractional messages per hour.
        <Function test_high_activity>
          Test high activity chat.
        <Function test_via_compute_metrics>
          Test that compute_metrics result has correct messages_per_hour.
      <Class TestEdgeCases>
        Tests for edge cases and boundary conditions.
        <Function test_messages_with_identical_timestamps>
          Test that messages with identical timestamps are handled correctly.
        <Function test_large_message_count>
          Test with very large number of messages.
        <Function test_microsecond_precision>
          Test that microsecond precision is handled correctly.
        <Function test_very_long_time_span>
          Test with messages spanning multiple years.
        <Function test_all_messages_same_author_different_times>
          Test multiple messages from single author over time.
        <Function test_extreme_author_diversity>
          Test when every message is from a unique author.
        <Function test_two_authors_alternating>
          Test with exactly two authors sending alternating messages.
        <Function test_messages_in_reverse_chronological_order>
          Test messages sorted newest to oldest.
        <Function test_single_author_with_zero_time_span>
          Test multiple messages from one author at exact same time.
        <Function test_deleted_accounts_counted_by_id>
          Test that deleted accounts are counted as separate unique authors by their ID.
          
          When a Telegram user deletes their account, the account is marked as deleted
          but the user_id is preserved. Each deleted account should count as a unique
          author based on their ID, not all grouped together as one "Deleted Account".
          This provides accurate statistics about historical chat participation.
        <Function test_multiple_deleted_accounts_are_distinct>
          Test that multiple deleted accounts are counted as distinct authors.
          
          This verifies that we don't merge all deleted accounts into one "Deleted Account"
          entity, but instead treat each deleted user's ID as a unique author.
        <Function test_forwarded_messages_count_forwarder>
          Test that forwarded messages count the forwarder, not the original author.
          
          When a message is forwarded to a chat, the author_id represents the person
          who forwarded it (the forwarder), not the original author. This is correct
          behavior because:
          1. The forwarder is actively participating in this specific chat
          2. The original author may not even be a member of this chat
          3. It matches what users see in the Telegram UI
          
          Note: Our Message model only stores author_id (the forwarder). The original
          author info from Telegram's fwd_from field is not captured because we don't
          need it for unique_authors counting.
        <Function test_same_user_forwarding_and_posting>
          Test that a user forwarding and posting original messages counts as one author.
      <Class TestMessageGapDetection>
        Tests for deleted message gap detection.
        <Function test_no_gaps_sequential_ids>
          Test that sequential message IDs result in no gaps detected.
        <Function test_gaps_detected_with_missing_ids>
          Test that gaps in message IDs are detected (deleted messages).
        <Function test_single_message_has_no_gaps>
          Test that a single message cannot have gaps.
        <Function test_empty_messages_has_no_gaps>
          Test that empty message list has no gaps.
        <Function test_gaps_affect_history_hours_note>
          Test that gaps are noted even when history_hours seems accurate.
          
          This is important because if the first or last message was deleted,
          the history_hours calculation would be based on remaining messages
          and would underestimate the true span.
      <Class TestStreamingMetricsAggregator>
        Tests for StreamingMetricsAggregator class.
        <Function test_empty_aggregator_returns_empty_metrics>
          Test that empty aggregator returns empty metrics.
        <Function test_add_single_batch>
          Test adding a single batch of messages.
        <Function test_add_multiple_batches>
          Test adding multiple batches incrementally.
        <Function test_add_single_message>
          Test adding messages one at a time.
        <Function test_empty_batch_ignored>
          Test that empty batches don't affect metrics.
        <Function test_batches_with_out_of_order_timestamps>
          Test that batches with out-of-order timestamps are handled correctly.
        <Function test_reset_clears_state>
          Test that reset clears all aggregated state.
        <Function test_large_number_of_batches>
          Test processing many batches (simulating large chat).
        <Function test_matches_compute_metrics_result>
          Test that streaming aggregator produces same result as compute_metrics.
        <Function test_author_set_size_bytes_estimation>
          Test memory estimation for author ID set.
        <Function test_progressive_properties>
          Test that properties update as batches are added.
    <Module test_auth_state.py>
      Tests for auth state manager.
      
      Tests cover:
      - AuthState: creation, expiration, touch
      - AuthStateManager: create, get, update, remove, cleanup
      - Singleton pattern
      <Class TestAuthState>
        Tests for AuthState dataclass.
        <Function test_creation>
          AuthState should initialize with correct values.
        <Function test_is_expired_false>
          Fresh state should not be expired.
        <Function test_is_expired_true>
          Old state should be expired.
        <Function test_touch>
          touch() should update updated_at.
        <Function test_is_locked_false>
          Fresh state should not be locked.
        <Function test_is_locked_true>
          State with future locked_until should be locked.
        <Function test_is_locked_expired>
          State with past locked_until should not be locked.
        <Function test_get_lock_remaining_seconds>
          get_lock_remaining_seconds should return correct value.
        <Function test_get_lock_remaining_seconds_not_locked>
          get_lock_remaining_seconds should return 0 when not locked.
      <Class TestAuthStep>
        Tests for AuthStep enum.
        <Function test_values>
          AuthStep should have expected values.
      <Class TestAuthStateManager>
        Tests for AuthStateManager class.
        <Coroutine test_create_auth_state>
          create_auth_state should create and store state.
        <Coroutine test_get_auth_state>
          get_auth_state should return existing state.
        <Coroutine test_get_auth_state_missing>
          get_auth_state should return None for missing ID.
        <Coroutine test_get_auth_state_expired>
          get_auth_state should return None for expired state.
        <Coroutine test_update_auth_state>
          update_auth_state should update state fields.
        <Coroutine test_update_auth_state_missing>
          update_auth_state should return None for missing state.
        <Coroutine test_remove_auth_state>
          remove_auth_state should remove state and disconnect client.
        <Coroutine test_cleanup_all>
          cleanup_all should remove all states.
        <Coroutine test_increment_failed_attempts>
          increment_failed_attempts should increment counter.
        <Coroutine test_increment_failed_attempts_locks_at_max>
          increment_failed_attempts should lock when reaching MAX_AUTH_ATTEMPTS.
        <Coroutine test_check_auth_lock_not_locked>
          check_auth_lock should return False for unlocked state.
        <Coroutine test_check_auth_lock_locked>
          check_auth_lock should return True for locked state.
        <Coroutine test_check_auth_lock_missing_state>
          check_auth_lock should return False for missing state.
        <Coroutine test_reset_failed_attempts>
          reset_failed_attempts should reset counter and unlock state.
        <Coroutine test_reset_failed_attempts_missing_state>
          reset_failed_attempts should return None for missing state.
      <Class TestGetAuthStateManager>
        Tests for get_auth_state_manager function.
        <Function test_returns_manager>
          Should return AuthStateManager instance.
        <Function test_singleton>
          Should return same instance (singleton).
    <Module test_chat_validation.py>
      Tests for chat ID validation (ChatFilter-9526).
      
      This module tests the validate_chat_ids functionality that prevents
      stale chat state when chats are added/deleted between selection and analysis.
      <Class TestChatIdValidation>
        Tests for validate_chat_ids method.
        <Coroutine test_validate_all_valid_ids>
          Test validation when all selected chat IDs are valid.
        <Coroutine test_validate_some_invalid_ids>
          Test validation when some selected chat IDs are stale/invalid.
        <Coroutine test_validate_all_invalid_ids>
          Test validation when all selected chat IDs are invalid.
        <Coroutine test_validate_clears_cache>
          Test that validation clears cache to fetch fresh data.
        <Coroutine test_validate_empty_list>
          Test validation with empty chat ID list.
    <Module test_chatlist_router.py>
      Comprehensive tests for chatlist router.
      <Class TestStoreChatList>
        Tests for store_chat_list helper function.
        <Function test_store_chat_list_returns_id>
          Test that storing a chat list returns a list ID.
        <Function test_store_chat_list_empty>
          Test storing empty list.
        <Function test_store_multiple_lists>
          Test storing multiple lists returns different IDs.
      <Class TestGetChatList>
        Tests for get_chat_list helper function.
        <Function test_get_chat_list_found>
          Test retrieving an existing chat list.
        <Function test_get_chat_list_not_found>
          Test retrieving non-existent list returns None.
        <Function test_get_chat_list_empty_id>
          Test retrieving with empty ID returns None.
      <Class TestClearChatList>
        Tests for clear_chat_list helper function.
        <Function test_clear_chat_list_exists>
          Test clearing an existing chat list.
        <Function test_clear_chat_list_not_found>
          Test clearing non-existent list returns False.
      <Class TestUploadChatList>
        Tests for /api/chatlist/upload endpoint.
        <Function test_upload_text_file_success>
          Test uploading a valid text file.
        <Function test_upload_csv_file_success>
          Test uploading a valid CSV file.
        <Function test_upload_file_too_large>
          Test uploading file exceeding size limit.
        <Function test_upload_empty_file>
          Test uploading empty file.
        <Function test_upload_parse_error>
          Test upload with file that causes parse error.
        <Function test_upload_no_valid_entries>
          Test upload with file containing no valid entries.
        <Function test_upload_removes_duplicates>
          Test that duplicate entries are removed.
        <Function test_upload_unexpected_error>
          Test handling of unexpected errors during upload.
        <Function test_upload_xlsx_file>
          Test uploading Excel file.
      <Class TestFetchGoogleSheet>
        Tests for /api/chatlist/fetch_sheet endpoint.
        <Function test_fetch_sheet_success>
          Test successfully fetching Google Sheet.
        <Function test_fetch_sheet_empty_url>
          Test fetching with empty URL.
        <Function test_fetch_sheet_whitespace_url>
          Test fetching with whitespace-only URL.
        <Function test_fetch_sheet_invalid_url>
          Test fetching with invalid Google Sheets URL.
        <Function test_fetch_sheet_google_sheets_error>
          Test handling of Google Sheets API error.
        <Function test_fetch_sheet_no_valid_entries>
          Test fetching sheet with no valid entries.
        <Function test_fetch_sheet_removes_duplicates>
          Test that duplicate entries from sheet are removed.
        <Function test_fetch_sheet_unexpected_error>
          Test handling of unexpected errors during sheet fetch.
        <Function test_fetch_sheet_url_with_whitespace>
          Test that URLs with leading/trailing whitespace are handled.
      <Class TestGetChatListEntries>
        Tests for /api/chatlist/{list_id} endpoint.
        <Function test_get_entries_success>
          Test retrieving entries for existing list.
        <Function test_get_entries_not_found>
          Test retrieving entries for non-existent list.
        <Function test_get_entries_empty_list>
          Test retrieving empty list.
        <Function test_get_entries_invalid_id_format>
          Test retrieving with malformed list ID.
      <Class TestDeleteChatList>
        Tests for /api/chatlist/{list_id} DELETE endpoint.
        <Function test_delete_existing_list>
          Test deleting an existing list.
        <Function test_delete_non_existent_list>
          Test deleting non-existent list returns 404.
        <Function test_delete_already_deleted_list>
          Test deleting a list that was already deleted returns 404.
      <Class TestIntegrationScenarios>
        Integration tests for complete workflows.
        <Function test_upload_then_retrieve_workflow>
          Test complete workflow: upload file, get list ID, retrieve entries.
        <Function test_fetch_sheet_then_delete_workflow>
          Test workflow: fetch sheet, store, then delete.
        <Function test_multiple_uploads_different_lists>
          Test uploading multiple different lists.
      <Class TestEdgeCases>
        Tests for edge cases and boundary conditions.
        <Function test_upload_file_exactly_at_size_limit>
          Test uploading file exactly at MAX_FILE_SIZE.
        <Function test_upload_file_one_byte_over_limit>
          Test uploading file one byte over MAX_FILE_SIZE.
        <Function test_upload_with_unicode_filename>
          Test uploading file with unicode filename.
        <Function test_upload_with_special_chars_in_filename>
          Test uploading file with special characters in filename.
        <Function test_store_list_with_many_entries>
          Test storing list with large number of entries.
        <Function test_fetch_sheet_with_international_domain>
          Test fetching sheet with international characters in URL.
        <Function test_concurrent_list_operations>
          Test that concurrent operations maintain data integrity.
      <Class TestImportResultModel>
        Tests for ImportResult Pydantic model.
        <Function test_import_result_success>
          Test creating successful ImportResult.
        <Function test_import_result_error>
          Test creating error ImportResult.
    <Module test_chats_router.py>
      Tests for chats router.
      <Class TestChatsPage>
        Tests for chats page.
        <Function test_chats_page_loads>
          Test that chats page loads successfully.
      <Class TestChatsAPI>
        Tests for chats API endpoints.
        <Function test_get_chats_session_not_found>
          Test getting chats from non-existent session returns 404.
        <Function test_get_chats_success>
          Test getting chats successfully from a mock session.
        <Function test_get_chats_with_pagination>
          Test getting chats with explicit pagination parameters.
        <Function test_get_chats_last_page>
          Test getting the last page of chats (no load more button).
        <Function test_get_chats_session_invalid_error>
          Test getting chats when session is invalid (revoked/banned).
        <Function test_get_chats_session_reauth_required_error>
          Test getting chats when session requires re-authorization.
        <Function test_get_chats_session_reauth_2fa_error>
          Test getting chats when 2FA is required.
        <Function test_get_chats_generic_telethon_error>
          Test handling of generic Telethon errors.
        <Function test_get_chats_generic_error>
          Test handling of generic non-Telethon errors.
        <Function test_get_chats_error_info_extraction_fails>
          Test handling when error info extraction itself fails.
        <Function test_get_chats_json_no_session>
          Test JSON endpoint with no session selected.
        <Function test_get_chats_json_session_not_found>
          Test JSON endpoint returns 404 for non-existent session.
        <Function test_get_chats_json_success>
          Test JSON endpoint returns all chats successfully.
        <Function test_get_chats_json_session_invalid_error>
          Test JSON endpoint handles invalid session.
        <Function test_get_chats_json_session_reauth_required>
          Test JSON endpoint handles reauth required.
        <Function test_get_chats_json_generic_error>
          Test JSON endpoint handles generic errors.
      <Class TestAccountInfoAPI>
        Tests for account info API endpoints.
        <Function test_get_account_info_no_session>
          Test account info endpoint with no session selected.
        <Function test_get_account_info_success>
          Test getting account info successfully.
        <Function test_get_account_info_session_not_found>
          Test account info endpoint with non-existent session.
        <Function test_get_account_info_error>
          Test account info endpoint handles errors gracefully.
        <Function test_get_account_info_json_no_session>
          Test JSON account info endpoint with no session.
        <Function test_get_account_info_json_success>
          Test JSON account info endpoint success.
        <Function test_get_account_info_json_non_premium>
          Test JSON account info for non-premium account.
        <Function test_get_account_info_json_at_limit>
          Test JSON account info for account at limit.
        <Function test_get_account_info_json_session_not_found>
          Test JSON account info endpoint with non-existent session.
        <Function test_get_account_info_json_error>
          Test JSON account info endpoint handles errors.
      <Class TestHelperFunctions>
        Tests for helper functions in chats router.
        <Function test_get_session_paths_success>
          Test get_session_paths with valid session.
        <Function test_get_session_paths_directory_not_found>
          Test get_session_paths with non-existent directory.
        <Function test_get_session_paths_missing_files>
          Test get_session_paths with missing session files.
        <Function test_cleanup_invalid_session>
          Test cleanup_invalid_session removes session files.
        <Function test_cleanup_invalid_session_nonexistent>
          Test cleanup_invalid_session handles non-existent session gracefully.
        <Function test_cleanup_invalid_session_error_handling>
          Test cleanup_invalid_session handles errors gracefully.
      <Class TestWebSessionPersistence>
        Tests for web session storage functionality.
        <Function test_get_chats_stores_session_in_web_session>
          Test that get_chats stores selected session in web session.
        <Function test_get_chats_json_stores_session_in_web_session>
          Test that get_chats_json stores selected session in web session.
      <Class TestPaginationEdgeCases>
        Tests for pagination edge cases.
        <Function test_get_chats_with_zero_offset>
          Test pagination with explicit zero offset.
        <Function test_get_chats_with_max_limit>
          Test pagination with maximum allowed limit.
        <Function test_get_chats_empty_result>
          Test getting chats when result is empty.
    <Module test_cleanup.py>
      Tests for cleanup utilities (SIGKILL recovery).
      <Class TestCleanupOrphanedTempFiles>
        Tests for cleanup_orphaned_temp_files().
        <Function test_removes_temp_files>
          Should remove all .*.tmp files.
        <Function test_removes_temp_files_recursively>
          Should remove temp files in subdirectories.
        <Function test_handles_no_temp_files>
          Should return 0 when no temp files exist.
        <Function test_handles_nonexistent_directory>
          Should return 0 for nonexistent directory.
        <Function test_skips_temp_directories>
          Should only remove files, not directories.
      <Class TestCleanupOrphanedDbJournals>
        Tests for cleanup_orphaned_db_journals().
        <Function test_removes_journal_files>
          Should remove SQLite journal files.
        <Function test_handles_missing_journal_files>
          Should return 0 when no journal files exist.
        <Function test_removes_only_relevant_journals>
          Should only remove journal files for specified database.
        <Function test_handles_nonexistent_db_path>
          Should return 0 when database directory doesn't exist.
        <Function test_cleanup_with_real_sqlite_database>
          Integration test with real SQLite database.
      <Class TestCleanupOrphanedResources>
        Tests for cleanup_orphaned_resources() comprehensive cleanup.
        <Function test_comprehensive_cleanup>
          Should clean all resource types.
        <Function test_handles_no_orphaned_resources>
          Should handle case with no orphaned resources.
        <Function test_handles_partial_failures_gracefully>
          Should continue cleanup even if some operations fail.
        <Function test_custom_db_name>
          Should support custom database names.
        <Function test_cleanup_stats_dataclass>
          Should create CleanupStats with correct defaults.
      <Class TestCleanupOldSessionFiles>
        Tests for cleanup_old_session_files() wrapper.
        <Function test_skips_cleanup_when_disabled>
          Should return 0 when cleanup_days is None.
        <Function test_delegates_to_storage_module>
          Should delegate to storage.file.cleanup_old_session_files().
    <Module test_config_validation.py>
      Tests for configuration validation.
      <Class TestConfigValidation>
        Tests for Settings.validate() method.
        <Function test_valid_config>
          Test that valid configuration passes validation.
        <Function test_invalid_port_too_low>
          Test that port below 1 fails validation.
        <Function test_data_dir_is_file>
          Test that data directory existing as file fails validation.
        <Function test_readonly_parent_directory>
          Test that read-only parent directory fails validation.
        <Function test_port_in_use>
          Test that occupied port fails validation.
        <Function test_writable_data_directory>
          Test that writable data directory passes validation.
        <Function test_validation_messages_have_fixes>
          Test that validation errors include fix suggestions.
      <Class TestConfigCheck>
        Tests for Settings.check() method (warnings).
        <Function test_debug_mode_production_warning>
          Test warning for debug mode with public binding.
        <Function test_no_warnings_for_valid_config>
          Test that valid configuration has no warnings.
      <Class TestLoggingConfig>
        Tests for logging configuration settings.
        <Function test_default_logging_config>
          Test default logging configuration values.
        <Function test_custom_log_level>
          Test custom log level configuration.
        <Function test_invalid_log_level>
          Test that invalid log level raises validation error.
        <Function test_log_file_disabled>
          Test disabling file logging.
        <Function test_custom_log_rotation_settings>
          Test custom log rotation configuration.
        <Function test_log_file_path_property>
          Test that log_file_path property returns correct path.
        <Function test_log_dir_creation>
          Test that log directory is created when log_to_file is enabled.
        <Function test_log_dir_not_created_when_disabled>
          Test that log directory is not created when log_to_file is disabled.
        <Function test_log_config_in_print_config>
          Test that print_config includes logging configuration.
    <Module test_conftest_fixtures.py>
      Tests for the shared test fixtures in conftest.py.
      
      This test file verifies that the new Telegram mock fixtures work correctly
      and can be used by other tests.
      <Class TestFakeChatFactory>
        Tests for fake_chat_factory fixture.
        <Function test_creates_default_chat>
          Test creating a default chat.
        <Function test_creates_custom_chat>
          Test creating a custom chat.
        <Function test_deterministic_with_seed_offset>
          Test that same seed_offset produces same IDs.
        <Function test_different_seed_offsets_produce_different_ids>
          Test that different seed_offsets produce different IDs.
      <Class TestFakeMessageFactory>
        Tests for fake_message_factory fixture.
        <Function test_creates_default_message>
          Test creating a default message.
        <Function test_creates_custom_message>
          Test creating a custom message.
        <Function test_deterministic_with_seed_offset>
          Test that same seed_offset produces same IDs.
      <Class TestMockDialogFactory>
        Tests for mock_dialog_factory fixture.
        <Function test_creates_user_dialog>
          Test creating a user dialog.
        <Function test_creates_channel_dialog>
          Test creating a channel dialog.
        <Function test_creates_megagroup_dialog>
          Test creating a megagroup dialog.
        <Function test_creates_forum_dialog>
          Test creating a forum dialog.
      <Class TestMockMessageFactory>
        Tests for mock_message_factory fixture.
        <Function test_creates_basic_message>
          Test creating a basic message.
        <Function test_creates_message_with_media>
          Test creating a message with media.
        <Function test_creates_channel_post>
          Test creating a channel post (no sender).
      <Coroutine test_mock_telegram_client>
        Test that mock_telegram_client fixture works.
      <Class TestEdgeCaseChats>
        Tests for edge_case_chats fixture.
        <Function test_has_expected_edge_cases>
          Test that all expected edge cases are present.
        <Function test_empty_chat>
          Test empty chat edge case.
        <Function test_unicode_chat>
          Test unicode chat edge case.
        <Function test_forum_chat>
          Test forum chat edge case.
      <Class TestEdgeCaseMessages>
        Tests for edge_case_messages fixture.
        <Function test_has_expected_edge_cases>
          Test that all expected edge cases are present.
        <Function test_empty_message>
          Test empty message edge case.
        <Function test_unicode_message>
          Test unicode message edge case.
        <Function test_emoji_only_message>
          Test emoji-only message edge case.
        <Function test_newlines_message>
          Test message with newlines.
    <Module test_connect_flow_smoke.py>
      Smoke tests for connection flow covering all SPEC scenarios.
      
      Tests all 6 scenarios from SPEC.md:
      1. Save without api_id/proxy → disconnected in list
      2. Connect without credentials → needs_config + Edit button
      3. Connect with expired session → auto send_code → needs_code
      4. Connect normal → connecting → needs_code or connected
      5. Banned account → banned + tooltip
      6. Connect with corrupted session → auto send_code → needs_code
      
      Test approach: Mock Telethon client, simulate each scenario, verify UI state via SSE events.
      <Class TestConnectFlowSmoke>
        Smoke tests for connection flow scenarios.
        <Coroutine test_scenario_1_save_without_api_id>
          Scenario 1: Save without api_id/proxy → disconnected in list.
          
          This scenario tests the save-only flow (start_auth_flow with minimal data).
          Session should appear as 'disconnected' in list.
        <Coroutine test_scenario_2_connect_without_credentials>
          Scenario 2: Connect without credentials → needs_config + Edit button.
          
          This scenario tests connecting when api_id/api_hash are missing.
          Should publish 'needs_config' SSE event.
        <Coroutine test_scenario_3_expired_session_auto_send_code>
          Scenario 3: Connect with expired session → auto send_code → needs_code.
          
          This scenario tests auto-recovery from expired session.
          Should delete old session file and trigger send_code flow (publishes 'needs_code').
        <Coroutine test_scenario_4_normal_connect_success>
          Scenario 4: Connect normal → connecting → connected.
          
          This scenario tests successful connection with valid session.
          Should call session_manager.connect() which publishes 'connected' SSE.
        <Coroutine test_scenario_5_banned_account>
          Scenario 5: Banned account → banned + tooltip.
          
          This scenario tests connecting with a banned account.
          Should publish 'banned' SSE event.
        <Coroutine test_scenario_6_corrupted_session_auto_send_code>
          Scenario 6: Connect with corrupted session → auto send_code → needs_code.
          
          This scenario tests auto-recovery from corrupted session (struct.error).
          Uses same recovery path as expired session (SessionReauthRequiredError).
          Should delete old session file and trigger send_code flow.
    <Module test_connect_flow_states.py>
      Tests for 8-state connect flow model.
      
      This test suite verifies all state transitions in the simplified 8-state model:
      1. disconnected → connect → needs_config (no api_id)
      2. disconnected → connect → needs_code (first time)
      3. needs_code → submit code → connected
      4. needs_code → submit code → needs_2fa
      5. needs_2fa → submit password → connected
      6. error → retry → recovery path
      7. banned → no action (terminal state)
      8. connecting → intermediate state (spinner)
      
      Each test verifies:
      - State transition logic
      - SSE event publishing
      - Error message handling
      - Recovery paths
      
      SECURITY NOTE: Tests use mocks to avoid hardcoded credentials.
      All API credentials (api_id, api_hash) are simulated via SecureCredentialManager mocks.
      No actual Telegram credentials are present in this test file.
      <Class TestConnectFlowConfigValidation>
        Tests for config validation during connect flow.
        <Coroutine test_disconnected_to_needs_config_no_api_id>
          Test: disconnected → connect → needs_config (missing api_id/api_hash).
        <Coroutine test_disconnected_to_needs_config_no_proxy>
          Test: disconnected → connect → needs_config (missing proxy_id).
      <Class TestConnectFlowFirstTimeAuth>
        Tests for first-time authentication flow.
        <Coroutine test_disconnected_to_needs_code_first_time>
          Test: disconnected → connect → needs_code (no session.session file).
      <Class TestConnectFlowCodeVerification>
        Tests for verification code submission.
        <Coroutine test_needs_code_to_connected_success>
          Test: needs_code → submit code → connected (success).
        <Coroutine test_needs_code_to_needs_2fa>
          Test: needs_code → submit code → needs_2fa (2FA required).
      <Class TestConnectFlow2FA>
        Tests for 2FA password verification.
        <Coroutine test_needs_2fa_to_connected_success>
          Test: needs_2fa → submit password → connected (success).
      <Class TestConnectFlowErrorRecovery>
        Tests for error states and recovery.
        <Coroutine test_error_to_recovery_via_retry>
          Test: error → retry → recovery path (transient network error).
        <Coroutine test_banned_terminal_state>
          Test: banned → no action (terminal state, no recovery).
          
          session_manager.connect() wraps UserDeactivatedBanError in SessionInvalidError.
          _do_connect_in_background_v2 inspects __cause__ and publishes 'banned'.
      <Class TestConnectFlowIntermediateStates>
        Tests for intermediate loading states.
        <Function test_connecting_state_shows_spinner>
          Test: connecting state shows spinner in UI (intermediate state).
      <Class TestConnectFlowSessionExpiredRecovery>
        Tests for expired session recovery.
        <Coroutine test_expired_session_auto_recovery>
          Test: expired session → auto-delete → send_code (auto-recovery).
          
          session_manager.connect() wraps AuthKeyUnregisteredError in SessionInvalidError.
          _do_connect_in_background_v2 must inspect __cause__ to trigger recovery.
      <Class TestConnectFlowAllStates>
        Integration test: All 8 states are covered.
        <Function test_all_8_states_covered>
          Verify all 8 states in the model are tested.
          
          States:
          1. disconnected - initial/terminal state
          2. connecting - intermediate loading state
          3. connected - success state
          4. needs_config - missing api_id/proxy
          5. needs_code - first-time auth
          6. needs_2fa - 2FA required
          7. error - generic error
          8. banned - terminal error state
          
          This test ensures coverage completeness.
    <Module test_csrf.py>
      Tests for CSRF protection module.
      
      Tests cover:
      - Token generation (format, uniqueness, entropy)
      - Token retrieval (creation on demand, persistence)
      - Token validation (timing-safe comparison, rejection of invalid tokens)
      - Token rotation
      <Class TestGenerateCsrfToken>
        Tests for generate_csrf_token function.
        <Function test_returns_string>
          Token should be a string.
        <Function test_token_length>
          Token should be URL-safe base64 encoded 32 bytes (43 chars).
        <Function test_tokens_are_unique>
          Each call should produce a unique token.
        <Function test_token_is_url_safe>
          Token should only contain URL-safe characters.
      <Class TestGetCsrfToken>
        Tests for get_csrf_token function.
        <Function test_creates_token_if_missing>
          Should create new token if session doesn't have one.
        <Function test_returns_existing_token>
          Should return existing token without modification.
        <Function test_stores_generated_token>
          New token should be stored in session.
      <Class TestValidateCsrfToken>
        Tests for validate_csrf_token function.
        <Function test_valid_token>
          Should return True for matching token.
        <Function test_invalid_token>
          Should return False for non-matching token.
        <Function test_missing_session_token>
          Should return False if session has no token.
        <Function test_empty_submitted_token>
          Should return False for empty token.
        <Function test_timing_safe_comparison>
          Validation should use constant-time comparison.
          
          This test verifies behavior, not timing (timing tests are unreliable).
          The implementation uses secrets.compare_digest which is timing-safe.
      <Class TestRotateCsrfToken>
        Tests for rotate_csrf_token function.
        <Function test_generates_new_token>
          Should generate a new token.
        <Function test_stores_new_token>
          New token should be stored in session.
        <Function test_returns_new_token>
          Should return the new token.
        <Function test_subsequent_rotations_different>
          Multiple rotations should produce different tokens.
      <Class TestCsrfIntegration>
        Integration tests for CSRF workflow.
        <Function test_full_csrf_flow>
          Test complete CSRF token lifecycle.
    <Module test_dependencies.py>
      Tests for FastAPI dependency injection helpers.
      
      Tests cover:
      - get_web_session: web session dependency
      - get_session_manager: Telegram session manager
      - get_chat_analysis_service: chat analysis service
      - get_database: task database
      <Class TestGetWebSession>
        Tests for get_web_session dependency.
        <Function test_returns_session>
          Should return session from get_session.
      <Class TestGetSessionManager>
        Tests for get_session_manager function.
        <Function test_creates_session_manager>
          Should create SessionManager instance.
        <Function test_returns_cached_instance>
          Should return cached instance on subsequent calls.
      <Class TestGetChatAnalysisService>
        Tests for get_chat_analysis_service function.
        <Function test_creates_service>
          Should create ChatAnalysisService instance.
        <Function test_returns_cached_instance>
          Should return cached instance on subsequent calls.
      <Class TestGetDatabase>
        Tests for get_database function.
        <Function test_creates_database>
          Should create TaskDatabase instance.
        <Function test_returns_cached_instance>
          Should return cached instance on subsequent calls.
    <Module test_device_confirmation.py>
      Tests for device confirmation ("Is this you?") handling.
      
      Tests Bug 2 fix: Telegram requires device confirmation detection.
      These are integration tests that verify the needs_confirmation state is properly
      handled across verify-code and verify-2fa endpoints, and that
      list_stored_sessions maps NEED_CONFIRMATION auth step correctly.
      <Class TestDeviceConfirmation>
        Test device confirmation detection and handling.
        <Coroutine test_verify_code_needs_confirmation>
          Test verify_code detects device confirmation needed.
        <Coroutine test_verify_2fa_needs_confirmation>
          Test verify_2fa detects device confirmation needed.
        <Coroutine test_list_stored_sessions_needs_confirmation_state>
          Test list_stored_sessions maps NEED_CONFIRMATION auth step to needs_confirmation state.
    <Module test_diagnostics.py>
      Tests for diagnostics module.
      <Function test_get_os_info>
        Test get_os_info returns expected OS information.
      <Function test_get_python_info>
        Test get_python_info returns expected Python runtime information.
      <Function test_get_dependency_versions_success>
        Test get_dependency_versions with successful pip freeze.
      <Function test_get_dependency_versions_error>
        Test get_dependency_versions with pip error.
      <Function test_get_dependency_versions_timeout>
        Test get_dependency_versions with timeout.
      <Function test_get_dependency_versions_exception>
        Test get_dependency_versions with unexpected exception.
      <Function test_get_disk_space_success>
        Test get_disk_space with valid path.
      <Function test_get_disk_space_error>
        Test get_disk_space with error.
      <Function test_sanitize_config>
        Test sanitize_config removes sensitive information.
      <Function test_get_recent_logs_file_exists>
        Test get_recent_logs with existing log file.
      <Function test_get_recent_logs_file_not_exists>
        Test get_recent_logs with non-existent log file.
      <Function test_get_recent_logs_small_file>
        Test get_recent_logs with file smaller than max_lines.
      <Function test_get_recent_logs_read_error>
        Test get_recent_logs with read error.
      <Function test_collect_diagnostics_with_logs>
        Test collect_diagnostics with logging enabled.
      <Function test_collect_diagnostics_without_logs>
        Test collect_diagnostics with logging disabled.
      <Function test_export_diagnostics_to_json>
        Test export_diagnostics_to_json.
      <Function test_export_diagnostics_to_text>
        Test export_diagnostics_to_text.
      <Function test_export_diagnostics_to_text_with_disk_error>
        Test export_diagnostics_to_text with disk space error.
      <Function test_export_diagnostics_to_text_without_logs>
        Test export_diagnostics_to_text with no log entries.
    <Module test_disk_utils.py>
      Tests for disk space utilities.
      <Function test_get_available_space>
        Test getting available disk space.
      <Function test_get_available_space_nonexistent_file>
        Test getting available space for a file that doesn't exist yet.
      <Function test_ensure_space_available_success>
        Test successful space check when enough space is available.
      <Function test_ensure_space_available_insufficient_space>
        Test space check failure when insufficient space.
      <Function test_ensure_space_available_without_buffer>
        Test space check without safety buffer.
      <Function test_format_bytes>
        Test human-readable byte formatting.
      <Function test_disk_space_error_message>
        Test DiskSpaceError message formatting.
      <Function test_ensure_space_available_with_real_write>
        Integration test: check space and write file.
      <Function test_ensure_space_available_csv_scenario>
        Test disk space check in CSV export scenario.
      <Function test_ensure_space_available_session_scenario>
        Test disk space check in session upload scenario.
      <Function test_get_available_space_error_handling>
        Test error handling when unable to get disk space.
    <Module test_e2e_integration.py>
      E2E integration tests for complete workflow: session load → analysis → export.
      
      Tests the full application flow with mocked Telegram API to ensure
      components work together correctly.
      <Class TestE2EIntegration>
        E2E integration tests for complete workflow.
        <Function test_csv_export_flow>
          Test CSV export with mock analysis results.
          
          This test ensures the export flow works:
          1. Create mock analysis results
          2. Export to CSV format
          3. Verify CSV content
          
          Note: This is a simplified E2E test focusing on the export component
          since the full flow requires complex HTMX/HTML handling.
        <Function test_session_upload_with_invalid_file>
          Test that invalid session file shows error in HTML response.
          
          Args:
              e2e_app: Test client
              isolated_tmp_dir: Isolated temp directory
              telegram_config_file: Config file fixture
        <Function test_export_csv_with_empty_results>
          Test CSV export with empty results list.
          
          Args:
              e2e_app: Test client
        <Function test_export_csv_with_unicode_content>
          Test CSV export handles Unicode characters correctly.
          
          Args:
              e2e_app: Test client
        <Function test_export_preserves_data_integrity>
          Test that CSV export preserves all data from analysis results.
          
          This ensures no data loss during the export process.
    <Module test_error_mapping.py>
      Tests for Telegram error mapping module.
      <Class TestFormatDuration>
        Tests for _format_duration helper function.
        <Function test_format_seconds>
          Test formatting seconds.
        <Function test_format_minutes>
          Test formatting minutes.
        <Function test_format_hours>
          Test formatting hours.
      <Class TestExtractWaitTime>
        Tests for _extract_wait_time helper function.
        <Function test_extract_from_seconds_attribute>
          Test extracting wait time from exception with seconds attribute.
        <Function test_extract_from_error_message>
          Test extracting wait time from error message.
        <Function test_no_wait_time_found>
          Test when no wait time can be extracted.
      <Class TestGetUserFriendlyMessage>
        Tests for get_user_friendly_message function.
        <Function test_telethon_auth_expiry_error>
          Test Telethon SessionExpiredError exception mapping.
        <Function test_auth_key_unregistered_error>
          Test auth key unregistered error mapping.
        <Function test_chat_forbidden_error>
          Test chat forbidden error mapping.
        <Function test_channel_private_error>
          Test channel private error mapping.
        <Function test_user_banned_error>
          Test user banned error mapping.
        <Function test_flood_wait_error_with_time>
          Test FloodWaitError with wait time.
        <Function test_flood_wait_error_short_time>
          Test FloodWaitError with short wait time.
        <Function test_username_invalid_error>
          Test username invalid error mapping.
        <Function test_invite_hash_expired_error>
          Test invite hash expired error mapping.
        <Function test_timeout_error>
          Test timeout error mapping.
        <Function test_unknown_error_fallback>
          Test fallback for unknown error types.
        <Function test_error_message_pattern_matching_flood>
          Test pattern matching for flood errors without known class.
        <Function test_error_message_pattern_matching_session>
          Test pattern matching for session errors without known class.
        <Function test_error_message_pattern_matching_banned>
          Test pattern matching for banned errors without known class.
        <Function test_slow_mode_wait_error>
          Test SlowModeWaitError with wait time.
      <Class TestGetErrorCategory>
        Tests for get_error_category function.
        <Function test_auth_category>
          Test authentication error category.
        <Function test_access_category>
          Test access denied error category.
        <Function test_rate_limit_category>
          Test rate limiting error category.
        <Function test_network_category>
          Test network error category.
        <Function test_invalid_input_category>
          Test invalid input error category.
        <Function test_other_category>
          Test unknown error category.
      <Class TestShouldRetryOnError>
        Tests for should_retry_on_error function.
        <Function test_retry_network_errors>
          Test that network errors should be retried.
        <Function test_no_retry_auth_errors>
          Test that auth errors should not be retried.
        <Function test_no_retry_access_errors>
          Test that access errors should not be retried.
        <Function test_no_retry_invalid_input>
          Test that invalid input errors should not be retried.
        <Function test_retry_flood_wait>
          Test that FloodWait errors can be retried (with wait).
        <Function test_retry_slow_mode>
          Test that SlowMode errors can be retried (with wait).
        <Function test_no_retry_unknown_errors>
          Test that unknown errors should not be retried by default.
      <Class TestErrorMessagesCoverage>
        Tests to ensure ERROR_MESSAGES dict is comprehensive.
        <Function test_all_error_messages_are_non_empty>
          Test that all error messages in the dict are non-empty strings.
        <Function test_error_messages_are_user_friendly>
          Test that error messages don't contain technical jargon.
        <Function test_error_messages_provide_guidance>
          Test that error messages provide actionable guidance.
        <Function test_coverage_of_common_telegram_errors>
          Test that common Telegram errors are covered.
    <Module test_error_sanitization.py>
      Tests for error message sanitization module.
      <Class TestSanitizeErrorMessageForClient>
        Tests for sanitize_error_message_for_client function.
        <Function test_safe_message_passes_through>
          Test that safe messages pass through unchanged.
        <Function test_file_path_unix_sanitized>
          Test that Unix file paths are sanitized.
        <Function test_file_path_windows_sanitized>
          Test that Windows file paths are sanitized.
        <Function test_stack_trace_sanitized>
          Test that stack traces are sanitized.
        <Function test_python_file_reference_sanitized>
          Test that Python file references are sanitized.
        <Function test_line_numbers_sanitized>
          Test that line numbers are sanitized.
        <Function test_error_class_names_sanitized>
          Test that error class names are sanitized.
        <Function test_internal_ids_sanitized>
          Test that internal IDs are sanitized.
        <Function test_hex_hashes_sanitized>
          Test that hex hashes/IDs are sanitized.
        <Function test_error_state_specific_fallback>
          Test that error state determines fallback message.
        <Function test_unknown_error_state_fallback>
          Test that unknown error states use generic fallback.
        <Function test_multiple_sensitive_patterns>
          Test message with multiple sensitive patterns.
    <Module test_events.py>
      Tests for session event bus module.
      
      Tests cover:
      - Event subscription and unsubscription
      - Event publishing to subscribers
      - Multiple subscribers receiving events
      - Subscriber isolation (one failure doesn't affect others)
      - Global event bus singleton
      <Class TestSessionEventBus>
        Tests for SessionEventBus class.
        <Function test_initialization>
          Event bus should initialize with no subscribers.
        <Coroutine test_subscribe_and_publish>
          Subscriber should receive published events.
        <Coroutine test_multiple_subscribers>
          Multiple subscribers should all receive events.
        <Coroutine test_unsubscribe>
          Unsubscribed handlers should not receive events.
        <Coroutine test_duplicate_subscription>
          Subscribing same handler twice should only register once.
        <Coroutine test_unsubscribe_nonexistent>
          Unsubscribing non-existent handler should not raise error.
        <Coroutine test_publish_without_subscribers>
          Publishing without subscribers should not raise error.
        <Coroutine test_subscriber_exception_isolation>
          One subscriber failing should not affect others.
        <Coroutine test_multiple_events>
          Subscriber should receive all published events in order.
        <Function test_clear_subscribers>
          clear_subscribers should remove all subscribers.
        <Coroutine test_async_handler_execution>
          Handlers should execute asynchronously.
      <Class TestGlobalEventBus>
        Tests for global event bus singleton.
        <Function test_get_event_bus_singleton>
          get_event_bus should return the same instance.
        <Coroutine test_global_bus_persistence>
          Global bus should maintain subscribers across get_event_bus calls.
        <Function test_reset_event_bus>
          reset_event_bus should create a new instance.
      <Class TestEventBusIntegration>
        Integration tests for event bus workflow.
        <Coroutine test_session_lifecycle_events>
          Test event bus handling typical session lifecycle.
        <Coroutine test_multiple_sessions>
          Test event bus handling multiple concurrent sessions.
      <Class TestEventThrottling>
        Tests for event throttling and rate limiting.
        <Coroutine test_deduplication>
          Duplicate consecutive events should be dropped.
        <Coroutine test_deduplication_different_status>
          Different statuses should not be deduplicated.
        <Coroutine test_rate_limiting>
          Events exceeding rate limit should be dropped.
        <Coroutine test_rate_limiting_per_session>
          Rate limiting should be per session_id.
        <Coroutine test_slow_subscriber_timeout>
          Slow subscribers should timeout and not block publishing.
        <Coroutine test_rate_limiting_window_resets>
          Rate limit should reset after time window passes.
        <Coroutine test_reset_session_status_allows_duplicate>
          reset_session_status allows same status to be sent again.
          
          This is critical for reconnect flows:
          - disconnected (initial state)
          - reset_session_status() called
          - connecting (HTMX response)
          - disconnected (SSE if reconnect fails) <- must not be dropped!
        <Function test_reset_session_status_nonexistent_session>
          reset_session_status should not raise for nonexistent session.
    <Module test_export_validation.py>
      Tests for export endpoint validation.
      
      Tests validation logic in AnalysisResultInput to ensure corrupted data
      is rejected before CSV export.
      <Class TestAnalysisResultInputValidation>
        Test AnalysisResultInput validation rules.
        <Function test_valid_input>
          Test that valid input is accepted.
        <Function test_negative_chat_id>
          Test that negative or zero chat_id is rejected.
        <Function test_negative_message_count>
          Test that negative message_count is rejected.
        <Function test_negative_unique_authors>
          Test that negative unique_authors is rejected.
        <Function test_negative_history_hours>
          Test that negative history_hours is rejected.
        <Function test_nan_history_hours>
          Test that NaN history_hours is rejected.
        <Function test_inf_history_hours>
          Test that infinite history_hours is rejected.
        <Function test_unique_authors_exceeds_message_count>
          Test that unique_authors > message_count is rejected.
        <Function test_messages_without_authors>
          Test that message_count > 0 requires unique_authors > 0.
        <Function test_inverted_date_range>
          Test that first_message_at > last_message_at is rejected.
        <Function test_future_first_message>
          Test that first_message_at in the future is rejected.
        <Function test_future_last_message>
          Test that last_message_at in the future is rejected.
        <Function test_future_analyzed_at>
          Test that analyzed_at significantly in the future is rejected.
        <Function test_analyzed_at_before_last_message>
          Test that analyzed_at before last_message_at is rejected.
        <Function test_to_analysis_result_conversion>
          Test that valid input converts to AnalysisResult correctly.
        <Function test_empty_chat_valid>
          Test that empty chat data (0 messages, 0 authors) is valid.
        <Function test_missing_optional_fields>
          Test that optional fields can be omitted.
        <Function test_all_chat_types_valid>
          Test that all chat types are accepted.
      <Class TestExportValidationEdgeCases>
        Test edge cases specific to export validation.
        <Function test_very_long_chat_title>
          Test that very long chat titles are accepted.
        <Function test_unicode_chat_title>
          Test that unicode chat titles are accepted.
        <Function test_zero_values_valid_for_empty_chat>
          Test that all zero values are valid for empty chats.
        <Function test_boundary_positive_chat_id>
          Test that chat_id = 1 (minimum valid) is accepted.
        <Function test_very_large_chat_id>
          Test that very large chat IDs are accepted.
    <Module test_exporter.py>
      Tests for CSV exporter module.
      <Class TestToCsvRows>
        Tests for to_csv_rows function.
        <Function test_empty_results_yields_header_only>
          Test that empty results yields only header row.
        <Function test_single_result>
          Test converting single result to CSV rows.
        <Function test_multiple_results>
          Test converting multiple results.
        <Function test_chat_without_username>
          Test that chats without username use tg:// link.
        <Function test_different_chat_types>
          Test that chat types are exported correctly.
        <Function test_history_hours_formatting>
          Test that history hours is formatted to 2 decimal places.
        <Function test_messages_per_hour_formatting>
          Test that messages per hour is formatted correctly.
      <Class TestExportToCsv>
        Tests for export_to_csv function.
        <Function test_returns_string>
          Test that export_to_csv returns a string.
        <Function test_includes_bom_by_default>
          Test that UTF-8 BOM is included by default.
        <Function test_can_exclude_bom>
          Test that BOM can be excluded.
        <Function test_valid_csv_format>
          Test that output is valid CSV.
        <Function test_writes_to_file>
          Test writing CSV to file.
        <Function test_file_has_bom>
          Test that file has UTF-8 BOM.
        <Function test_handles_special_characters>
          Test that special characters are properly escaped.
        <Function test_handles_unicode>
          Test that unicode characters are handled correctly.
        <Function test_empty_results_produces_header_only>
          Test that empty results produces header row only.
        <Function test_handles_rtl_characters>
          Test that RTL (right-to-left) characters are handled correctly.
        <Function test_handles_zero_width_characters>
          Test that zero-width characters are handled correctly.
        <Function test_handles_complex_emoji>
          Test complex emoji including skin tones and ZWJ sequences.
        <Function test_handles_mixed_special_characters>
          Test handling of mixed special characters in chat titles.
        <Function test_handles_newlines_in_chat_title>
          Test that newlines in chat titles are handled correctly.
        <Function test_handles_very_long_chat_names>
          Test that very long chat names are handled correctly.
        <Function test_handles_extremely_long_chat_names_with_unicode>
          Test that extremely long chat names with unicode are handled correctly.
    <Module test_first_run.py>
      Tests for first-run detection and setup.
      <Class TestFirstRun>
        Test first-run detection and setup.
        <Function test_first_run_detection>
          Test that first run is correctly detected.
        <Function test_first_run_marker_content>
          Test that first-run marker file has correct content.
        <Function test_ensure_data_dirs_returns_empty_on_success>
          Test that ensure_data_dirs returns empty list on success.
        <Function test_ensure_data_dirs_creates_log_dir_when_enabled>
          Test that ensure_data_dirs creates log directory when log_to_file is enabled.
        <Function test_ensure_data_dirs_handles_permission_errors_gracefully>
          Test that ensure_data_dirs handles permission errors gracefully.
        <Function test_first_run_marker_path_property>
          Test first_run_marker_path property.
    <Module test_fuzz_parsing.py>
      Fuzz testing for session and JSON file parsing.
      
      This module uses property-based testing with Hypothesis to fuzz test:
      - Telethon session file (.session) parsing and validation
      - JSON config file parsing and validation
      - Account metadata JSON parsing
      
      The goal is to ensure parsers handle malformed, corrupted, and edge-case
      inputs gracefully without crashes or security vulnerabilities.
      <Class TestFuzzSessionFile>
        Fuzz tests for session file parsing and validation.
        <Function test_fuzz_random_bytes_as_session>
          Fuzz test with random bytes written to .session file.
          
          The validator should handle arbitrary binary data gracefully
          without crashing or raising unexpected exceptions.
        <Function test_fuzz_valid_sqlite_random_data>
          Fuzz test with valid SQLite structure but random data values.
          
          Tests whether the validator properly handles valid SQLite databases
          with arbitrary data in the expected tables.
        <Function test_fuzz_truncated_sqlite_file>
          Test handling of truncated SQLite database files.
          
          Simulates corrupted or incomplete file downloads.
        <Function test_fuzz_corrupted_sqlite_header>
          Test handling of corrupted SQLite header bytes.
        <Function test_fuzz_appended_garbage>
          Test handling of valid SQLite with garbage data appended.
          
          Some file corruption scenarios involve extra bytes at the end.
      <Class TestFuzzConfigJSON>
        Fuzz tests for JSON config file parsing.
        <Function test_fuzz_random_json_strings>
          Fuzz test with random strings that might be parsed as JSON.
          
          The config parser should handle malformed JSON gracefully
          without crashes or unhandled exceptions.
        <Function test_fuzz_config_dictionary_values>
          Fuzz test with various dictionary structures as config.
          
          Tests type validation and required field checks.
        <Function test_fuzz_config_field_types>
          Fuzz test with various types for api_id and api_hash fields.
        <Function test_fuzz_invalid_utf8_sequences>
          Test handling of invalid UTF-8 byte sequences in JSON files.
        <Function test_fuzz_deeply_nested_json>
          Test handling of deeply nested JSON structures.
          
          Deep nesting can cause stack overflow or performance issues.
      <Class TestFuzzAccountMetadata>
        Fuzz tests for account metadata JSON parsing.
        <Function test_fuzz_account_metadata_fields>
          Fuzz test account metadata with various field types.
          
          Account metadata files store information about Telegram accounts.
        <Function test_fuzz_arbitrary_metadata_dict>
          Fuzz test with arbitrary dictionary structures as metadata.
      <Class TestFuzzFileSizeLimits>
        Fuzz tests for file size limit enforcement.
        <Function test_fuzz_session_file_size_boundaries>
          Test session file handling near size limit boundaries.
          
          The session upload has a 10MB size limit.
        <Function test_fuzz_config_file_size_boundaries>
          Test config file handling near size limit boundaries.
          
          The config upload has a 1KB size limit.
    <Module test_graceful_shutdown.py>
      Tests for graceful shutdown handling.
      <Class TestGracefulShutdownMiddleware>
        Tests for graceful shutdown middleware.
        <Function test_middleware_tracks_active_connections>
          Test that middleware tracks active connections.
        <Function test_rejects_requests_during_shutdown>
          Test that new requests are rejected during shutdown.
        <Function test_health_check_fails_during_shutdown>
          Test that health check returns 503 during shutdown.
      <Class TestLifespanShutdown>
        Tests for lifespan shutdown handling.
        <Coroutine test_lifespan_initializes_app_state>
          Test that lifespan initializes app state.
        <Coroutine test_shutdown_waits_for_active_connections>
          Test that shutdown waits for active connections to complete.
      <Class TestAppState>
        Tests for AppState class.
        <Function test_app_state_initialization>
          Test AppState initializes with correct defaults.
        <Function test_app_state_tracks_connections>
          Test AppState can track connections.
        <Function test_app_state_shutdown_flag>
          Test AppState shutdown flag.
    <Module test_history.py>
      Tests for analysis history functionality.
      <Class TestDatabaseHistoryMethods>
        Test database methods for history functionality.
        <Function test_load_completed_tasks_all>
          Test loading all completed tasks.
        <Function test_load_completed_tasks_pagination>
          Test loading completed tasks with pagination.
        <Function test_load_completed_tasks_status_filter>
          Test loading completed tasks with status filter.
        <Function test_count_completed_tasks>
          Test counting completed tasks.
        <Function test_count_completed_tasks_with_filter>
          Test counting with status filter.
        <Function test_load_completed_tasks_with_results>
          Test that completed tasks include their results.
      <Class TestTaskQueueHistoryPreservation>
        Test that TaskQueue preserves history in database.
        <Function test_clear_completed_preserves_database>
          Test that clear_completed removes from memory but not from database.
        <Function test_get_task_with_include_historical>
          Test retrieving historical tasks from database.
      <Class TestHistoryAPI>
        Test history API endpoints.
        <Function test_list_history_endpoint>
          Test GET /api/history endpoint.
        <Function test_list_history_pagination>
          Test pagination in history list.
        <Function test_list_history_status_filter>
          Test status filtering in history list.
        <Function test_get_task_history_detail>
          Test GET /api/history/{task_id} endpoint.
        <Function test_get_nonexistent_task_history>
          Test requesting history for nonexistent task.
        <Function test_history_stats_endpoint>
          Test GET /api/history/stats endpoint.
    <Module test_i18n_middleware.py>
      Tests for i18n locale middleware.
      
      Tests cover:
      - LocaleMiddleware: language detection and setting
      - _detect_locale: detection from cookie, query param, header
      - _parse_accept_language: Accept-Language header parsing
      <Class TestLocaleMiddleware>
        Tests for LocaleMiddleware class.
        <Coroutine test_sets_locale_from_cookie>
          Should detect locale from cookie.
        <Coroutine test_sets_locale_from_query_param>
          Should detect locale from query param.
        <Coroutine test_sets_cookie_on_response>
          Should set lang cookie on response.
      <Class TestDetectLocale>
        Tests for _detect_locale method.
        <Function test_from_cookie>
          Should detect from cookie first.
        <Function test_from_query_param>
          Should detect from query param second.
        <Function test_from_accept_language>
          Should detect from Accept-Language header.
        <Function test_fallback_to_default>
          Should fall back to default.
        <Function test_ignores_unsupported_locale>
          Should ignore unsupported locales.
      <Class TestParseAcceptLanguage>
        Tests for _parse_accept_language method.
        <Function test_simple_header>
          Should parse simple Accept-Language.
        <Function test_with_quality>
          Should parse with quality values.
        <Function test_with_region>
          Should extract language from region code.
        <Function test_multiple_languages>
          Should return first supported language.
        <Function test_no_supported>
          Should return None if no supported language.
        <Function test_empty_header>
          Should return None for empty header.
        <Function test_malformed_quality>
          Should handle malformed quality values.
    <Module test_importer_google_sheets.py>
      Comprehensive tests for Google Sheets importer module.
      <Class TestExtractSheetId>
        Tests for extract_sheet_id function.
        <Function test_extract_from_full_url>
          Test extracting ID from full Google Sheets URL.
        <Function test_extract_from_url_without_gid>
          Test extracting ID from URL without GID.
        <Function test_extract_from_url_without_https>
          Test extracting ID from URL without https prefix.
        <Function test_extract_from_http_url>
          Test extracting ID from http (not https) URL.
        <Function test_extract_with_underscores_and_dashes>
          Test extracting ID with underscores and dashes.
        <Function test_extract_from_short_url>
          Test extracting ID from short URL without /edit suffix.
        <Function test_extract_case_insensitive>
          Test that URL matching is case insensitive.
        <Function test_extract_with_query_params>
          Test extracting ID from URL with query parameters.
        <Function test_extract_with_multiple_path_segments>
          Test extracting ID from URL with additional path segments.
        <Function test_invalid_url_raises_error>
          Test that invalid URL raises GoogleSheetsError.
        <Function test_empty_url_raises_error>
          Test that empty URL raises GoogleSheetsError.
        <Function test_google_docs_url_raises_error>
          Test that Google Docs URL (not Sheets) raises error.
        <Function test_malformed_sheets_url_raises_error>
          Test that malformed Sheets URL raises error.
      <Class TestExtractGid>
        Tests for extract_gid function.
        <Function test_extract_from_fragment>
          Test extracting GID from URL fragment.
        <Function test_extract_from_query_params>
          Test extracting GID from query parameters.
        <Function test_no_gid_returns_none>
          Test that URL without GID returns None.
        <Function test_empty_url_returns_none>
          Test that empty URL returns None.
        <Function test_gid_zero>
          Test extracting GID with value 0.
        <Function test_fragment_takes_priority_over_query>
          Test that fragment GID takes priority over query GID.
        <Function test_fragment_with_multiple_params>
          Test extracting GID from fragment with multiple parameters.
        <Function test_query_with_multiple_params>
          Test extracting GID from query with multiple parameters.
        <Function test_url_without_scheme>
          Test extracting GID from URL without scheme.
      <Class TestBuildCsvExportUrl>
        Tests for build_csv_export_url function.
        <Function test_build_without_gid>
          Test building export URL without GID.
        <Function test_build_with_gid>
          Test building export URL with GID.
        <Function test_build_with_gid_zero>
          Test building export URL with GID 0.
        <Function test_build_with_gid_none>
          Test building export URL with explicit None GID.
        <Function test_build_with_complex_sheet_id>
          Test building export URL with complex sheet ID.
      <Class TestIsGoogleSheetsUrl>
        Tests for is_google_sheets_url function.
        <Function test_valid_sheets_url>
          Test that valid Sheets URL returns True.
        <Function test_sheets_url_without_https>
          Test that Sheets URL without https returns True.
        <Function test_case_insensitive_match>
          Test that matching is case insensitive.
        <Function test_non_sheets_url>
          Test that non-Sheets URL returns False.
        <Function test_google_docs_url>
          Test that Google Docs URL returns False.
        <Function test_empty_url>
          Test that empty URL returns False.
        <Function test_partial_match>
          Test that partial match in larger text returns True.
      <Class TestFetchGoogleSheet>
        Tests for fetch_google_sheet async function.
        <Coroutine test_successful_fetch>
          Test successful fetching and parsing of Google Sheet.
        <Coroutine test_fetch_with_custom_timeout>
          Test that custom timeout is passed to AsyncClient.
        <Coroutine test_fetch_builds_correct_export_url>
          Test that correct CSV export URL is built and requested.
        <Coroutine test_invalid_url_raises_error>
          Test that invalid URL raises GoogleSheetsError immediately.
        <Coroutine test_timeout_error>
          Test that timeout exception is caught and wrapped.
        <Coroutine test_404_error>
          Test that 404 error is caught with appropriate message.
        <Coroutine test_403_error>
          Test that 403 error is caught with appropriate message.
        <Coroutine test_500_error>
          Test that 500 error is caught with generic HTTP error message.
        <Coroutine test_request_error>
          Test that general request error is caught and wrapped.
        <Coroutine test_html_response_error>
          Test that HTML response (instead of CSV) raises error.
        <Coroutine test_parse_error_wrapped>
          Test that ParseError is caught and wrapped in GoogleSheetsError.
        <Coroutine test_empty_sheet>
          Test fetching empty sheet returns empty list.
        <Coroutine test_sheet_with_headers_only>
          Test fetching sheet with only headers.
        <Coroutine test_sheet_with_multiple_columns>
          Test fetching sheet with multiple columns.
        <Coroutine test_sheet_with_links>
          Test fetching sheet with Telegram links.
        <Coroutine test_sheet_with_numeric_ids>
          Test fetching sheet with numeric chat IDs.
        <Coroutine test_sheet_with_comments_and_empty_lines>
          Test that comments and empty lines are filtered out.
        <Coroutine test_fetch_without_gid>
          Test fetching sheet without GID (default to first sheet).
        <Coroutine test_content_type_with_charset>
          Test that content-type with charset is handled correctly.
        <Coroutine test_missing_content_type_header>
          Test handling of missing content-type header.
      <Class TestGoogleSheetsError>
        Tests for GoogleSheetsError exception class.
        <Function test_exception_can_be_raised>
          Test that GoogleSheetsError can be raised.
        <Function test_exception_message>
          Test that exception message is preserved.
        <Function test_exception_is_exception_subclass>
          Test that GoogleSheetsError is a subclass of Exception.
        <Function test_exception_with_empty_message>
          Test creating exception with empty message.
      <Class TestEdgeCases>
        Tests for edge cases and boundary conditions.
        <Function test_extract_sheet_id_with_very_long_id>
          Test extracting very long sheet ID.
        <Function test_extract_gid_with_very_large_number>
          Test extracting very large GID number.
        <Function test_is_google_sheets_url_with_special_characters>
          Test URL detection with special characters in path.
        <Coroutine test_fetch_with_unicode_content>
          Test fetching sheet with Unicode characters.
        <Function test_extract_sheet_id_preserves_case>
          Test that sheet ID case is preserved.
        <Function test_build_csv_export_url_with_empty_string_gid>
          Test that empty string GID is treated as falsy.
    <Module test_importer_parser.py>
      Comprehensive tests for chat list parser module.
      
      Tests all parsers (text, CSV, Excel) with various formats, encodings,
      edge cases, and error conditions to achieve maximum coverage.
      <Class TestChatListEntry>
        Tests for ChatListEntry model validation.
        <Function test_valid_username_entry>
          Test creating a valid username entry.
        <Function test_valid_link_entry>
          Test creating a valid link entry.
        <Function test_valid_id_entry>
          Test creating a valid ID entry.
        <Function test_empty_value_rejected>
          Test that empty value is rejected.
        <Function test_whitespace_only_value_rejected>
          Test that whitespace-only value is rejected.
        <Function test_value_is_stripped>
          Test that value is stripped of whitespace.
        <Function test_model_is_frozen>
          Test that ChatListEntry is immutable.
        <Function test_extra_fields_forbidden>
          Test that extra fields are rejected.
      <Class TestPatterns>
        Tests for regex patterns.
        <Function test_telegram_link_pattern_https>
          Test Telegram link pattern with https.
        <Function test_telegram_link_pattern_http>
          Test Telegram link pattern with http.
        <Function test_telegram_link_pattern_no_protocol>
          Test Telegram link pattern without protocol.
        <Function test_telegram_link_pattern_telegram_me>
          Test Telegram link pattern with telegram.me.
        <Function test_telegram_link_pattern_joinchat>
          Test Telegram link pattern with joinchat.
        <Function test_telegram_link_pattern_plus_prefix>
          Test Telegram link pattern with + prefix.
        <Function test_telegram_link_pattern_case_insensitive>
          Test Telegram link pattern is case insensitive.
        <Function test_username_pattern_with_at>
          Test username pattern with @ prefix.
        <Function test_username_pattern_without_at>
          Test username pattern without @ prefix.
        <Function test_username_pattern_minimum_length>
          Test username pattern minimum length (4 chars).
        <Function test_username_pattern_maximum_length>
          Test username pattern maximum length (32 chars).
        <Function test_username_pattern_must_start_with_letter>
          Test username must start with a letter.
        <Function test_username_pattern_allows_underscores>
          Test username can contain underscores.
        <Function test_numeric_id_pattern_positive>
          Test numeric ID pattern with positive numbers.
        <Function test_numeric_id_pattern_negative>
          Test numeric ID pattern with negative numbers.
        <Function test_numeric_id_pattern_rejects_non_numeric>
          Test numeric ID pattern rejects non-numeric input.
      <Class TestClassifyEntry>
        Tests for _classify_entry function.
        <Function test_empty_string_returns_none>
          Test that empty string returns None.
        <Function test_whitespace_only_returns_none>
          Test that whitespace-only string returns None.
        <Function test_comment_line_returns_none>
          Test that comment lines are skipped.
        <Function test_telegram_link_https>
          Test classifying https Telegram link.
        <Function test_telegram_link_normalized_lowercase>
          Test that Telegram link username is normalized to lowercase.
        <Function test_telegram_link_without_protocol>
          Test classifying Telegram link without protocol.
        <Function test_numeric_id_positive>
          Test classifying positive numeric ID.
        <Function test_numeric_id_negative>
          Test classifying negative numeric ID.
        <Function test_username_with_at>
          Test classifying username with @ prefix.
        <Function test_username_without_at>
          Test classifying username without @ prefix.
        <Function test_username_normalized_lowercase>
          Test that username is normalized to lowercase.
        <Function test_short_username_fallback>
          Test that short usernames (< 4 chars) use fallback logic.
        <Function test_username_with_special_chars_fallback>
          Test that usernames with special chars use fallback logic.
        <Function test_whitespace_stripped_before_classification>
          Test that whitespace is stripped before classification.
        <Function test_single_char_returns_none>
          Test that single character returns None.
        <Function test_mixed_case_link>
          Test link with mixed case.
        <Function test_joinchat_link>
          Test joinchat link format.
      <Class TestParseText>
        Tests for parse_text function.
        <Function test_empty_string>
          Test parsing empty string.
        <Function test_empty_bytes>
          Test parsing empty bytes.
        <Function test_single_username>
          Test parsing single username.
        <Function test_multiple_usernames>
          Test parsing multiple usernames.
        <Function test_mixed_entry_types>
          Test parsing mixed entry types.
        <Function test_skip_empty_lines>
          Test that empty lines are skipped.
        <Function test_skip_comment_lines>
          Test that comment lines are skipped.
        <Function test_utf8_decoding>
          Test UTF-8 decoding of bytes.
        <Function test_cp1251_decoding>
          Test CP1251 decoding fallback.
        <Function test_invalid_encoding_raises_parse_error>
          Test that invalid encoding raises ParseError.
          
          Note: It's difficult to create a byte sequence that fails both UTF-8 and CP1251
          decoding, as CP1251 is quite permissive. This test documents the expected behavior.
        <Function test_string_input_no_decoding>
          Test that string input is used directly.
        <Function test_windows_line_endings>
          Test parsing with Windows line endings.
        <Function test_mac_line_endings>
          Test parsing with old Mac line endings.
        <Function test_mixed_line_endings>
          Test parsing with mixed line endings.
      <Class TestParseCsv>
        Tests for parse_csv function.
        <Function test_empty_csv>
          Test parsing empty CSV.
        <Function test_single_column_no_header>
          Test parsing single column without header.
        <Function test_single_column_with_header>
          Test parsing single column with recognized header.
        <Function test_multiple_columns_username_header>
          Test parsing multiple columns with username header.
        <Function test_multiple_columns_chat_header>
          Test parsing multiple columns with chat header.
        <Function test_multiple_columns_link_header>
          Test parsing multiple columns with link header.
        <Function test_multiple_columns_id_header>
          Test parsing multiple columns with id header.
        <Function test_semicolon_delimiter>
          Test parsing CSV with semicolon delimiter.
        <Function test_tab_delimiter>
          Test parsing CSV with tab delimiter.
        <Function test_delimiter_detection_fallback>
          Test that delimiter detection falls back to comma.
        <Function test_no_recognized_header_includes_first_row>
          Test that first row is included when no header is recognized.
        <Function test_skip_empty_cells>
          Test that empty cells are skipped.
        <Function test_column_index_out_of_range>
          Test handling of rows with fewer columns.
        <Function test_utf8_csv>
          Test UTF-8 encoded CSV.
        <Function test_cp1251_csv>
          Test CP1251 encoded CSV.
        <Function test_invalid_csv_encoding>
          Test that invalid encoding raises ParseError.
          
          Note: CP1251 is very permissive, so this tests the expected behavior.
        <Function test_all_known_column_names>
          Test that all known column names are recognized.
        <Function test_case_insensitive_headers>
          Test that headers are case insensitive.
        <Function test_header_with_whitespace>
          Test that headers with whitespace are handled.
        <Function test_quoted_fields>
          Test CSV with quoted fields.
      <Class TestParseXlsx>
        Tests for parse_xlsx function.
        <Function test_openpyxl_not_installed>
          Test that missing openpyxl raises ParseError.
        <Function test_empty_workbook>
          Test parsing empty workbook.
        <Function test_single_column_no_header>
          Test parsing single column without header.
        <Function test_single_column_with_header>
          Test parsing single column with recognized header.
        <Function test_multiple_columns_username_header>
          Test parsing multiple columns with username header.
        <Function test_skip_empty_cells>
          Test that empty cells are skipped.
        <Function test_invalid_excel_file>
          Test that invalid Excel file raises ParseError.
        <Function test_all_known_column_names>
          Test that all known column names are recognized.
        <Function test_case_insensitive_headers>
          Test that headers are case insensitive.
        <Function test_numeric_cells_converted_to_string>
          Test that numeric cells are converted to strings.
      <Class TestParseChatList>
        Tests for parse_chat_list function.
        <Function test_txt_extension>
          Test parsing .txt file.
        <Function test_csv_extension>
          Test parsing .csv file.
        <Function test_xlsx_extension>
          Test parsing .xlsx file.
        <Function test_xls_extension>
          Test parsing .xls file (treated as xlsx).
        <Function test_unknown_extension_with_pk_header>
          Test auto-detection of xlsx by PK header.
        <Function test_unknown_extension_tries_csv_then_text>
          Test that unknown extension tries CSV then falls back to text.
        <Function test_unknown_extension_fallback_to_text>
          Test fallback to text parser for unknown extension.
        <Function test_unknown_extension_csv_parse_error_fallback>
          Test that ParseError in CSV parsing falls back to text parsing.
        <Function test_case_insensitive_extension>
          Test that extension matching is case insensitive.
        <Function test_extension_with_path>
          Test that extension is detected from full path.
      <Class TestEdgeCasesAndErrors>
        Tests for edge cases and error conditions.
        <Function test_very_long_username>
          Test handling of very long usernames.
        <Function test_unicode_usernames>
          Test handling of unicode usernames.
        <Function test_mixed_valid_and_invalid_entries>
          Test that valid entries are parsed even with invalid ones.
          
          Note: The parser is lenient and tries to parse most entries using
          fallback logic, so 'invalid!!!entry' might be accepted as a username.
        <Function test_duplicate_entries_not_deduplicated>
          Test that duplicate entries are not automatically removed.
        <Function test_link_with_query_params>
          Test link with query parameters.
        <Function test_csv_with_bom>
          Test CSV with UTF-8 BOM.
          
          Note: BOM is part of the header, so it won't match known columns.
          The parser will treat the first row as data.
        <Function test_csv_with_empty_rows>
          Test CSV with empty rows.
        <Function test_text_with_only_comments>
          Test text file with only comments.
        <Function test_text_with_only_empty_lines>
          Test text file with only empty lines.
        <Function test_negative_zero_id>
          Test handling of -0 as ID.
        <Function test_very_large_numeric_id>
          Test handling of very large numeric IDs.
        <Function test_whitespace_in_middle_of_value>
          Test that internal whitespace is preserved.
        <Function test_parse_error_exception>
          Test ParseError exception properties.
        <Function test_chat_list_entry_type_enum_values>
          Test ChatListEntryType enum values.
      <Class TestIntegration>
        Integration tests combining multiple functions.
        <Function test_real_world_text_file>
          Test parsing a realistic text file with mixed content.
        <Function test_real_world_csv_file>
          Test parsing a realistic CSV export.
        <Function test_round_trip_text_to_entries>
          Test that parsed entries maintain their original values.
        <Function test_normalization_consistency>
          Test that normalization is consistent across formats.
    <Module test_key_manager.py>
      Tests for secure encryption key management.
      <Class TestEnvironmentBackend>
        Test environment variable-based key storage.
        <Function test_get_key_not_found>
          Test retrieving non-existent key returns None.
        <Function test_set_and_get_key>
          Test storing and retrieving key.
        <Function test_delete_key>
          Test deleting key.
        <Function test_multiple_keys>
          Test storing multiple keys with different IDs.
        <Function test_env_var_name_format>
          Test environment variable naming convention.
        <Function test_invalid_base64_raises_error>
          Test that invalid base64 in env var raises error.
      <Class TestPasswordBackend>
        Test password-derived key storage.
        <Function test_requires_password>
          Test that password is required.
        <Function test_accepts_password_parameter>
          Test initialization with password parameter.
        <Function test_accepts_password_from_env>
          Test initialization from environment variable.
        <Function test_deterministic_key_derivation>
          Test that same password produces same key.
        <Function test_different_passwords_produce_different_keys>
          Test that different passwords produce different keys.
        <Function test_different_key_ids_produce_different_keys>
          Test that different key IDs produce different keys.
        <Function test_set_key_validates_match>
          Test that set_key validates key matches derived key.
        <Function test_set_key_accepts_matching_key>
          Test that set_key accepts matching derived key.
        <Function test_delete_key_is_noop>
          Test that delete_key is a no-op for derived keys.
      <Class TestMachineKeyBackend>
        Test machine-specific key derivation.
        <Function test_get_key_returns_consistent_key>
          Test that machine key is consistent across calls.
        <Function test_key_id_ignored>
          Test that key_id parameter is ignored.
        <Function test_key_is_valid_fernet_key>
          Test that derived key is valid for Fernet.
        <Function test_set_key_is_noop>
          Test that set_key is a no-op.
        <Function test_delete_key_is_noop>
          Test that delete_key is a no-op.
      <Class TestKeyManager>
        Test KeyManager orchestration.
        <Function test_create_with_environment_backend>
          Test creating KeyManager with environment backend.
        <Function test_create_with_password_backend>
          Test creating KeyManager with password backend.
        <Function test_create_with_machine_backend>
          Test creating KeyManager with machine backend.
        <Function test_create_with_invalid_backend>
          Test that invalid backend type raises error.
        <Function test_create_auto_tries_environment_first>
          Test that auto mode tries environment variables.
        <Function test_create_auto_tries_password_from_env>
          Test that auto mode tries password from environment.
        <Function test_create_auto_falls_back_to_machine>
          Test that auto mode falls back to machine backend.
        <Function test_get_key_returns_none_for_missing>
          Test that get_key returns None for missing keys.
        <Function test_get_or_create_key_creates_new_key>
          Test that get_or_create_key creates new key if missing.
        <Function test_get_or_create_key_returns_existing>
          Test that get_or_create_key returns existing key.
        <Function test_set_key_validates_length>
          Test that set_key validates key length.
        <Function test_set_key_calls_backend>
          Test that set_key delegates to backend.
        <Function test_delete_key_calls_backend>
          Test that delete_key delegates to backend.
        <Function test_rotate_key_generates_new_key>
          Test that rotate_key generates new key.
        <Function test_rotate_key_requires_old_key_exists>
          Test that rotate_key requires old key to exist.
        <Function test_rotate_key_keeps_old_key>
          Test that rotate_key doesn't delete old key.
      <Class TestKeyManagerIntegration>
        Integration tests with EncryptedStorage.
        <Function test_encrypted_storage_with_environment_backend>
          Test EncryptedStorage using environment backend.
        <Function test_encrypted_storage_with_password_backend>
          Test EncryptedStorage using password backend.
        <Function test_encrypted_storage_with_machine_backend>
          Test EncryptedStorage using machine backend.
        <Function test_encrypted_storage_backward_compatible>
          Test that EncryptedStorage still works without KeyManager.
        <Function test_cross_backend_compatibility>
          Test that files encrypted with one backend can be read by another.
    <Module test_leak_detection.py>
      Tests to verify memory leak detection is working correctly.
      
      These tests intentionally create memory leaks to ensure the detection
      mechanism catches them properly.
      <Function test_no_leak>
        Test that passes with no memory leak.
      <Function test_intentional_leak_with_skip_marker>
        Test with intentional leak but skip marker.
      <Function test_small_allocation>
        Test with small memory allocation within threshold.
      <Function test_large_leak_example>
        Example test that would fail leak detection.
        
        This test is skipped by default but shows how a leak would be detected.
        To test leak detection, run with:
            pytest tests/test_leak_detection.py::test_large_leak_example --detect-leaks -v
      <Function test_cleanup_after_use>
        Test that properly cleans up after use.
    <Module test_loading_states.py>
      Tests for loading states on action buttons.
      
      Tests cover loading state display for all 6 action types:
      - Connect button
      - Disconnect button
      - Reconnect button
      - Send Code (Enter Verification Code)
      - Verify Code (2FA modal)
      - Verify 2FA Password
      
      Each test verifies:
      - Button becomes disabled on click
      - Spinner appears in status cell
      - After response: button is replaced/hidden, status updates
      <Class TestLoadingStateConnect>
        Tests for Connect button loading state.
        <Function test_connect_button_has_htmx_attributes>
          Connect button should have proper htmx attributes.
        <Function test_connect_button_disabled_during_loading>
          When connecting, button should show disabled state with spinner.
      <Class TestLoadingStateDisconnect>
        Tests for Disconnect button loading state.
        <Function test_disconnect_button_has_htmx_attributes>
          Disconnect button should have proper htmx attributes.
        <Function test_disconnect_button_target_and_swap>
          Disconnect button should target session row and swap outerHTML.
      <Class TestLoadingStateReconnect>
        Tests for Reconnect button loading state.
        <Function test_connect_button_for_disconnected_with_session_file>
          Connect button should appear for disconnected session with session file.
        <Function test_connect_button_target_and_swap>
          Connect button should target session row and swap outerHTML.
      <Class TestLoadingStateSendCode>
        Tests for Send Code (Enter Verification Code) button loading state.
        <Function test_code_modal_button_appears_for_needs_code>
          Code modal button should appear when session needs verification code.
        <Function test_code_modal_button_has_session_data>
          Code modal button should include session_id and auth_id data attributes.
      <Class TestLoadingStateVerifyCode>
        Tests for Verify Code modal submission loading state.
        <Function test_code_form_has_loading_attributes>
          Code verification form should have loading state attributes.
          
          Note: This test verifies the button exists and can be interacted with.
          The actual modal form testing is done in test_sessions_router.py.
        <Function test_code_modal_button_accessible>
          Code modal button should have proper accessibility attributes.
      <Class TestLoadingStateVerify2FA>
        Tests for Verify 2FA Password button loading state.
        <Function test_2fa_modal_button_appears_for_needs_2fa>
          2FA modal button should appear when session needs 2FA password.
        <Function test_2fa_modal_button_has_session_data>
          2FA modal button should include session_id and auth_id data attributes.
        <Function test_2fa_modal_button_accessible>
          2FA modal button should have proper accessibility attributes.
      <Class TestStatusCellSpinner>
        Tests for spinner display in status cell during state transitions.
        <Function test_status_cell_shows_spinner_when_connecting>
          Status cell should show spinner and 'Connecting' text during connection.
        <Function test_status_cell_updates_after_connection>
          Status cell should show connected state after successful connection.
        <Function test_status_cell_updates_after_disconnection>
          Status cell should show disconnected state after successful disconnection.
      <Class TestAllActionTypesComplete>
        Integration test: All 6 action types have loading state support.
        <Function test_all_six_action_types_present>
          Template should support all 6 action types with loading states.
          
          The 6 action types are:
          1. Connect
          2. Disconnect
          3. Reconnect
          4. Send Code (Enter Verification Code)
          5. Verify Code (via modal)
          6. Verify 2FA Password
        <Function test_all_action_types_have_loading_states>
          All action types should have proper loading state handling.
    <Module test_logging.py>
      Tests for logging configuration and functionality.
      <Function test_setup_logging_console_only>
        Test logging setup with console output only.
      <Function test_setup_logging_debug_mode>
        Test logging setup in debug mode overrides log level.
      <Function test_setup_logging_with_file>
        Test logging setup with file handler.
      <Function test_setup_logging_file_rotation>
        Test that log rotation works correctly.
      <Function test_setup_logging_invalid_path>
        Test graceful handling of invalid log file path.
      <Function test_setup_logging_format>
        Test that log format is correct.
      <Function test_logging_levels>
        Test different logging levels.
      <Function test_setup_logging_clears_existing_handlers>
        Test that setup_logging clears existing handlers.
      <Function test_log_sanitization_session_tokens>
        Test that session tokens are sanitized from logs.
      <Function test_log_sanitization_phone_numbers>
        Test that phone numbers are sanitized from logs.
      <Function test_log_sanitization_ip_addresses>
        Test that IP addresses (IPv4 and IPv6) are sanitized from logs.
      <Function test_log_sanitization_bot_tokens>
        Test that bot tokens are sanitized from logs.
      <Function test_log_sanitization_api_hash>
        Test that api_hash values are sanitized from logs.
      <Function test_correlation_id_in_logs>
        Test that correlation IDs appear in log messages.
      <Function test_correlation_id_context_isolation>
        Test that correlation IDs are properly isolated in context.
      <Function test_generate_correlation_id>
        Test correlation ID generation.
      <Function test_exception_traceback_sanitization>
        Test that exception tracebacks are sanitized when logged.
      <Function test_exception_with_bot_token_sanitization>
        Test that bot tokens in exceptions are sanitized.
      <Function test_sanitize_text_function>
        Test the standalone sanitize_text function.
      <Function test_sanitizing_formatter_directly>
        Test SanitizingFormatter directly.
      <Function test_json_formatter>
        Test JSONFormatter outputs valid JSON with required fields.
      <Function test_json_formatter_sanitizes_sensitive_data>
        Test JSONFormatter sanitizes sensitive data in messages.
      <Function test_json_formatter_includes_extra_fields>
        Test JSONFormatter includes extra fields from log record.
      <Function test_chat_context_filter>
        Test ChatContextFilter adds chat_id to log records.
      <Function test_chat_context_functions>
        Test chat context set/get/clear functions.
      <Function test_timing_context>
        Test TimingContext measures operation duration.
      <Function test_timing_context_decorator>
        Test TimingContext decorator works for functions.
      <Function test_module_log_levels>
        Test per-module log level configuration.
      <Function test_setup_logging_with_json_format>
        Test setup_logging with JSON format.
      <Function test_setup_logging_with_verbose_mode>
        Test setup_logging with verbose mode enables DEBUG level.
      <Function test_setup_logging_with_module_levels>
        Test setup_logging configures per-module log levels.
      <Function test_log_format_with_chat_id>
        Test that logs include chat ID when set.
    <Module test_main_module.py>
      Comprehensive tests for src/chatfilter/main.py module.
      
      Tests cover:
      - setup_logging function with various configurations
      - main function with different CLI arguments
      - Error handling and edge cases
      - File logging with rotation
      - Module-level logging configuration
      - CLI argument parsing
      - Configuration validation flows
      - Self-test flows
      <Class TestSetupLogging>
        Test suite for setup_logging function.
        <Function test_setup_logging_console_only_default>
          Test logging setup with console output only (default behavior).
        <Function test_setup_logging_debug_mode_overrides_level>
          Test that debug=True overrides the level parameter to DEBUG.
        <Function test_setup_logging_verbose_mode_enables_debug>
          Test that verbose=True enables DEBUG level.
        <Function test_setup_logging_warning_level>
          Test logging setup with WARNING level.
        <Function test_setup_logging_error_level>
          Test logging setup with ERROR level.
        <Function test_setup_logging_invalid_level_falls_back_to_info>
          Test that invalid log level falls back to INFO.
        <Function test_setup_logging_clears_existing_handlers>
          Test that setup_logging clears existing handlers to avoid duplicates.
        <Function test_setup_logging_with_file_creates_handlers>
          Test logging setup with file handler creates both console and file handlers.
        <Function test_setup_logging_file_handler_configuration>
          Test that file handler is configured with correct rotation settings.
        <Function test_setup_logging_file_creates_log_directory>
          Test that setup_logging creates parent directories for log file.
        <Function test_setup_logging_file_writes_to_file>
          Test that file logging actually writes log messages to the file.
        <Function test_setup_logging_file_permission_error_graceful_degradation>
          Test that permission errors on file logging degrade gracefully to console-only.
        <Function test_setup_logging_json_format>
          Test logging setup with JSON formatter.
        <Function test_setup_logging_text_format>
          Test logging setup with text formatter (default).
        <Function test_setup_logging_adds_filters_to_handlers>
          Test that setup_logging adds required filters to all handlers.
        <Function test_setup_logging_module_levels_configuration>
          Test that module-level log levels are configured correctly.
        <Function test_setup_logging_no_module_levels>
          Test that module levels are not configured when None.
        <Function test_setup_logging_verbose_without_debug_logs_message>
          Test that verbose mode enables DEBUG level (same as debug).
        <Function test_setup_logging_debug_and_verbose_both_set_debug_level>
          Test that when both debug and verbose are True, level is DEBUG.
        <Function test_setup_logging_file_with_utf8_encoding>
          Test that file handler uses UTF-8 encoding.
        <Function test_setup_logging_console_outputs_to_stdout>
          Test that console handler outputs to stdout.
      <Class TestMain>
        Test suite for main function.
        <Function test_main_version_argument_exits>
          Test that --version prints version and exits.
        <Function test_main_help_argument_exits>
          Test that --help prints help and exits.
        <Function test_main_validate_argument_success>
          Test --validate argument with valid configuration exits successfully.
        <Function test_main_validate_argument_with_errors>
          Test --validate argument with configuration errors exits with error code.
        <Function test_main_validate_argument_with_warnings>
          Test --validate argument with warnings but no errors exits successfully.
        <Function test_main_check_config_deprecated_still_works>
          Test that deprecated --check-config still works like --validate.
        <Function test_main_self_test_success>
          Test --self-test argument with all tests passing exits successfully.
        <Function test_main_self_test_failures>
          Test --self-test argument with failures exits with error code.
        <Function test_main_cli_overrides_env_settings>
          Test that CLI arguments override environment settings.
        <Function test_main_calls_setup_logging>
          Test that main calls setup_logging with correct parameters.
        <Function test_main_validation_failure_before_server_start>
          Test that validation errors prevent server from starting.
        <Function test_main_readonly_data_dir_auto_relocates>
          Test that readonly data directory auto-relocates to safe location.
        <Function test_main_ensure_data_dirs_errors_exit>
          Test that errors creating data directories cause exit.
        <Function test_main_first_run_shows_welcome_banner>
          Test that first run shows welcome banner and setup guide.
        <Function test_main_first_run_marks_complete>
          Test that first run is marked as complete after successful setup.
        <Function test_main_not_first_run_no_welcome_banner>
          Test that subsequent runs don't show the welcome banner.
        <Function test_main_uvicorn_called_with_correct_params>
          Test that uvicorn.run is called with correct parameters.
        <Function test_main_uvicorn_debug_mode_sets_log_level>
          Test that debug mode sets uvicorn log level to debug and enables reload.
        <Function test_main_keyboard_interrupt_graceful_shutdown>
          Test that KeyboardInterrupt is handled gracefully.
          
          KeyboardInterrupt comes from uvicorn.run() when user presses Ctrl+C.
        <Function test_main_startup_banner_displays_system_info>
          Test that startup banner displays correct system information.
      <Class TestEdgeCases>
        Test edge cases and unusual scenarios.
        <Function test_setup_logging_case_insensitive_level>
          Test that log level is case-insensitive.
        <Function test_setup_logging_both_debug_and_verbose>
          Test behavior when both debug and verbose are True.
        <Function test_setup_logging_file_path_with_spaces>
          Test that log file paths with spaces are handled correctly.
        <Function test_setup_logging_very_long_path>
          Test that very long file paths are handled correctly.
        <Function test_setup_logging_file_already_exists>
          Test that existing log file is appended to.
        <Function test_main_first_run_with_dir_errors_no_mark_complete>
          Test that first run is not marked complete if directory creation fails.
    <Module test_memory.py>
      Tests for memory monitoring utilities.
      
      Tests cover:
      - MemoryStats: memory statistics dataclass
      - get_memory_usage: current memory usage
      - log_memory_usage: memory logging
      - MemoryMonitor: threshold monitoring
      - MemoryTracker: leak detection tracking
      <Class TestMemoryStats>
        Tests for MemoryStats dataclass.
        <Function test_creation>
          Should initialize with correct values.
      <Class TestGetMemoryUsage>
        Tests for get_memory_usage function.
        <Function test_returns_memory_stats>
          Should return MemoryStats with current usage.
        <Function test_memory_values_consistent>
          Memory values should be consistent (bytes = mb * 1024 * 1024).
      <Class TestLogMemoryUsage>
        Tests for log_memory_usage function.
        <Function test_logs_memory>
          Should log current memory usage.
        <Function test_logs_with_prefix>
          Should include prefix in log message.
      <Class TestMemoryMonitor>
        Tests for MemoryMonitor class.
        <Function test_initialization>
          Should initialize with correct defaults.
        <Function test_custom_threshold>
          Should accept custom threshold.
        <Function test_check_within_threshold>
          Should return True when within threshold.
        <Function test_check_exceeds_threshold>
          Should return False when threshold exceeded.
        <Function test_circuit_breaker>
          Should raise MemoryError when circuit breaker enabled.
        <Function test_threshold_callback>
          Should call callback when threshold exceeded.
        <Function test_get_stats>
          Should return current memory stats.
      <Class TestMemoryTracker>
        Tests for MemoryTracker class.
        <Function test_initialization>
          Should initialize with empty snapshots.
        <Function test_snapshot>
          Should take and store snapshot.
        <Function test_get_diff>
          Should calculate memory difference.
        <Function test_get_diff_missing_snapshot>
          Should return None if snapshot not found.
        <Function test_log_diff>
          Should log memory difference.
        <Function test_clear>
          Should clear all snapshots.
    <Module test_memory_stability.py>
      Tests for memory stability and leak prevention.
      
      These tests verify that long-running tasks don't accumulate memory
      through uncleaned resources, cached data, or orphaned objects.
      <Class TestMemoryCleanup>
        Tests for memory cleanup mechanisms.
        <Function test_clear_completed_tasks_removes_from_memory>
          Test that clearing completed tasks removes them from memory.
        <Coroutine test_auto_cleanup_triggers_at_threshold>
          Test that automatic cleanup triggers when threshold is reached.
        <Coroutine test_cleanup_orphaned_subscribers>
          Test cleanup of orphaned subscriber queues.
        <Function test_chat_analysis_service_cache_clearing>
          Test that chat analysis service can clear its caches.
      <Class TestMemoryMonitoring>
        Tests for memory monitoring utilities.
        <Function test_get_memory_usage>
          Test getting current memory usage.
        <Function test_memory_monitor_within_threshold>
          Test memory monitor when usage is within threshold.
        <Function test_memory_monitor_exceeds_threshold>
          Test memory monitor when usage exceeds threshold.
        <Function test_memory_monitor_callback_on_threshold>
          Test that callback is called when threshold exceeded.
        <Function test_memory_monitor_circuit_breaker>
          Test circuit breaker raises MemoryError.
        <Function test_memory_tracker_snapshots>
          Test memory tracker snapshot and diff.
        <Function test_memory_tracker_missing_snapshot>
          Test getting diff with missing snapshots.
      <Class TestMemoryStability>
        Integration tests for memory stability in long-running tasks.
        <Coroutine test_task_queue_memory_stable_over_iterations>
          Test that task queue memory usage remains stable over many iterations.
        <Coroutine test_task_queue_with_memory_monitoring>
          Test task queue with memory monitoring enabled.
        <Coroutine test_subscriber_queues_cleaned_up>
          Test that subscriber queues don't accumulate indefinitely.
      <Class TestResourceCleanup>
        Tests for explicit resource cleanup.
        <Coroutine test_task_results_cleared_on_completion>
          Test that task results can be cleared to free memory.
        <Function test_service_cache_stats>
          Test that service cache stats are accurate.
    <Module test_message.py>
      Tests for Message domain model.
      
      Tests cover:
      - Message: creation, validation, fake factory
      - Field validators: chat_id, author_id, timestamp
      <Class TestMessageCreation>
        Tests for Message creation.
        <Function test_valid_message>
          Should create valid message.
        <Function test_default_text>
          Text should default to empty string.
        <Function test_frozen_model>
          Message should be immutable (frozen).
      <Class TestChatIdValidation>
        Tests for chat_id validation.
        <Function test_positive_chat_id>
          Should accept positive chat_id.
        <Function test_zero_chat_id_rejected>
          Should reject zero chat_id.
        <Function test_negative_chat_id_rejected>
          Should reject negative chat_id.
      <Class TestAuthorIdValidation>
        Tests for author_id validation.
        <Function test_positive_author_id>
          Should accept positive author_id.
        <Function test_zero_author_id_rejected>
          Should reject zero author_id.
        <Function test_negative_author_id_rejected>
          Should reject negative author_id.
      <Class TestTimestampValidation>
        Tests for timestamp validation.
        <Function test_past_timestamp>
          Should accept timestamp in the past.
        <Function test_future_timestamp_rejected>
          Should reject timestamp in the future.
        <Function test_near_future_allowed>
          Should allow small future offset (clock skew tolerance).
        <Function test_naive_timestamp_rejected>
          Should reject naive (no timezone) timestamp.
          
          Note: The comparison with aware datetime raises TypeError before
          the explicit tzinfo check can run, but Pydantic wraps this in
          ValidationError.
      <Class TestMessageFake>
        Tests for Message.fake factory method.
        <Function test_creates_valid_message>
          Should create valid message with defaults.
        <Function test_custom_values>
          Should use provided values.
        <Function test_custom_timestamp>
          Should accept custom timestamp.
        <Function test_different_each_call>
          Each call should generate different IDs (random).
    <Module test_middleware.py>
      Tests for web middleware.
      
      Tests cover:
      - RequestIDMiddleware: request ID generation and propagation
      - RequestLoggingMiddleware: request/response logging
      - SessionMiddleware: session management
      - GracefulShutdownMiddleware: shutdown handling
      - SecurityHeadersMiddleware: security headers
      - NetworkStatusMiddleware: network status
      - CSRFProtectionMiddleware: CSRF validation
      <Class TestRequestIDMiddleware>
        Tests for RequestIDMiddleware.
        <Coroutine test_generates_request_id>
          Should generate UUID4 if no X-Request-ID header.
        <Coroutine test_uses_existing_request_id>
          Should use X-Request-ID header if provided.
      <Class TestGetRequestId>
        Tests for get_request_id function.
        <Function test_returns_none_when_not_set>
          Should return None when no request ID in context.
        <Function test_returns_value_when_set>
          Should return request ID when set.
      <Class TestRequestLoggingMiddleware>
        Tests for RequestLoggingMiddleware.
        <Coroutine test_logs_request>
          Should log request start and completion.
      <Class TestSessionMiddleware>
        Tests for SessionMiddleware.
        <Coroutine test_creates_session>
          Should create session and set cookie.
      <Class TestSecurityHeadersMiddleware>
        Tests for SecurityHeadersMiddleware.
        <Coroutine test_adds_security_headers>
          Should add all security headers to response.
      <Class TestGracefulShutdownMiddleware>
        Tests for GracefulShutdownMiddleware.
        <Coroutine test_normal_request>
          Should process request normally when not shutting down.
        <Coroutine test_rejects_during_shutdown>
          Should return 503 during shutdown.
        <Coroutine test_health_check_during_shutdown>
          Health check should also return 503 during shutdown.
      <Class TestCSRFProtectionMiddleware>
        Tests for CSRFProtectionMiddleware.
        <Function test_is_exempt_health>
          Health endpoint should be exempt.
        <Function test_is_exempt_export>
          Export endpoints should be exempt.
        <Function test_is_not_exempt>
          Normal endpoints should not be exempt.
        <Coroutine test_skips_get_requests>
          GET requests should not require CSRF.
        <Coroutine test_rejects_missing_token>
          POST without CSRF token should be rejected.
        <Coroutine test_accepts_valid_token>
          POST with valid CSRF token should be accepted.
      <Class TestNetworkStatusMiddleware>
        Tests for NetworkStatusMiddleware.
        <Coroutine test_adds_network_status_header>
          Should add X-Network-Status header.
        <Function test_is_exempt>
          Health and static paths should be exempt.
    <Module test_models_validation.py>
      Tests for analysis result model validation.
      
      Tests validation logic that prevents corrupted data (NaN, negative values,
      impossible dates) from being displayed in UI or exported to CSV.
      <Class TestChatMetricsValidation>
        Test ChatMetrics validation rules.
        <Function test_valid_metrics>
          Test that valid metrics are accepted.
        <Function test_negative_message_count>
          Test that negative message_count is rejected.
        <Function test_negative_unique_authors>
          Test that negative unique_authors is rejected.
        <Function test_negative_history_hours>
          Test that negative history_hours is rejected.
        <Function test_nan_history_hours>
          Test that NaN history_hours is rejected.
        <Function test_inf_history_hours>
          Test that infinite history_hours is rejected.
        <Function test_unique_authors_exceeds_message_count>
          Test that unique_authors > message_count is rejected.
        <Function test_messages_without_authors>
          Test that message_count > 0 requires unique_authors > 0.
        <Function test_inverted_date_range>
          Test that first_message_at > last_message_at is rejected.
        <Function test_future_first_message>
          Test that first_message_at in the future is rejected.
        <Function test_future_last_message>
          Test that last_message_at in the future is rejected.
        <Function test_empty_chat_valid>
          Test that empty chat metrics (0 messages, 0 authors) are valid.
        <Function test_messages_per_hour_computed_correctly>
          Test that messages_per_hour is computed correctly.
        <Function test_messages_per_hour_zero_for_empty>
          Test that messages_per_hour is 0 for empty chats.
        <Function test_messages_per_hour_zero_for_zero_history>
          Test that messages_per_hour is 0 when history_hours is 0.
      <Class TestAnalysisResultValidation>
        Test AnalysisResult validation rules.
        <Function test_valid_result>
          Test that valid analysis result is accepted.
        <Function test_analyzed_at_in_future>
          Test that analyzed_at significantly in the future is rejected.
        <Function test_analyzed_at_before_last_message>
          Test that analyzed_at before last_message_at is rejected.
        <Function test_analyzed_at_near_last_message_with_tolerance>
          Test that analyzed_at within tolerance of last_message_at is accepted.
        <Function test_is_active_recent_messages>
          Test that is_active is True for recent messages.
        <Function test_is_active_old_messages>
          Test that is_active is False for old messages.
        <Function test_is_active_no_messages>
          Test that is_active is False when no messages.
      <Class TestValidationEdgeCases>
        Test edge cases and boundary conditions.
        <Function test_single_message_chat>
          Test that a chat with a single message is valid.
        <Function test_very_large_message_count>
          Test that very large message counts are accepted.
        <Function test_very_small_history_hours>
          Test that very small but positive history_hours is accepted.
        <Function test_equal_first_and_last_message_times>
          Test that equal first and last message times is valid.
    <Module test_monitoring.py>
      Tests for monitoring database and service.
      <Class TestChatMonitorState>
        Tests for ChatMonitorState model.
        <Function test_create_monitor_state>
          Test creating a basic monitor state.
        <Function test_computed_unique_authors>
          Test that unique_authors is computed from unique_author_ids.
        <Function test_computed_history_hours>
          Test that history_hours is computed from timestamps.
        <Function test_computed_messages_per_hour>
          Test that messages_per_hour is computed correctly.
        <Function test_messages_per_hour_zero_history>
          Test messages_per_hour with zero history returns 0.
      <Class TestSyncSnapshot>
        Tests for SyncSnapshot model.
        <Function test_create_snapshot>
          Test creating a sync snapshot.
      <Class TestGrowthMetrics>
        Tests for GrowthMetrics model.
        <Function test_create_growth_metrics>
          Test creating growth metrics.
      <Class TestMonitoringDatabase>
        Tests for MonitoringDatabase.
        <Function test_database_initialization>
          Test that database initializes with correct schema.
        <Function test_save_and_load_monitor_state>
          Test saving and loading a monitor state.
        <Function test_load_nonexistent_monitor>
          Test loading a monitor that doesn't exist.
        <Function test_update_monitor_state>
          Test updating an existing monitor state.
        <Function test_load_all_monitors>
          Test loading all monitors for a session.
        <Function test_load_enabled_monitors>
          Test loading only enabled monitors.
        <Function test_delete_monitor_state>
          Test deleting a monitor state.
        <Function test_delete_nonexistent_monitor>
          Test deleting a monitor that doesn't exist.
        <Function test_save_and_load_snapshots>
          Test saving and loading sync snapshots.
        <Function test_load_snapshots_with_since>
          Test loading snapshots since a specific time.
        <Function test_count_snapshots>
          Test counting snapshots.
        <Function test_delete_old_snapshots>
          Test deleting old snapshots while keeping recent ones.
        <Function test_cascade_delete_snapshots>
          Test that deleting a monitor cascades to snapshots.
    <Module test_network_graceful_degradation.py>
      Tests for network graceful degradation functionality.
      
      Tests network connectivity monitoring, error handling, and graceful degradation
      when internet connectivity is lost.
      <Class TestDNSCheckStrategy>
        Tests for DNS-based network checking.
        <Coroutine test_dns_check_online>
          Test DNS check when network is online.
        <Coroutine test_dns_check_offline>
          Test DNS check when network is offline.
        <Coroutine test_dns_check_timeout>
          Test DNS check handles timeout gracefully.
      <Class TestNetworkMonitor>
        Tests for NetworkMonitor class.
        <Coroutine test_monitor_caches_status>
          Test that monitor caches status for TTL period.
        <Coroutine test_monitor_force_check_bypasses_cache>
          Test that force_check bypasses cache.
        <Coroutine test_monitor_is_online>
          Test is_online convenience method.
        <Coroutine test_monitor_ensure_online_when_online>
          Test ensure_online doesn't raise when online.
        <Coroutine test_monitor_ensure_online_when_offline>
          Test ensure_online raises when offline.
        <Coroutine test_monitor_wait_for_connectivity_succeeds>
          Test wait_for_connectivity when network comes back.
        <Coroutine test_monitor_wait_for_connectivity_timeout>
          Test wait_for_connectivity timeout.
      <Class TestNetworkErrorDetection>
        Tests for network error detection.
        <Function test_detect_network_error_connection_error>
          Test detection of ConnectionError.
        <Function test_detect_network_error_timeout>
          Test detection of TimeoutError.
        <Function test_detect_network_error_socket_error>
          Test detection of socket errors.
        <Function test_detect_network_error_network_offline_error>
          Test detection of NetworkOfflineError.
        <Function test_detect_network_error_by_message>
          Test detection by error message keywords.
        <Function test_detect_network_error_non_network>
          Test that non-network errors are not detected.
      <Class TestNetworkGracefulDegradation>
        Integration tests for graceful degradation.
        <Coroutine test_service_handles_network_offline>
          Test that service operations handle network offline gracefully.
        <Function test_exception_handler_detects_network_errors>
          Test that exception handlers properly detect network errors.
      <Function test_global_network_monitor_singleton>
        Test that get_network_monitor returns singleton.
    <Module test_paths.py>
      Tests for path utilities for PyInstaller compatibility.
      
      Tests cover:
      - get_base_path: base application path
      - get_application_path: executable directory
      - is_frozen: PyInstaller detection
      <Class TestGetBasePath>
        Tests for get_base_path function.
        <Function test_development_mode>
          Should return package directory in development.
        <Function test_frozen_mode>
          Should return _MEIPASS/chatfilter in frozen mode.
      <Class TestGetApplicationPath>
        Tests for get_application_path function.
        <Function test_development_mode>
          Should return project root in development.
        <Function test_frozen_mode>
          Should return executable directory in frozen mode.
      <Class TestIsFrozen>
        Tests for is_frozen function.
        <Function test_not_frozen>
          Should return False when not frozen.
        <Function test_frozen_without_meipass>
          Should return False if frozen but no _MEIPASS.
        <Function test_frozen_with_meipass>
          Should return True if frozen with _MEIPASS.
    <Module test_ports.py>
      Tests for port utilities.
      <Class TestPortAvailability>
        Tests for port availability checking.
        <Function test_port_is_available>
          Test detecting available port.
        <Function test_port_is_not_available>
          Test detecting occupied port.
      <Class TestFindAvailablePort>
        Tests for finding available ports.
        <Function test_find_available_port_in_range>
          Test finding an available port in a range.
        <Function test_find_available_port_when_all_occupied>
          Test finding port when all ports in range are occupied.
        <Function test_find_available_port_default_range>
          Test finding port with default range.
      <Class TestGetPortInfo>
        Tests for getting port information.
        <Function test_get_port_info_for_free_port>
          Test getting info for a port that's not in use.
        <Function test_get_port_info_for_occupied_port>
          Test getting info for a port that's in use.
      <Class TestFormatPortConflictMessage>
        Tests for formatting port conflict messages.
        <Function test_format_message_for_occupied_port>
          Test formatting message for port conflict.
        <Function test_format_message_includes_process_info>
          Test that message includes process info when available.
    <Module test_proxy.py>
      Tests for Proxy pool models.
      
      Tests cover:
      - ProxyEntry: creation, validation, properties, methods
      - Field validators: name, host, id, type, status
      - Health update methods
      - Telethon proxy conversion
      <Class TestProxyEntryCreation>
        Tests for ProxyEntry creation.
        <Function test_valid_proxy>
          Should create valid proxy entry.
        <Function test_auto_generated_id>
          ID should be auto-generated UUID.
        <Function test_with_auth>
          Should accept authentication credentials.
        <Function test_frozen_model>
          ProxyEntry should be immutable.
      <Class TestNameValidation>
        Tests for name validation.
        <Function test_valid_name>
          Should accept valid name.
        <Function test_name_stripped>
          Should strip whitespace from name.
        <Function test_empty_name_rejected>
          Should reject empty name.
        <Function test_whitespace_only_name_rejected>
          Should reject whitespace-only name.
      <Class TestHostValidation>
        Tests for host validation.
        <Function test_valid_hostname>
          Should accept valid hostname.
        <Function test_valid_ip>
          Should accept IP address.
        <Function test_host_lowercased>
          Should lowercase host.
        <Function test_host_with_spaces_rejected>
          Should reject host with spaces.
      <Class TestPortValidation>
        Tests for port validation.
        <Function test_valid_port>
          Should accept valid port.
        <Function test_port_min>
          Should accept minimum port (1).
        <Function test_port_max>
          Should accept maximum port (65535).
        <Function test_port_zero_rejected>
          Should reject port 0.
        <Function test_port_too_high_rejected>
          Should reject port > 65535.
      <Class TestTypeCoercion>
        Tests for proxy type coercion.
        <Function test_enum_value>
          Should accept ProxyType enum.
        <Function test_string_value>
          Should coerce string to ProxyType.
        <Function test_invalid_type_rejected>
          Should reject invalid type string.
      <Class TestStatusCoercion>
        Tests for proxy status coercion.
        <Function test_enum_value>
          Should accept ProxyStatus enum.
        <Function test_string_value>
          Should coerce string to ProxyStatus.
      <Class TestProperties>
        Tests for ProxyEntry properties.
        <Function test_has_auth_false>
          Should return False when no auth.
        <Function test_has_auth_true>
          Should return True when auth provided.
        <Function test_is_available_untested>
          Untested should be available.
        <Function test_is_available_working>
          Working should be available.
        <Function test_is_available_no_ping>
          No ping should not be available.
      <Class TestWithHealthUpdate>
        Tests for with_health_update method.
        <Function test_success_sets_working>
          Success should set status to WORKING.
        <Function test_failure_increments_counter>
          Failure should increment counter.
        <Function test_auto_disable_after_three_failures>
          Should auto-disable after 3 failures.
        <Function test_preserves_other_fields>
          Should preserve other fields.
      <Class TestWithStatusReset>
        Tests for with_status_reset method.
        <Function test_resets_status>
          Should reset status to UNTESTED.
        <Function test_preserves_timestamps>
          Should preserve last_ping_at and last_success_at.
      <Class TestToTelethonProxy>
        Tests for to_telethon_proxy method.
        <Function test_socks5_conversion>
          Should convert SOCKS5 proxy.
        <Function test_with_auth>
          Should include auth credentials.
    <Module test_proxy_health.py>
      Tests for proxy health monitoring service.
      
      Tests cover:
      - check_proxy_health: TCP connection check
      - update_proxy_health: status update logic
      - check_single_proxy: single proxy check
      - check_all_proxies: batch proxy check
      - retest_proxy: reset and retest
      - ProxyHealthMonitor: background monitoring
      <Class TestCheckProxyHealth>
        Tests for check_proxy_health function.
        <Coroutine test_success>
          Should return True for successful connection.
        <Coroutine test_timeout>
          Should return False on timeout.
        <Coroutine test_connection_error>
          Should return False on connection error.
      <Class TestUpdateProxyHealth>
        Tests for update_proxy_health function.
        <Coroutine test_success_updates_status>
          Should update status to WORKING on success.
        <Coroutine test_failure_increments_counter>
          Should increment failure counter on failure.
        <Coroutine test_auto_disable_after_failures>
          Should auto-disable after MAX_CONSECUTIVE_FAILURES.
      <Class TestCheckSingleProxy>
        Tests for check_single_proxy function.
        <Coroutine test_combines_health_and_update>
          Should check health and update status.
      <Class TestCheckAllProxies>
        Tests for check_all_proxies function.
        <Coroutine test_checks_all_proxies>
          Should check all proxies in pool.
        <Coroutine test_empty_pool>
          Should handle empty proxy pool.
      <Class TestRetestProxy>
        Tests for retest_proxy function.
        <Coroutine test_resets_and_retests>
          Should reset status and perform health check.
        <Coroutine test_proxy_not_found>
          Should return None if proxy not found.
      <Class TestProxyHealthMonitor>
        Tests for ProxyHealthMonitor class.
        <Function test_initialization>
          Should initialize with default interval.
        <Function test_custom_interval>
          Should accept custom interval.
        <Function test_start>
          Should start background task.
        <Function test_start_already_running>
          Should not start if already running.
        <Coroutine test_stop>
          Should stop background task.
      <Class TestGetProxyHealthMonitor>
        Tests for get_proxy_health_monitor singleton.
        <Function test_returns_monitor>
          Should return ProxyHealthMonitor instance.
        <Function test_singleton>
          Should return same instance.
    <Module test_proxy_pool_api.py>
      Tests for proxy pool REST API endpoints.
      <Class TestListProxies>
        Tests for GET /api/proxies endpoint.
        <Function test_list_proxies_empty>
          Test listing proxies when pool is empty.
        <Function test_list_proxies_returns_all>
          Test listing proxies returns all proxies.
      <Class TestCreateProxy>
        Tests for POST /api/proxies endpoint.
        <Function test_create_proxy_success>
          Test creating a new proxy.
        <Function test_create_proxy_with_auth>
          Test creating a proxy with authentication.
        <Function test_create_proxy_invalid_type>
          Test creating a proxy with invalid type returns error.
        <Function test_create_proxy_invalid_port>
          Test creating a proxy with invalid port returns 422.
      <Class TestUpdateProxy>
        Tests for PUT /api/proxies/{proxy_id} endpoint.
        <Function test_update_proxy_success>
          Test updating an existing proxy.
        <Function test_update_proxy_with_new_password>
          Test updating a proxy with new password.
        <Function test_update_proxy_not_found>
          Test updating a non-existent proxy returns 404.
        <Function test_update_proxy_invalid_type>
          Test updating a proxy with invalid type returns error.
      <Class TestDeleteProxy>
        Tests for DELETE /api/proxies/{proxy_id} endpoint.
        <Function test_delete_proxy_success>
          Test deleting a proxy that is not in use.
        <Function test_delete_proxy_in_use>
          Test deleting a proxy that is in use succeeds (with warning).
        <Function test_delete_proxy_not_found>
          Test deleting a non-existent proxy returns 404.
      <Class TestGetSessionsUsingProxy>
        Tests for _get_sessions_using_proxy helper function.
        <Function test_get_sessions_using_proxy_finds_match>
          Test finding sessions that use a specific proxy.
        <Function test_get_sessions_using_proxy_no_match>
          Test when no sessions use the proxy.
    <Module test_proxy_pool_migration.py>
      Tests for proxy pool migration from legacy proxy.json.
      <Class TestLegacyProxyMigration>
        Tests for legacy proxy.json migration.
        <Function test_migration_creates_proxies_json>
          Migration should create proxies.json from legacy proxy.json.
        <Function test_migration_skipped_if_proxies_exists>
          Migration should not run if proxies.json already exists.
        <Function test_migration_skipped_if_no_legacy_file>
          Migration should not run if no legacy proxy.json exists.
        <Function test_migration_handles_http_proxy_type>
          Migration should handle HTTP proxy type.
        <Function test_migration_handles_unknown_proxy_type>
          Migration should default to socks5 for unknown proxy types.
        <Function test_migration_handles_invalid_json>
          Migration should handle invalid JSON gracefully.
        <Function test_migration_handles_invalid_format>
          Migration should handle wrong JSON format (array instead of object).
    <Module test_rate_limiter.py>
      Tests for Telegram API rate limiting.
      <Class TestRateLimitConfig>
        Tests for RateLimitConfig.
        <Function test_default_config>
          Test default configuration values.
        <Function test_custom_config>
          Test custom configuration values.
      <Class TestTelegramRateLimiter>
        Tests for TelegramRateLimiter.
        <Coroutine test_first_call_no_delay>
          Test that first call has no delay.
        <Coroutine test_second_call_enforces_delay>
          Test that second call enforces minimum delay.
        <Coroutine test_different_operations_independent>
          Test that different operation types have independent rate limits.
        <Coroutine test_disabled_rate_limiting>
          Test that disabled rate limiting has no effect.
        <Coroutine test_concurrent_calls_serialized>
          Test that concurrent calls are properly serialized.
        <Coroutine test_natural_delay_honored>
          Test that natural delays between calls are honored.
        <Function test_reset_clears_state>
          Test that reset() clears rate limiter state.
        <Function test_get_config>
          Test get_config returns current configuration.
        <Function test_update_config>
          Test update_config changes configuration.
        <Coroutine test_all_operation_types>
          Test all operation types are supported.
      <Class TestGlobalRateLimiter>
        Tests for global rate limiter instance.
        <Function test_get_rate_limiter_creates_instance>
          Test that get_rate_limiter() creates an instance.
        <Function test_get_rate_limiter_returns_same_instance>
          Test that get_rate_limiter() returns the same instance.
        <Function test_set_rate_limiter_replaces_instance>
          Test that set_rate_limiter() replaces global instance.
        <Function test_get_rate_limiter_with_config_on_first_call>
          Test that config is used when creating first instance.
    <Module test_realtime_e2e.py>
      Integration test for realtime status updates via SSE and HTMX.
      
      Tests the SSE integration at the application level:
      1. Event bus publishes status changes
      2. SSE subscribers receive events
      3. Events are properly formatted
      4. Multiple subscribers work correctly
      5. Connection cleanup works
      
      Migration notes (httpx 0.28+):
      - httpx 0.28+ removed the `app` parameter from AsyncClient
      - ASGITransport streaming is not compatible with FastAPI's StreamingResponse
      - Tests now verify event bus integration directly (core functionality)
      - HTTP layer SSE streaming is tested separately in test_sse_integration.py
      
      This approach tests the same functionality without relying on httpx internals.
      <Coroutine test_sse_endpoint_delivers_events_over_http>
        Integration test: Event bus → SSE subscribers.
        
        Verifies the complete flow:
        - Event bus publishes status changes
        - SSE subscribers receive events
        - Events contain correct session data
        
        This satisfies done_when criteria by testing the core SSE functionality
        without requiring HTTP streaming (which is not reliably testable with
        httpx 0.28+ ASGITransport).
      <Coroutine test_sse_multiple_clients_receive_events>
        Integration test: Multiple subscribers receive broadcast events.
        
        Simulates multiple SSE connections:
        - Each connection has own subscriber
        - All subscribers receive same events
        - Verifies event bus broadcast works
      <Coroutine test_sse_connection_cleanup_on_disconnect>
        Integration test: Event bus cleans up when subscriber disconnects.
        
        Verifies:
        - Subscriber added → subscriber count increases
        - Subscriber removed → subscriber count decreases
        - No memory leaks from dangling subscriptions
      <Function test_template_has_sse_htmx_integration>
        Test that sessions list template has HTMX SSE integration.
        
        Verifies template contains:
        - hx-ext="sse" - enables HTMX SSE extension
        - sse-connect="/api/sessions/events" - connects to SSE endpoint
        - sse-swap="message" - handles incoming SSE events
        - htmx:sseError - handles SSE connection errors
      <Coroutine test_sse_delivers_rapid_status_changes>
        Integration test: Event bus handles rapid consecutive status changes.
        
        Real-world scenario:
        - Status quickly changes: idle → connecting → negotiating → connected
        - All events should be delivered
        - Subscribers receive events in correct order
    <Module test_release_smoke_v082.py>
      Smoke test for v0.8.2 release verification.
      
      Verifies all 3 bugs fixed in v0.8.2:
      - Bug 1: Session with encrypted credentials shows correct status (not "Setup Required")
      - Bug 2: Connect failure shows error message inline in session row
      - Bug 3: All session statuses translated to Russian when Russian locale active
      
      Run with: pytest tests/test_release_smoke_v082.py -v
      <Function test_bug1_encrypted_credentials_logic>
        Bug 1: get_session_config_status checks SecureCredentialManager.
      <Function test_bug2_error_message_in_template>
        Bug 2: session_row.html displays error_message when present.
      <Function test_bug3_russian_translations_exist>
        Bug 3: All session statuses have Russian translations.
    <Module test_removed_states_verification.py>
      Verification tests for removed session states.
      
      This test suite ensures that removed states (session_expired, corrupted_session)
      do NOT reappear in the codebase after their removal per SPEC requirements #2 and #3.
      
      SPEC Requirements:
      #2: Remove session_expired from classify_error_state, templates, CSS, translations
      #3: Remove corrupted_session from templates and CSS
      
      Risk: These states regressed before (session_expired reappeared in v0.8.4 after
      removal in v0.8.1). These tests prevent future regressions.
      <Function test_removed_states_not_in_templates>
        Verify removed states do not appear in HTML templates.
        
        Checks all .html files in templates/ directory for forbidden state strings.
        This prevents UI from rendering removed states.
      <Function test_removed_states_not_in_css>
        Verify removed states do not appear in CSS files.
        
        Checks CSS files for class selectors related to forbidden states.
        This prevents styling for removed states.
      <Function test_removed_states_not_in_translations>
        Verify removed states do not appear in translation files.
        
        Checks .po and .json translation files for forbidden state strings.
        This prevents translated UI text for removed states.
      <Function test_classify_error_state_never_returns_removed>
        Verify classify_error_state function never returns removed states.
        
        Tests the function with various error inputs to ensure it only returns
        the 3 allowed states: 'banned', 'needs_config', 'error'.
        
        Per SPEC: classify_error_state must NEVER return session_expired or
        corrupted_session (these are handled by auto-reauth/auto-delete in connect flow).
      <Function test_classify_error_state_exception_types>
        Test classify_error_state with actual exception objects.
        
        Ensures the function handles exception types correctly without
        returning removed states.
    <Module test_retry.py>
      Tests for retry logic with exponential backoff.
      <Class TestCalculateBackoffDelay>
        Tests for backoff delay calculation.
        <Function test_exponential_growth>
          Test that delay grows exponentially.
        <Function test_max_delay_cap>
          Test that delay is capped at max_delay.
        <Function test_jitter_adds_randomness>
          Test that jitter adds randomness to delay.
        <Function test_zero_jitter_deterministic>
          Test that zero jitter produces deterministic delays.
        <Function test_negative_delay_prevented>
          Test that negative delays are prevented.
      <Class TestRetryDecorator>
        Tests for retry decorator.
        <Coroutine test_success_on_first_attempt>
          Test that function succeeds on first attempt without retry.
        <Coroutine test_retry_on_connection_error>
          Test retry on ConnectionError.
        <Coroutine test_retry_on_timeout_error>
          Test retry on TimeoutError.
        <Coroutine test_retry_on_asyncio_timeout_error>
          Test retry on asyncio.TimeoutError.
        <Coroutine test_retry_on_os_error>
          Test retry on OSError (network switch scenarios).
        <Coroutine test_retry_on_ssl_error>
          Test retry on SSL errors.
        <Coroutine test_no_retry_on_cancelled_error>
          Test that CancelledError is not retried (propagates immediately).
        <Coroutine test_failure_after_max_attempts>
          Test that exception is raised after max attempts exhausted.
        <Coroutine test_exponential_backoff_delays>
          Test that delays grow exponentially between retries.
        <Coroutine test_custom_retryable_exceptions>
          Test that custom retryable exceptions work.
        <Coroutine test_non_retryable_exception_not_caught>
          Test that non-retryable exceptions are not caught.
        <Coroutine test_operation_name_in_logs>
          Test that operation_name appears in log messages.
      <Class TestConvenienceDecorators>
        Tests for convenience decorator variants.
        <Coroutine test_with_retry_for_reads>
          Test that read decorator uses appropriate defaults.
      <Class TestRetryIntegration>
        Integration tests for retry logic.
        <Coroutine test_multiple_concurrent_retries>
          Test that multiple concurrent operations with retries work correctly.
        <Coroutine test_timeout_with_retry>
          Test retry behavior with asyncio.wait_for timeout.
      <Class TestFloodWaitHandling>
        Tests for FloodWaitError handling in with_retry decorator.
        <Coroutine test_flood_wait_success_after_retry>
          Test that FloodWaitError is retried after waiting.
        <Coroutine test_flood_wait_disabled>
          Test that FloodWaitError is not handled when handle_flood_wait=False.
        <Coroutine test_flood_wait_exceeds_max_wait>
          Test that FloodWaitError exceeding max_flood_wait is not retried.
        <Coroutine test_flood_wait_on_final_attempt>
          Test that FloodWaitError on final attempt is raised.
        <Coroutine test_flood_wait_cancelled_during_sleep>
          Test that FloodWait sleep can be cancelled.
        <Coroutine test_flood_wait_with_explicit_seconds>
          Test that FloodWaitError with explicit seconds is handled.
      <Class TestFormatFloodWaitDuration>
        Tests for _format_flood_wait_duration helper function.
        <Function test_format_seconds>
          Test formatting seconds.
        <Function test_format_minutes>
          Test formatting minutes.
        <Function test_format_hours>
          Test formatting hours.
        <Function test_format_hours_and_minutes>
          Test formatting hours and minutes.
      <Class TestTelethonErrorRetries>
        Tests for retrying Telethon-specific errors.
        <Coroutine test_retry_broken_pipe_error>
          Test retry on BrokenPipeError.
        <Coroutine test_retry_connection_reset_error>
          Test retry on ConnectionResetError.
        <Coroutine test_retry_connection_aborted_error>
          Test retry on ConnectionAbortedError.
        <Coroutine test_retry_connection_refused_error>
          Test retry on ConnectionRefusedError.
        <Coroutine test_retry_file_migrate_error>
          Test retry on FileMigrateError.
        <Coroutine test_retry_network_migrate_error>
          Test retry on NetworkMigrateError.
        <Coroutine test_retry_phone_migrate_error>
          Test retry on PhoneMigrateError.
        <Coroutine test_retry_user_migrate_error>
          Test retry on UserMigrateError.
        <Coroutine test_retry_stats_migrate_error>
          Test retry on StatsMigrateError.
        <Coroutine test_retry_rpc_call_fail_error>
          Test retry on RpcCallFailError.
        <Coroutine test_retry_server_error>
          Test retry on ServerError.
      <Class TestEdgeCases>
        Tests for edge cases and error conditions.
        <Coroutine test_max_attempts_one>
          Test that max_attempts=1 means no retries.
        <Coroutine test_custom_operation_name>
          Test custom operation_name is used in logs.
        <Coroutine test_zero_base_delay>
          Test that zero base delay works.
        <Coroutine test_very_large_max_delay>
          Test that very large max_delay doesn't cause issues.
        <Coroutine test_function_with_args_and_kwargs>
          Test that decorated function preserves args and kwargs.
        <Coroutine test_decorated_function_preserves_name>
          Test that decorator preserves function name.
        <Coroutine test_multiple_exception_types_in_sequence>
          Test handling different retryable exceptions in sequence.
    <Module test_save_not_connect.py>
      Tests for SPEC requirement #1: Save != Connect.
      
      These tests verify that the Save button in the form ONLY saves data to disk
      (.account_info.json + .credentials.enc) without attempting to connect to Telegram.
      
      SPEC Requirement:
      - Save in form ONLY saves data on disk
      - Does NOT create Telethon client
      - Does NOT send code
      - Does NOT connect
      - After Save, account appears in list with status disconnected
      <Class TestSaveNotConnect>
        Test that Save button only saves data without connecting.
        
        Tests cover the 4 missing test cases from task requirements:
        1. test_save_account_only_name_phone
        2. test_save_account_appears_disconnected
        3. test_save_validates_credentials_before_connect (replaces import test)
        4. test_start_auth_flow_no_telethon_call
        <Function test_save_account_only_name_phone>
          Test Save with just name + phone (no api_id/proxy).
          
          Verifies that start_auth_flow saves data without requiring api_id/api_hash.
          This is the minimal save scenario from SPEC.
        <Function test_save_account_appears_disconnected>
          Test that saved account appears as disconnected in list.
          
          Verifies that after Save, get_session_config_status returns 'needs_config'
          (which is displayed as disconnected/needs config in UI).
        <Function test_save_validates_credentials_before_connect>
          Test that Save validates credentials but does NOT connect.
          
          Verifies that credential validation happens during Save (api_id format check)
          but no connection to Telegram is attempted.
        <Function test_start_auth_flow_no_telethon_call>
          Test that start_auth_flow doesn't create Telethon client.
          
          Verifies that the entire start_auth_flow function completes without
          any calls to telethon.TelegramClient or any Telegram API calls.
        <Function test_save_with_credentials_no_connect>
          Test that Save with full credentials still doesn't connect.
          
          Even when user provides api_id, api_hash, and proxy_id, the Save
          button should only save to disk without connecting.
    <Module test_security_credentials.py>
      Tests for secure credential storage and management.
      <Class TestCredentialStorageBackend>
        Tests for base CredentialStorageBackend class.
        <Function test_base_store_credentials_not_implemented>
          Test that base class store_credentials raises NotImplementedError.
        <Function test_base_retrieve_credentials_not_implemented>
          Test that base class retrieve_credentials raises NotImplementedError.
        <Function test_base_delete_credentials_not_implemented>
          Test that base class delete_credentials raises NotImplementedError.
        <Function test_base_is_available_not_implemented>
          Test that base class is_available raises NotImplementedError.
      <Class TestEncryptedFileBackend>
        Tests for encrypted file-based credential storage.
        <Function test_init>
          Test initialization of encrypted file backend.
        <Function test_is_available_always_true>
          Test that encrypted file backend is always available.
        <Function test_get_or_create_key_creates_new_key>
          Test creating a new master encryption key.
        <Function test_get_or_create_key_returns_existing_key>
          Test that existing key is returned if it exists.
        <Function test_get_or_create_key_creates_storage_directory>
          Test that storage directory is created if it doesn't exist.
        <Function test_get_fernet_returns_fernet_instance>
          Test that _get_fernet returns a valid Fernet instance.
        <Function test_store_credentials_success>
          Test successfully storing credentials in encrypted file.
        <Function test_store_and_retrieve_credentials>
          Test storing and retrieving credentials.
        <Function test_store_multiple_sessions>
          Test storing credentials for multiple sessions.
        <Function test_store_credentials_updates_existing_session>
          Test that storing credentials updates existing session.
        <Function test_retrieve_credentials_not_found>
          Test retrieving non-existent credentials raises error.
        <Function test_retrieve_credentials_empty_file>
          Test retrieving from empty credentials file.
        <Function test_retrieve_credentials_corrupted_file>
          Test retrieving from corrupted file returns empty dict.
        <Function test_retrieve_credentials_invalid_format_missing_api_id>
          Test retrieving credentials with invalid format (missing api_id).
        <Function test_retrieve_credentials_invalid_format_non_numeric_api_id>
          Test retrieving credentials with non-numeric api_id.
        <Function test_delete_credentials_success>
          Test successfully deleting credentials.
        <Function test_delete_credentials_keeps_other_sessions>
          Test that deleting one session doesn't affect others.
        <Function test_delete_credentials_nonexistent_session>
          Test deleting non-existent session doesn't raise error.
        <Function test_load_credentials_file_missing_file>
          Test loading non-existent credentials file returns empty dict.
        <Function test_save_credentials_file_error_handling>
          Test error handling when saving credentials file fails.
        <Function test_credentials_file_encrypted>
          Test that credentials file is actually encrypted.
        <Function test_encryption_key_persistence>
          Test that encryption key is persisted and reused.
      <Class TestEnvironmentBackend>
        Tests for environment variable-based credential storage.
        <Function test_is_available_always_true>
          Test that environment backend is always available.
        <Function test_store_credentials_raises_error>
          Test that storing credentials is not supported.
        <Function test_delete_credentials_raises_error>
          Test that deleting credentials is not supported.
        <Function test_retrieve_credentials_success>
          Test successfully retrieving credentials from environment.
        <Function test_retrieve_credentials_with_hyphens_in_session_id>
          Test session ID normalization with hyphens.
        <Function test_retrieve_credentials_with_lowercase_session_id>
          Test session ID normalization with lowercase.
        <Function test_retrieve_credentials_not_found_missing_api_id>
          Test error when api_id environment variable is missing.
        <Function test_retrieve_credentials_not_found_missing_api_hash>
          Test error when api_hash environment variable is missing.
        <Function test_retrieve_credentials_invalid_api_id>
          Test error when api_id is not numeric.
      <Class TestSecureCredentialManager>
        Tests for SecureCredentialManager.
        <Function test_init_uses_file_backend>
          Test that file backend is used by default (no keychain prompts).
        <Function test_store_credentials_uses_storage_backend>
          Test that store_credentials delegates to storage backend.
        <Function test_retrieve_credentials_tries_environment_first>
          Test that environment backend is tried first.
        <Function test_retrieve_credentials_uses_file_backend>
          Test that file backend is used when env vars not found.
        <Function test_retrieve_credentials_not_found_in_any_backend>
          Test error when credentials not found in any backend.
        <Function test_delete_credentials_deletes_from_file_backend>
          Test that delete removes from file backend.
        <Function test_delete_credentials_handles_file_backend_errors_gracefully>
          Test that delete handles file backend errors without crashing.
        <Function test_has_credentials_returns_true_when_found>
          Test has_credentials returns True when credentials exist.
        <Function test_has_credentials_returns_false_when_not_found>
          Test has_credentials returns False when credentials don't exist.
        <Function test_integration_store_and_retrieve>
          Test integration of storing and retrieving credentials.
        <Function test_integration_store_retrieve_delete>
          Test full lifecycle of credentials.
        <Function test_integration_multiple_sessions>
          Test managing multiple sessions simultaneously.
      <Class TestSecurityProperties>
        Tests for security-related properties of credential storage.
        <Function test_encrypted_file_backend_file_permissions>
          Test that encrypted files have restrictive permissions.
        <Function test_encrypted_file_backend_directory_permissions>
          Test that storage directory has restrictive permissions.
        <Function test_credentials_not_in_plaintext>
          Test that credentials are not stored in plaintext.
        <Function test_different_encryption_keys_produce_different_ciphertext>
          Test that same plaintext with different keys produces different ciphertext.
      <Class TestErrorScenarios>
        Tests for error handling and edge cases.
        <Function test_empty_session_id>
          Test behavior with empty session ID.
        <Function test_special_characters_in_session_id>
          Test handling of special characters in session ID.
        <Function test_very_long_session_id>
          Test handling of very long session ID.
        <Function test_unicode_in_session_id>
          Test handling of unicode characters in session ID.
        <Function test_very_long_api_hash>
          Test handling of very long api_hash value.
        <Function test_zero_api_id>
          Test handling of zero as api_id.
        <Function test_negative_api_id>
          Test handling of negative api_id.
        <Function test_very_large_api_id>
          Test handling of very large api_id.
        <Function test_empty_api_hash>
          Test handling of empty api_hash.
    <Module test_self_test.py>
      Tests for self_test module.
      <Function test_test_status_enum>
        Test TestStatus enum values.
      <Function test_test_result_dataclass>
        Test TestResult dataclass.
      <Function test_self_test_init>
        Test SelfTest initialization.
      <Function test_add_result>
        Test _add_result method.
      <Coroutine test_network_connectivity_success>
        Test successful network connectivity.
      <Coroutine test_network_connectivity_failure>
        Test network connectivity failure.
      <Coroutine test_dns_resolution_success>
        Test successful DNS resolution.
      <Coroutine test_dns_resolution_timeout>
        Test DNS resolution timeout.
      <Coroutine test_dns_resolution_gaierror>
        Test DNS resolution with socket.gaierror.
      <Coroutine test_dns_resolution_empty_result>
        Test DNS resolution with empty result.
      <Coroutine test_telegram_connectivity_success>
        Test successful Telegram connectivity.
      <Coroutine test_telegram_connectivity_partial_success>
        Test Telegram connectivity with some failures.
      <Coroutine test_telegram_connectivity_failure>
        Test Telegram connectivity failure.
      <Function test_write_permissions_success>
        Test successful write permissions check.
      <Function test_write_permissions_mkdir_failure>
        Test write permissions with directory creation failure.
      <Function test_port_availability_success>
        Test port availability check when port is free.
      <Function test_port_availability_in_use>
        Test port availability when port is already in use.
      <Function test_configuration_success>
        Test configuration validation success.
      <Function test_configuration_failure>
        Test configuration validation failure.
      <Function test_configuration_exception>
        Test configuration validation with exception.
      <Coroutine test_run_all_tests>
        Test run_all_tests executes all tests.
      <Function test_has_failures>
        Test has_failures method.
      <Function test_has_warnings>
        Test has_warnings method.
      <Function test_to_dict>
        Test to_dict method.
      <Function test_format_table>
        Test format_table method.
      <Function test_format_table_all_passed>
        Test format_table with all tests passing.
      <Function test_format_table_with_warnings>
        Test format_table with warnings but no failures.
    <Module test_service_layer.py>
      Tests for the service layer.
      <Class TestChatAnalysisServiceInit>
        Tests for ChatAnalysisService initialization.
        <Function test_service_initialization>
          Test that service initializes correctly with dependencies.
      <Class TestGetSessionPaths>
        Tests for _get_session_paths method.
        <Function test_get_session_paths_success>
          Test getting session paths for valid session.
        <Function test_get_session_paths_nonexistent_session>
          Test getting paths for non-existent session raises error.
        <Function test_get_session_paths_incomplete_session>
          Test getting paths for incomplete session raises error.
      <Class TestGetChats>
        Tests for get_chats method.
        <Coroutine test_get_chats_success>
          Test getting chats successfully.
      <Class TestGetChatInfo>
        Tests for get_chat_info method.
        <Coroutine test_get_chat_info_from_cache>
          Test getting cached chat info.
        <Coroutine test_get_chat_info_not_in_cache>
          Test getting chat info returns None if not cached.
      <Class TestAnalyzeChat>
        Tests for analyze_chat method.
        <Coroutine test_analyze_chat_success>
          Test analyzing a chat successfully.
        <Coroutine test_analyze_chat_without_cached_info>
          Test analyzing chat creates minimal chat info if not cached.
      <Class TestValidateSession>
        Tests for validate_session method.
        <Coroutine test_validate_session_success>
          Test validating a valid session.
        <Coroutine test_validate_session_not_found>
          Test validating non-existent session returns False.
        <Coroutine test_validate_session_validation_error>
          Test validating session with validation error returns False.
    <Module test_service_monitoring.py>
      Comprehensive tests for MonitoringService.
      <Class TestMonitoringExceptions>
        Tests for monitoring exception classes.
        <Function test_monitoring_error_base_exception>
          Test MonitoringError base exception.
        <Function test_monitor_not_found_error>
          Test MonitorNotFoundError exception.
      <Class TestMonitoringServiceInit>
        Tests for MonitoringService initialization.
        <Function test_init_with_explicit_db_path>
          Test initialization with explicit database path.
        <Function test_init_with_default_db_path>
          Test initialization with default database path.
      <Class TestEnsureLoader>
        Tests for _ensure_loader method.
        <Function test_ensure_loader_success>
          Test ensuring loader for valid session.
        <Function test_ensure_loader_already_loaded>
          Test ensuring loader when already loaded.
        <Function test_ensure_loader_session_not_found>
          Test ensuring loader for non-existent session.
        <Function test_ensure_loader_missing_session_file>
          Test ensuring loader with missing session file.
      <Class TestEnableMonitoring>
        Tests for enable_monitoring method.
        <Coroutine test_enable_monitoring_new_chat>
          Test enabling monitoring for a new chat.
        <Coroutine test_enable_monitoring_already_enabled>
          Test enabling monitoring for already monitored chat.
        <Coroutine test_enable_monitoring_re_enable_disabled>
          Test re-enabling a disabled monitor.
        <Coroutine test_enable_monitoring_empty_chat>
          Test enabling monitoring for chat with no messages.
        <Coroutine test_enable_monitoring_session_not_found>
          Test enabling monitoring with non-existent session.
      <Class TestDisableMonitoring>
        Tests for disable_monitoring method.
        <Coroutine test_disable_monitoring_without_delete>
          Test disabling monitoring without deleting data.
        <Coroutine test_disable_monitoring_with_delete>
          Test disabling monitoring with data deletion.
        <Coroutine test_disable_monitoring_not_found>
          Test disabling non-existent monitor.
        <Coroutine test_disable_monitoring_delete_not_found>
          Test deleting non-existent monitor.
      <Class TestSyncChat>
        Tests for sync_chat method.
        <Coroutine test_sync_chat_with_new_messages>
          Test syncing chat with new messages.
        <Coroutine test_sync_chat_no_new_messages>
          Test syncing chat with no new messages.
        <Coroutine test_sync_chat_first_sync>
          Test syncing chat with no previous message ID (first sync).
        <Coroutine test_sync_chat_with_new_authors>
          Test syncing chat with new unique authors.
        <Coroutine test_sync_chat_not_monitored>
          Test syncing chat that is not being monitored.
        <Coroutine test_sync_chat_disabled>
          Test syncing disabled monitor.
        <Coroutine test_sync_chat_updates_timestamps>
          Test that sync updates first_message_at when None.
      <Class TestSyncAllEnabled>
        Tests for sync_all_enabled method.
        <Coroutine test_sync_all_enabled_multiple_chats>
          Test syncing all enabled monitors.
        <Coroutine test_sync_all_enabled_with_failures>
          Test sync_all_enabled continues on individual failures.
        <Coroutine test_sync_all_enabled_no_monitors>
          Test sync_all_enabled with no enabled monitors.
      <Class TestGetMonitorState>
        Tests for get_monitor_state method.
        <Function test_get_monitor_state_exists>
          Test getting existing monitor state.
        <Function test_get_monitor_state_not_found>
          Test getting non-existent monitor state.
      <Class TestListMonitors>
        Tests for list_monitors method.
        <Function test_list_monitors_all>
          Test listing all monitors.
        <Function test_list_monitors_enabled_only>
          Test listing only enabled monitors.
        <Function test_list_monitors_empty>
          Test listing monitors for session with none.
      <Class TestGetMonitoringSummary>
        Tests for get_monitoring_summary method.
        <Function test_get_monitoring_summary_with_data>
          Test getting monitoring summary with data.
        <Function test_get_monitoring_summary_not_found>
          Test getting summary for non-existent monitor.
      <Class TestGetGrowthMetrics>
        Tests for get_growth_metrics method.
        <Function test_get_growth_metrics_with_data>
          Test getting growth metrics with snapshot data.
        <Function test_get_growth_metrics_no_data>
          Test getting growth metrics with no snapshots.
        <Function test_get_growth_metrics_custom_period>
          Test getting growth metrics for custom time period.
      <Class TestGetSnapshots>
        Tests for get_snapshots method.
        <Function test_get_snapshots_all>
          Test getting all snapshots.
        <Function test_get_snapshots_with_since>
          Test getting snapshots since a specific time.
        <Function test_get_snapshots_with_limit>
          Test getting snapshots with limit.
        <Function test_get_snapshots_empty>
          Test getting snapshots for chat with none.
      <Class TestGlobalMonitoringService>
        Tests for global monitoring service singleton.
        <Function test_get_monitoring_service_first_call>
          Test getting monitoring service on first call.
        <Function test_get_monitoring_service_subsequent_call>
          Test getting monitoring service on subsequent calls.
        <Function test_get_monitoring_service_without_init>
          Test getting service without initialization raises error.
        <Function test_reset_monitoring_service>
          Test resetting global monitoring service.
      <Class TestEdgeCasesAndErrors>
        Tests for edge cases and error handling.
        <Coroutine test_enable_monitoring_with_duplicate_authors>
          Test enabling monitoring with duplicate authors.
        <Coroutine test_sync_chat_cleanup_old_snapshots>
          Test that sync_chat cleans up old snapshots.
        <Coroutine test_enable_monitoring_preserves_snapshot_creation>
          Test that enable_monitoring creates a snapshot.
        <Function test_get_growth_metrics_zero_period_hours>
          Test growth metrics with very small period hours.
    <Module test_session.py>
      Tests for server-side session management.
      
      Tests cover:
      - SessionData: get/set/delete/clear, expiration, touch
      - SessionStore: create, get, delete, cleanup, thread-safety
      - get_session_store: singleton behavior
      - get_session: request integration
      - Cookie helpers: set_session_cookie, delete_session_cookie
      <Class TestSessionData>
        Tests for SessionData dataclass.
        <Function test_creation>
          SessionData should initialize with correct defaults.
        <Function test_get_missing_key>
          get() should return default for missing keys.
        <Function test_get_existing_key>
          get() should return stored value.
        <Function test_set>
          set() should store value and touch session.
        <Function test_delete>
          delete() should remove key and touch session.
        <Function test_delete_missing_key>
          delete() should not raise for missing key.
        <Function test_clear>
          clear() should remove all data and touch session.
        <Function test_touch>
          touch() should update last_accessed.
        <Function test_is_expired_false>
          is_expired() should return False for fresh session.
        <Function test_is_expired_true>
          is_expired() should return True for old session.
        <Function test_is_expired_custom_ttl>
          is_expired() should respect custom TTL.
      <Class TestSessionStore>
        Tests for SessionStore class.
        <Function test_create_session>
          create_session() should create new session with unique ID.
        <Function test_create_session_unique_ids>
          Each created session should have unique ID.
        <Function test_get_session_existing>
          get_session() should return existing session.
        <Function test_get_session_touches>
          get_session() should touch the session.
        <Function test_get_session_missing>
          get_session() should return None for missing ID.
        <Function test_get_session_beyond_ttl>
          get_session() should return None for session beyond TTL.
        <Function test_delete_session>
          delete_session() should remove session.
        <Function test_delete_session_missing>
          delete_session() should not raise for missing ID.
        <Function test_cleanup_expired>
          cleanup_expired() should remove expired sessions.
        <Function test_get_session_count>
          get_session_count() should return correct count.
        <Function test_thread_safety>
          Store should handle concurrent access.
      <Class TestGetSessionStore>
        Tests for get_session_store singleton.
        <Function test_returns_store>
          get_session_store() should return SessionStore instance.
        <Function test_singleton>
          get_session_store() should return same instance.
      <Class TestGetSession>
        Tests for get_session function.
        <Function test_creates_new_session>
          Should create new session if no cookie.
        <Function test_returns_existing_session_from_state>
          Should return session from request.state if present.
        <Function test_returns_session_from_cookie>
          Should return session from cookie if valid.
        <Function test_creates_new_if_cookie_invalid>
          Should create new session if cookie ID is invalid.
        <Function test_attaches_to_request_state>
          Should store session in request.state.
      <Class TestSetSessionCookie>
        Tests for set_session_cookie function.
        <Function test_sets_cookie>
          Should set cookie with session ID.
        <Function test_cookie_security_settings>
          Cookie should have secure settings.
      <Class TestDeleteSessionCookie>
        Tests for delete_session_cookie function.
        <Function test_deletes_cookie>
          Should delete the session cookie.
      <Class TestSessionIntegration>
        Integration tests for session workflow.
        <Function test_full_session_lifecycle>
          Test complete session lifecycle.
        <Function test_multiple_independent_sessions>
          Multiple sessions should be independent.
    <Module test_session_manager.py>
      Tests for SessionManager.
      <Class TestSessionManagerRegistration>
        Tests for session registration.
        <Function test_register_session>
          Test registering a session.
        <Function test_list_sessions_empty>
          Test listing sessions when empty.
        <Function test_unregister_session>
          Test unregistering a session.
      <Class TestSessionManagerConnect>
        Tests for session connection.
        <Coroutine test_connect_success>
          Test successful connection.
        <Coroutine test_connect_already_connected>
          Test that connecting an already connected session returns same client.
        <Coroutine test_connect_failure>
          Test connection failure.
        <Coroutine test_connect_timeout>
          Test connection timeout.
        <Coroutine test_connect_unregistered_session>
          Test connecting unregistered session raises KeyError.
      <Class TestSessionManagerDisconnect>
        Tests for session disconnection.
        <Coroutine test_disconnect_connected_session>
          Test disconnecting a connected session.
        <Coroutine test_disconnect_not_connected>
          Test disconnecting a session that was never connected.
        <Coroutine test_disconnect_nonexistent>
          Test disconnecting a nonexistent session.
        <Coroutine test_disconnect_all>
          Test disconnecting all sessions.
      <Class TestSessionManagerContextManager>
        Tests for session context manager.
        <Coroutine test_context_manager_auto_disconnect>
          Test that context manager auto-disconnects.
        <Coroutine test_context_manager_no_auto_disconnect>
          Test context manager with auto_disconnect=False.
        <Coroutine test_context_manager_exception_still_disconnects>
          Test that context manager disconnects even on exception.
      <Class TestSessionManagerHealthCheck>
        Tests for health check functionality.
        <Coroutine test_is_healthy_connected>
          Test health check for connected session.
        <Coroutine test_is_healthy_not_connected>
          Test health check for disconnected session.
        <Coroutine test_is_healthy_nonexistent>
          Test health check for nonexistent session.
      <Class TestSessionManagerInfo>
        Tests for session info.
        <Function test_get_info_registered_not_connected>
          Test getting info for registered but not connected session.
        <Coroutine test_get_info_connected>
          Test getting info for connected session.
        <Function test_get_info_nonexistent>
          Test getting info for nonexistent session.
      <Class TestSessionManagerLocking>
        Tests for per-session locking.
        <Coroutine test_concurrent_connects_rejected>
          Test that concurrent connect requests are rejected with SessionBusyError.
        <Coroutine test_unregister_connected_raises>
          Test that unregistering a connected session raises error.
      <Class TestSessionAuthErrors>
        Tests for session authentication error handling.
        <Coroutine test_connect_session_revoked_error>
          Test connection with SessionRevokedError raises SessionInvalidError.
        <Coroutine test_connect_auth_key_unregistered_error>
          Test connection with AuthKeyUnregisteredError raises SessionInvalidError.
        <Coroutine test_connect_phone_banned_error>
          Test connection with PhoneNumberBannedError raises SessionInvalidError.
        <Coroutine test_connect_user_deactivated_ban_error>
          Test connection with UserDeactivatedBanError raises SessionInvalidError.
        <Coroutine test_connect_session_password_needed_error>
          Test connection with SessionPasswordNeededError raises SessionReauthRequiredError.
        <Coroutine test_connect_telethon_auth_expiry_error>
          Test connection with Telethon SessionExpiredError raises SessionReauthRequiredError.
        <Coroutine test_invalid_session_state_and_error_message>
          Test that session state is set to ERROR with appropriate message.
        <Coroutine test_reauth_required_state_and_error_message>
          Test that session state is set to ERROR with appropriate message for reauth.
      <Class TestNetworkSwitchHandling>
        Tests for network switch detection and handling.
        <Function test_is_network_switch_error_broken_pipe>
          Test detection of BrokenPipeError as network switch.
        <Function test_is_network_switch_error_connection_reset>
          Test detection of ConnectionResetError as network switch.
        <Function test_is_network_switch_error_connection_aborted>
          Test detection of ConnectionAbortedError as network switch.
        <Function test_is_network_switch_error_oserror_with_errno>
          Test detection of OSError with network errno as network switch.
        <Function test_is_network_switch_error_oserror_by_message>
          Test detection of OSError by message content as network switch.
        <Function test_is_network_switch_error_regular_error>
          Test that regular errors are not detected as network switch.
        <Coroutine test_handle_network_switch_reconnects>
          Test that network switch handling reconnects the session.
        <Coroutine test_handle_network_switch_sets_recovery_flag>
          Test that network switch handling sets recovery flag during operation.
        <Coroutine test_handle_network_switch_resets_error_tracking>
          Test that successful network switch recovery resets error tracking.
        <Coroutine test_network_error_tracking_in_info>
          Test that network error tracking is included in session info.
        <Coroutine test_health_check_clears_old_network_errors>
          Test that successful health checks clear old network errors.
      <Class TestNetworkSwitchIntegration>
        Integration tests for network switch handling.
        <Coroutine test_health_check_detects_and_recovers_from_network_switch>
          Test that health check detects network switch and triggers recovery.
      <Class TestDeadSessionRecoveryFlow>
        Tests for dead session detection and recovery UX flow.
        <Coroutine test_dead_session_shows_expired_error_message>
          Test that dead session shows 'Session expired' error message, not generic 'Error'.
        <Coroutine test_dead_session_revoked_shows_distinct_status>
          Test that revoked session shows 'Session invalid' status distinct from temporary errors.
        <Coroutine test_dead_session_banned_account_shows_permanent_status>
          Test that banned account shows distinct permanent error status.
        <Coroutine test_temporary_error_vs_permanent_session_death>
          Test that temporary errors (network) are distinct from permanent session death.
        <Coroutine test_session_recovery_preserves_session_id>
          Test that session recovery preserves session ID during reconnection.
        <Coroutine test_reauth_required_error_is_recoverable>
          Test that SessionReauthRequiredError indicates session can be recovered via re-auth.
        <Coroutine test_reconnect_flow_same_session_id>
          Test that reconnect button preserves same session ID for recovery flow.
      <Class TestAuthKeyUnregisteredAutoRecovery>
        Tests for AuthKeyUnregistered detection and auto-recovery flow.
        
        When SessionManager detects AuthKeyUnregisteredError during connect():
        1. It sets session state to ERROR with appropriate message
        2. It raises SessionInvalidError to signal caller should handle recovery
        3. The caller (e.g., router) can then delete the invalid session file and retry
        
        These tests verify SessionManager correctly identifies AuthKeyUnregistered
        as a recoverable error that requires session file deletion and re-authentication.
        <Coroutine test_connect_authkey_unregistered_auto_delete>
          Test that AuthKeyUnregisteredError is correctly identified for auto-recovery.
          
          SessionManager should:
          - Raise SessionInvalidError (not SessionConnectError)
          - Set state to ERROR with recovery-oriented message
          - Allow the session to be unregistered and re-registered for recovery
        <Coroutine test_session_file_deletion_signaled_for_authkey_unregistered>
          Verify SessionManager state indicates session file should be deleted.
          
          After AuthKeyUnregisteredError, the error message should clearly indicate
          that the session file is invalid and needs to be replaced.
        <Coroutine test_reregister_after_authkey_unregistered_allows_recovery>
          Test that session can be re-registered after AuthKeyUnregistered for recovery.
          
          After AuthKeyUnregisteredError:
          1. Session is in ERROR state
          2. Disconnect and unregister should work
          3. Re-registering with new client should allow fresh connection
          
          This simulates the recovery flow where session file is deleted and
          a new session file is created.
        <Coroutine test_authkey_unregistered_vs_other_auth_errors>
          Verify AuthKeyUnregisteredError is handled same as SessionRevokedError.
          
          Both AuthKeyUnregisteredError and SessionRevokedError should:
          - Raise SessionInvalidError (not SessionReauthRequiredError)
          - Indicate permanent session invalidity
          - Require new session file (not just re-authentication)
          
          This is different from SessionExpiredError which raises SessionReauthRequiredError.
    <Module test_session_recovery.py>
      Tests for automatic recovery from expired/corrupted session files.
      
      Tests verify that _do_connect_in_background_v2 automatically handles:
      - AuthKeyUnregisteredError → delete session.session → send_code → 'needs_code'
      - SessionRevokedError → delete session.session → send_code → 'needs_code'
      - SessionExpiredError → delete session.session → send_code → 'needs_code'
      - Corrupted session file → delete session.session → send_code → 'needs_code'
      
      User should NEVER see 'session_expired' or 'corrupted_session' state.
      
      NOTE: session_manager.connect() wraps Telethon errors in SessionInvalidError/
      SessionReauthRequiredError/SessionConnectError. Tests must use these wrappers
      with __cause__ set to the original Telethon error.
      <Coroutine test_authkey_unregistered_triggers_recovery>
        Test AuthKeyUnregisteredError triggers auto-recovery flow.
      <Coroutine test_session_revoked_triggers_recovery>
        Test SessionRevokedError triggers auto-recovery flow.
      <Coroutine test_session_expired_triggers_recovery>
        Test SessionExpiredError triggers auto-recovery flow.
      <Coroutine test_corrupted_session_file_triggers_recovery>
        Test corrupted session.session file triggers auto-recovery flow.
        
        When session.session SQLite file is corrupted (e.g., struct.error during connect),
        the system should:
        1. Delete the corrupted file
        2. Trigger send_code flow
        3. NOT publish 'corrupted_session' event
        
        This verifies SPEC.md Must Have #3: auto-recovery without exposing 'corrupted_session' to user.
      <Coroutine test_recovery_without_phone_publishes_error>
        Test recovery fails gracefully if phone number is missing.
    <Module test_sessions_router.py>
      Tests for sessions router.
      <Class TestReadUploadWithSizeLimit>
        Tests for chunked file reading with size limits.
        <Coroutine test_read_small_file>
          Test reading a file within size limit.
        <Coroutine test_read_file_exceeds_limit>
          Test that reading a file exceeding size limit raises ValueError.
        <Coroutine test_read_exact_limit>
          Test reading a file exactly at the size limit.
        <Coroutine test_read_chunked_file>
          Test reading a file in multiple chunks.
      <Class TestSanitizeSessionName>
        Tests for session name sanitization.
        <Function test_valid_name_alphanumeric>
          Test valid alphanumeric name.
        <Function test_valid_name_with_underscore>
          Test valid name with underscore.
        <Function test_valid_name_with_hyphen>
          Test valid name with hyphen.
        <Function test_removes_path_traversal>
          Test that path traversal characters are removed.
        <Function test_removes_special_characters>
          Test that special characters are removed.
        <Function test_empty_after_sanitization_raises>
          Test that empty name after sanitization raises ValueError.
        <Function test_truncates_long_name>
          Test that long names are truncated to 64 chars.
      <Class TestValidateSessionFileFormat>
        Tests for session file format validation.
        <Function test_valid_session_file>
          Test validation of valid Telethon 1.x session file.
        <Function test_invalid_not_sqlite>
          Test rejection of non-SQLite files.
        <Function test_invalid_missing_sessions_table>
          Test rejection of SQLite without required Telethon 1.x tables.
        <Function test_invalid_empty_sessions>
          Test rejection of empty sessions table.
        <Function test_telethon_2x_session_rejected>
          Test that Telethon 2.x session format is detected and rejected at upload time.
        <Function test_valid_telethon_1x_session>
          Test that valid Telethon 1.x session with required tables is accepted.
      <Class TestValidateConfigFileFormat>
        Tests for config file format validation.
        <Function test_valid_config>
          Test validation of valid config.
        <Function test_valid_config_api_id_as_string>
          Test validation with api_id as string.
        <Function test_invalid_json>
          Test rejection of invalid JSON.
        <Function test_missing_api_id>
          Test that config without api_id is now allowed (nullable).
        <Function test_missing_api_hash>
          Test that config without api_hash is now allowed (nullable).
        <Function test_invalid_api_id_type>
          Test rejection of invalid api_id type.
        <Function test_empty_api_hash>
          Test rejection of empty api_hash.
        <Function test_empty_config_file>
          Test rejection of empty config file.
        <Function test_whitespace_only_config>
          Test rejection of whitespace-only config file.
        <Function test_not_json_object_array>
          Test rejection of JSON array instead of object.
        <Function test_not_json_object_string>
          Test rejection of JSON string instead of object.
        <Function test_invalid_utf8>
          Test rejection of invalid UTF-8 encoding.
        <Function test_unknown_fields_lenient>
          Test that unknown fields are accepted with warning (lenient mode).
        <Function test_no_warning_for_known_fields_only>
          Test that no warning is logged when only known fields are present.
      <Class TestSessionsAPIEndpoints>
        Tests for session API endpoints.
        <Function test_get_sessions_empty>
          Test getting sessions when none exist.
        <Function test_home_page_loads>
          Test that home page loads successfully.
        <Function test_upload_session_invalid_name>
          Test upload with invalid session name.
        <Function test_upload_session_invalid_session_file>
          Test upload with invalid session file.
        <Function test_upload_session_invalid_config>
          Test upload with config that has no api_hash now succeeds (nullable).
        <Function test_delete_session_not_found>
          Test deleting non-existent session.
        <Function test_delete_session_invalid_name>
          Test deleting with invalid session name.
        <Function test_upload_config_file_too_large>
          Test that config files exceeding size limit are rejected.
        <Function test_upload_session_file_too_large>
          Test that session files exceeding size limit are rejected.
        <Function test_upload_session_with_json_file>
          Test upload .session + valid .json with phone extraction.
        <Function test_upload_session_json_invalid>
          Test upload .session + invalid JSON → error.
        <Function test_upload_session_json_with_2fa>
          Test upload .session + JSON with 2FA → encrypted storage.
      <Class TestMigrateLegacySessions>
        Tests for legacy session migration (v0.4 -> v0.5).
        <Function test_migrate_legacy_session_creates_config>
          Test that migration creates config.json from keyring credentials.
        <Function test_migrate_skips_already_migrated>
          Test that migration skips sessions that already have config.json.
        <Function test_migrate_handles_missing_credentials>
          Test that migration handles sessions without credentials gracefully.
        <Function test_migrate_skips_non_session_directories>
          Test that migration skips directories without session.session file.
      <Class TestSessionConfigAPI>
        Tests for session configuration API endpoints.
        <Function test_get_session_config_success>
          Test getting session configuration form.
        <Function test_get_session_config_not_found>
          Test getting config for non-existent session.
          
          Edit button should always return config form, even if files are missing.
          This allows users to fix configuration issues via the Edit form.
        <Function test_get_session_config_invalid_name>
          Test getting config with invalid session name.
        <Function test_update_session_config_success>
          Test updating session proxy configuration.
        <Function test_update_session_config_proxy_required>
          Test that proxy selection is required.
        <Function test_update_session_config_proxy_not_found>
          Test updating with non-existent proxy ID.
        <Function test_update_session_config_session_not_found>
          Test updating config for non-existent session.
      <Class TestSessionConnectDisconnectAPI>
        Tests for session connect/disconnect API endpoints.
        <Function test_connect_session_not_found>
          Test connecting non-existent session returns 404.
        <Function test_connect_session_invalid_name>
          Test connecting with invalid session name returns 200 with error state.
        <Function test_connect_session_not_configured>
          Test connecting unconfigured session returns needs_config state.
        <Function test_connect_session_proxy_missing>
          Test connecting session with missing proxy returns needs_config.
        <Function test_connect_session_success>
          Test session connection - returns immediately with 'connecting' state.
        <Function test_connect_session_failure>
          Test session connection failure - HTTP returns 'connecting', error via SSE.
        <Function test_connect_session_concurrent_request_returns_connecting>
          Test concurrent connection request returns 'connecting' - error via SSE.
        <Function test_connect_session_timeout_returns_connecting>
          Test session connection timeout - HTTP returns 'connecting', error via SSE.
        <Function test_connect_session_missing_session_file>
          Test connect with missing session.session file triggers send_code flow.
          
          Scenario: Session exists with config.json but NO session.session file
          Expected: HTTP 200 with 'connecting' state, background task triggers send_code → 'needs_code' via SSE
        <Function test_connect_session_invalid_session_auto_reauth>
          Test connect with invalid session.session (AuthKeyUnregistered) triggers auto-reauth.
          
          Scenario: Session exists with config.json and corrupted session.session
          Expected: HTTP 200 with 'connecting' state, background task detects AuthKeyUnregistered,
                    deletes file, triggers send_code → 'needs_code' via SSE
                    (no removed legacy status shown - now 'disconnected')
        <Function test_disconnect_session_invalid_name>
          Test disconnecting with invalid session name returns 400.
        <Function test_disconnect_session_success>
          Test successful session disconnection.
        <Function test_disconnect_session_not_connected>
          Test disconnecting session that's not connected still succeeds.
      <Class TestDeadSessionRecoveryUX>
        Tests for dead session error messages and recovery UX flow.
        <Function test_dead_session_returns_connecting_state>
          Test that dead session returns 'connecting' immediately - error via SSE.
        <Function test_expired_session_connect_returns_connecting>
          Test that expired session connect returns 'connecting' - error via SSE.
        <Function test_session_recovery_preserves_session_id>
          Test that session recovery preserves session ID.
        <Function test_temporary_error_vs_permanent_session_death_ui>
          Test that UI distinguishes temporary errors from permanent session death.
      <Class TestAPICredentialReValidation>
        Tests for API credential re-validation when credentials change on existing session.
        <Function test_change_api_id_triggers_disconnect_and_reauth>
          Test that changing API_ID on existing session triggers disconnect + re-auth flow.
        <Function test_invalid_api_id_rejected_not_saved>
          Test that invalid API_ID/API_HASH credentials are rejected and not saved.
        <Function test_valid_credentials_needing_auth_triggers_reconnect>
          Test that valid but unauthenticated credentials trigger reconnect/code modal.
        <Function test_credentials_not_saved_before_validation_success>
          Test that only save credentials AFTER successful validation.
        <Function test_network_error_during_validation_shows_proxy_error>
          Test that network/proxy errors during validation show helpful message.
      <Class TestVerify2FA>
        Tests for verify-2fa endpoint password validation.
        
        Tests the verify_2fa endpoint password validation directly by checking
        the validation logic without full integration testing.
        <Function test_password_validation_logic>
          Test password validation logic handles empty and whitespace passwords.
        <Coroutine test_verify_code_2fa_auto_fails_shows_manual_modal>
          Test verify_code recovery when 2FA auto-entry fails (wrong stored password).
          
          Scenario:
          1. Code verification succeeds → SessionPasswordNeededError (2FA required)
          2. Handler attempts auto-entry with stored 2FA password
          3. Auto-entry fails with PasswordHashInvalidError (wrong password)
          4. Handler shows manual 2FA form modal (doesn't block user)
          5. User can now enter 2FA password manually
          
          This verifies the recovery path when stored 2FA password is incorrect.
      <Class TestBackwardCompatibilityLegacySessions>
        Tests for backward compatibility with old session format.
        
        Old sessions have config.json + session.session but NO account_info.json.
        This tests that the refactored code handles missing account_info gracefully.
        <Function test_list_stored_sessions_without_session_file>
          Test that sessions without session.session file appear with 'disconnected' state.
          
          A session that has config.json + account_info.json but NO session.session should:
          1. Appear in list_stored_sessions with state='disconnected'
          2. Have has_session_file=False
          3. Show in UI (not be filtered out)
          
          This covers the scenario where:
          - User uploaded config but hasn't connected yet
          - Session file was deleted/corrupted but metadata exists
      <Class TestValidateAccountInfoJson>
        Tests for JSON account info validation.
        <Function test_valid_json_minimal>
          Test valid JSON with only required phone field.
        <Function test_valid_json_all_fields>
          Test valid JSON with all allowed fields.
        <Function test_valid_phone_without_plus>
          Test valid phone without + prefix.
        <Function test_invalid_not_dict>
          Test rejection of non-dict JSON (array).
        <Function test_invalid_unknown_fields>
          Test rejection of unknown fields.
        <Function test_invalid_nested_object>
          Test rejection of nested objects.
        <Function test_invalid_nested_array>
          Test rejection of arrays in fields.
        <Function test_invalid_missing_phone>
          Test rejection of missing phone field.
        <Function test_invalid_empty_phone>
          Test rejection of empty phone field.
        <Function test_invalid_phone_format_letters>
          Test rejection of phone with letters.
        <Function test_invalid_phone_too_short>
          Test rejection of too short phone.
        <Function test_invalid_phone_too_long>
          Test rejection of too long phone.
        <Function test_invalid_phone_leading_zero>
          Test rejection of phone starting with 0 after country code.
      <Class TestVerifyCode2FAAutoEntry>
        Tests for 2FA auto-entry during verify_code endpoint.
        <Coroutine test_verify_code_auto_2fa_success>
          Test verify_code with auto 2FA success.
        <Coroutine test_verify_code_auto_2fa_missing>
          Test verify_code with no stored 2FA shows modal.
        <Coroutine test_verify_code_auto_2fa_wrong>
          Test verify_code with wrong 2FA password shows error.
      <Class TestSessionImport>
        Tests for session import endpoints (dual file upload).
        <Function test_validate_import_session_success>
          Test successful validation with both session and JSON files.
        <Function test_validate_import_session_invalid_json_missing_phone>
          Test validation fails when JSON missing phone field.
        <Function test_validate_import_session_invalid_phone_format>
          Test validation fails with invalid phone format.
        <Function test_save_import_session_success>
          Test successful session import with JSON account info.
        <Function test_save_import_session_duplicate_name>
          Test that duplicate session name is rejected.
    <Module test_sse_integration.py>
      Integration tests for SSE endpoint.
      
      Tests cover:
      - Client connects to SSE stream
      - Events published via event bus are received
      - Events are in correct SSE format
      - Connection cleanup on disconnect
      <Class TestSSEIntegration>
        Integration tests for SSE /api/sessions/events endpoint.
        <Function test_sse_endpoint_is_defined>
          SSE endpoint should be defined and routable.
        <Function test_sse_endpoint_route_exists>
          SSE endpoint /api/sessions/events should be registered.
        <Coroutine test_sse_event_bus_integration>
          SSE endpoint should subscribe to and receive events from bus.
        <Coroutine test_sse_multiple_events_via_bus>
          Event bus should deliver multiple events to subscribers.
        <Coroutine test_sse_event_format_correct>
          Events should have correct format (session_id and status fields).
        <Coroutine test_sse_event_bus_subscription>
          Event bus should track subscribers correctly.
        <Coroutine test_sse_deduplication>
          Event bus should drop duplicate consecutive events.
        <Coroutine test_sse_rate_limiting>
          Event bus should rate limit events per session.
        <Coroutine test_sse_handler_in_router>
          SSE endpoint handler should properly integrate with router.
        <Coroutine test_sse_stream_format>
          Events in SSE stream should be properly formatted.
        <Coroutine test_sse_handles_exception_in_subscriber>
          Event bus should continue if one subscriber fails.
        <Coroutine test_sse_endpoint_returns_streaming_response>
          SSE endpoint should return StreamingResponse with correct headers.
        <Coroutine test_sse_endpoint_cleans_up_on_disconnect>
          SSE endpoint should unsubscribe handler when client disconnects.
        <Coroutine test_sse_connection_stability_multiple_events>
          SMOKE TEST: SSE connection should handle multiple consecutive events without dropping.
        <Coroutine test_sse_connection_stability_reconnection>
          SMOKE TEST: SSE should handle client reconnection gracefully.
        <Coroutine test_sse_connection_stability_no_memory_leak>
          SMOKE TEST: Long-running SSE connections should not leak memory.
    <Module test_start_auth_flow.py>
      Tests for start_auth_flow validation.
      <Class TestStartAuthFlowValidation>
        Tests for api_id/api_hash validation in start_auth_flow.
        <Function test_valid_credentials_accepted>
          Test that valid api_id and api_hash are accepted.
        <Function test_empty_credentials_accepted>
          Test that empty api_id and api_hash are accepted (SPEC allows this).
        <Function test_api_id_without_api_hash_rejected>
          Test that api_id without api_hash is rejected.
        <Function test_api_hash_without_api_id_rejected>
          Test that api_hash without api_id is rejected.
        <Function test_zero_api_id_rejected>
          Test that api_id <= 0 is rejected.
        <Function test_negative_api_id_rejected>
          Test that negative api_id is rejected.
        <Function test_invalid_api_hash_format_rejected>
          Test that invalid api_hash format is rejected.
        <Function test_short_api_hash_rejected>
          Test that api_hash shorter than 32 chars is rejected.
        <Function test_non_hex_api_hash_rejected>
          Test that api_hash with non-hex characters is rejected.
    <Module test_startup_smoke.py>
      Smoke test for ChatFilter startup verification.
      
      This test ensures the application can start successfully and serve basic endpoints.
      Run with: pytest tests/test_startup_smoke.py
      <Function test_app_startup_and_sessions_endpoint>
        Test that 'chatfilter --port 8000' starts successfully.
        
        Verifies:
        - App starts without errors
        - GET /api/sessions returns 200
        - No exceptions in startup logs
        
        This is a deployment smoke test to ensure the app can be deployed.
    <Module test_storage.py>
      Tests for storage layer.
      <Class TestFileStorage>
        Tests for FileStorage implementation.
        <Function test_save_and_load_bytes>
          Test saving and loading binary data.
        <Function test_save_and_load_string>
          Test saving and loading string data.
        <Function test_save_creates_parent_dirs>
          Test that save creates parent directories.
        <Function test_atomic_write>
          Test that writes are atomic (no partial files on error).
        <Function test_load_nonexistent_file>
          Test loading non-existent file raises StorageNotFoundError.
        <Function test_delete_file>
          Test deleting a file.
        <Function test_delete_directory>
          Test deleting a directory recursively.
        <Function test_delete_nonexistent_path>
          Test deleting non-existent path raises StorageNotFoundError.
        <Function test_exists>
          Test exists check.
        <Function test_list_files>
          Test listing files with glob pattern.
        <Function test_list_files_nonexistent_dir>
          Test listing non-existent directory raises StorageNotFoundError.
        <Function test_ensure_dir>
          Test ensuring directory exists.
        <Function test_ensure_dir_idempotent>
          Test ensuring existing directory is idempotent.
        <Function test_temp_file_cleanup_on_normal_operation>
          Test that temp files are cleaned up after successful save.
        <Function test_temp_file_cleanup_on_error>
          Test that temp files are cleaned up even when save fails.
        <Function test_orphaned_temp_files_cleanup>
          Test cleanup of orphaned temp files from previous crashes.
        <Function test_orphaned_temp_files_cleanup_nonexistent_dir>
          Test cleanup handles nonexistent directories gracefully.
        <Function test_orphaned_temp_files_cleanup_empty_dir>
          Test cleanup handles empty directories.
        <Function test_atomic_write_temp_file_registration>
          Test that temp files are registered for atexit cleanup.
        <Function test_cleanup_old_session_files>
          Test cleanup of old session files.
        <Function test_cleanup_old_session_files_with_config>
          Test cleanup of old session files including legacy config.json.
        <Function test_cleanup_old_session_files_nonexistent_dir>
          Test cleanup handles nonexistent directories gracefully.
        <Function test_cleanup_old_session_files_empty_dir>
          Test cleanup handles empty directories.
        <Function test_cleanup_old_session_files_no_sessions_old_enough>
          Test cleanup when no sessions exceed the threshold.
      <Class TestJSONHelpers>
        Tests for JSON helper functions.
        <Function test_save_and_load_json>
          Test saving and loading JSON data.
        <Function test_save_json_with_unicode>
          Test saving JSON with unicode characters.
        <Function test_save_json_creates_dirs>
          Test that save_json creates parent directories.
        <Function test_load_json_invalid_file>
          Test loading invalid JSON raises StorageCorruptedError.
        <Function test_load_json_nonexistent_file>
          Test loading non-existent JSON file raises StorageNotFoundError.
      <Class TestEncryptedStorage>
        Tests for EncryptedStorage decorator.
        <Function test_save_and_load_encrypted>
          Test saving and loading encrypted data.
        <Function test_save_string_content>
          Test saving string content (should be converted to bytes).
        <Function test_encrypted_file_is_not_plaintext>
          Test that saved file is actually encrypted (not plaintext).
        <Function test_machine_derived_key>
          Test using machine-derived encryption key.
        <Function test_wrong_key_fails_decryption>
          Test that decryption fails with wrong key.
        <Function test_key_rotation_support>
          Test key rotation: old files can still be decrypted with old key.
        <Function test_corrupted_file_raises_error>
          Test that corrupted encrypted file raises StorageCorruptedError.
        <Function test_invalid_magic_raises_error>
          Test that file with invalid magic raises StorageCorruptedError.
        <Function test_unsupported_version_raises_error>
          Test that unsupported format version raises StorageCorruptedError.
        <Function test_decorator_delegates_other_methods>
          Test that EncryptedStorage delegates exists/delete/etc to wrapped storage.
        <Function test_list_files_with_encrypted_storage>
          Test that list_files works with encrypted storage.
        <Function test_ensure_dir_with_encrypted_storage>
          Test that ensure_dir works with encrypted storage.
        <Function test_derive_key_from_machine_id_is_deterministic>
          Test that deriving key from machine ID produces same key.
        <Function test_derive_key_from_machine_id_is_valid_fernet_key>
          Test that derived key is valid Fernet key.
        <Function test_encryption_with_unicode_content>
          Test encrypting unicode content.
        <Function test_large_file_encryption>
          Test encrypting large files.
        <Function test_tampered_encrypted_data_fails_decryption>
          Test that tampering with encrypted data causes decryption to fail.
    <Module test_storage_errors.py>
      Tests for storage layer exceptions.
      
      Tests cover:
      - StorageError: base exception
      - StorageNotFoundError: file not found
      - StoragePermissionError: permission denied
      - StorageValidationError: validation failed
      - StorageCorruptedError: corrupted data
      <Class TestStorageError>
        Tests for StorageError base exception.
        <Function test_is_exception>
          StorageError should be an Exception.
        <Function test_can_be_raised>
          Should be raisable with message.
        <Function test_can_be_caught_as_exception>
          Should be catchable as Exception.
      <Class TestStorageNotFoundError>
        Tests for StorageNotFoundError.
        <Function test_inherits_from_storage_error>
          Should inherit from StorageError.
        <Function test_can_be_raised>
          Should be raisable with message.
        <Function test_can_be_caught_as_storage_error>
          Should be catchable as StorageError.
      <Class TestStoragePermissionError>
        Tests for StoragePermissionError.
        <Function test_inherits_from_storage_error>
          Should inherit from StorageError.
        <Function test_can_be_raised>
          Should be raisable with message.
      <Class TestStorageValidationError>
        Tests for StorageValidationError.
        <Function test_inherits_from_storage_error>
          Should inherit from StorageError.
        <Function test_can_be_raised>
          Should be raisable with message.
      <Class TestStorageCorruptedError>
        Tests for StorageCorruptedError.
        <Function test_inherits_from_storage_error>
          Should inherit from StorageError.
        <Function test_can_be_raised>
          Should be raisable with message.
      <Class TestExceptionHierarchy>
        Tests for exception hierarchy.
        <Function test_all_inherit_from_storage_error>
          All storage exceptions should inherit from StorageError.
        <Function test_catch_all_with_storage_error>
          Should be able to catch all exceptions with StorageError.
    <Module test_storage_helpers.py>
      Tests for storage helper functions.
      
      Tests cover:
      - atomic_write: atomic file writing
      - save_json: JSON serialization and writing
      - load_json: JSON loading and deserialization
      <Class TestAtomicWrite>
        Tests for atomic_write function.
        <Function test_writes_string_content>
          Should write string content.
        <Function test_writes_bytes_content>
          Should write bytes content.
        <Function test_uses_custom_storage>
          Should use custom storage if provided.
      <Class TestSaveJson>
        Tests for save_json function.
        <Function test_saves_dict>
          Should save dictionary as JSON.
        <Function test_saves_list>
          Should save list as JSON.
        <Function test_custom_indent>
          Should use custom indentation.
        <Function test_raises_on_unserializable>
          Should raise StorageValidationError for unserializable data.
        <Function test_unicode_content>
          Should handle Unicode content.
      <Class TestLoadJson>
        Tests for load_json function.
        <Function test_loads_valid_json>
          Should load valid JSON data.
        <Function test_loads_array>
          Should load JSON array.
        <Function test_raises_on_invalid_json>
          Should raise StorageCorruptedError for invalid JSON.
        <Function test_raises_on_invalid_encoding>
          Should raise StorageCorruptedError for invalid UTF-8.
        <Function test_uses_custom_storage>
          Should use custom storage if provided.
    <Module test_task_database.py>
      Tests for task database persistence.
      <Function test_database_initialization>
        Test that database initializes with correct schema.
      <Function test_save_and_load_task>
        Test saving and loading a task.
      <Function test_load_nonexistent_task>
        Test loading a task that doesn't exist.
      <Function test_update_task_status>
        Test updating task status.
      <Function test_save_task_result>
        Test saving analysis results.
      <Function test_save_multiple_results>
        Test saving multiple results for a task.
      <Function test_load_all_tasks>
        Test loading all tasks.
      <Function test_load_incomplete_tasks>
        Test loading only incomplete tasks.
      <Function test_delete_task>
        Test deleting a task.
      <Function test_delete_task_cascades_results>
        Test that deleting a task also deletes its results.
      <Function test_delete_completed_tasks>
        Test bulk deletion of completed tasks.
      <Function test_task_with_error>
        Test saving and loading a task with an error.
      <Function test_current_chat_index_persistence>
        Test that current_chat_index is persisted correctly.
    <Module test_task_queue.py>
      Tests for the analysis task queue.
      <Class TestTaskQueue>
        Tests for TaskQueue class.
        <Function test_create_task>
          Test creating a new task.
        <Function test_get_task>
          Test retrieving a task by ID.
        <Function test_get_nonexistent_task>
          Test retrieving a non-existent task returns None.
        <Function test_get_all_tasks>
          Test retrieving all tasks.
        <Coroutine test_run_task_success>
          Test running a task successfully.
        <Coroutine test_run_task_partial_failure>
          Test that task continues even if some chats fail.
        <Coroutine test_subscribe_and_receive_events>
          Test subscribing to progress events.
        <Coroutine test_subscribe_nonexistent_task>
          Test subscribing to non-existent task raises error.
        <Function test_cancel_pending_task>
          Test cancelling a pending task.
        <Coroutine test_cancel_in_progress_task>
          Test cancelling a task while it's running.
        <Function test_cancel_completed_task>
          Test cancelling a completed task returns False.
        <Function test_clear_completed>
          Test clearing completed tasks.
        <Function test_find_active_task_exact_match>
          Test finding an active task with exact matching parameters.
        <Function test_find_active_task_order_independent>
          Test finding task works regardless of chat_ids order.
        <Function test_find_active_task_no_match_different_session>
          Test that different session_id doesn't match.
        <Function test_find_active_task_no_match_different_chats>
          Test that different chat_ids don't match.
        <Function test_find_active_task_no_match_different_limit>
          Test that different message_limit doesn't match.
        <Function test_find_active_task_ignores_completed>
          Test that completed tasks are not returned.
        <Function test_find_active_task_ignores_failed>
          Test that failed tasks are not returned.
        <Function test_find_active_task_finds_in_progress>
          Test that in-progress tasks are found.
        <Function test_find_active_task_returns_first_match>
          Test that only one task is returned when multiple match.
        <Coroutine test_task_timeout>
          Test that tasks timeout after exceeding max execution time.
        <Coroutine test_per_chat_timeout>
          Test that individual chats timeout if they take too long.
        <Coroutine test_stalled_task_detection>
          Test that stalled tasks are detected and cancelled.
        <Coroutine test_force_cancel_running_task>
          Test force cancelling a running task.
        <Coroutine test_force_cancel_nonexistent_task>
          Test force cancelling non-existent task returns False.
        <Coroutine test_shutdown_cancels_running_tasks>
          Test that shutdown cancels all running tasks.
        <Function test_clear_completed_includes_timeout>
          Test that clear_completed removes timeout tasks.
        <Function test_find_active_task_ignores_timeout>
          Test that timeout tasks are not returned as active.
        <Coroutine test_sse_backpressure_consecutive_full_queue>
          Test that slow SSE clients are forcibly disconnected after consecutive full queues.
        <Coroutine test_sse_backpressure_total_dropped_events>
          Test that clients are disconnected after exceeding total dropped events threshold.
        <Coroutine test_sse_backpressure_healthy_client_not_disconnected>
          Test that healthy clients that consume events are not disconnected.
        <Coroutine test_sse_backpressure_disabled>
          Test that backpressure disconnect can be disabled.
      <Class TestConcurrentTaskLimit>
        Tests for concurrent task limit functionality.
        <Function test_create_task_within_limit>
          Test creating tasks within the concurrent limit.
        <Function test_create_task_exceeds_limit>
          Test creating task when limit is exceeded raises QueueFullError.
        <Function test_create_task_after_completion>
          Test creating task after one completes.
        <Function test_create_task_disabled_limit>
          Test that limit=0 disables the check.
        <Function test_count_active_tasks_excludes_completed>
          Test that completed tasks are not counted as active.
      <Class TestGlobalTaskQueue>
        Tests for global task queue singleton.
        <Function test_get_task_queue_returns_same_instance>
          Test that get_task_queue returns the same instance.
        <Function test_reset_task_queue>
          Test resetting the global task queue.
    <Module test_task_queue_persistence.py>
      Tests for TaskQueue persistence and recovery.
      <Function test_task_queue_with_database>
        Test that TaskQueue can be initialized with a database.
      <Function test_task_queue_without_database>
        Test that TaskQueue works without a database (in-memory only).
      <Function test_create_task_persists_to_database>
        Test that creating a task persists it to the database.
      <Function test_recovery_loads_incomplete_tasks>
        Test that TaskQueue loads incomplete tasks on initialization.
      <Function test_recovery_resets_in_progress_to_pending>
        Test that in-progress tasks are reset to pending on recovery.
      <Function test_cancel_task_persists_to_database>
        Test that cancelling a task persists the change.
      <Function test_clear_completed_removes_from_memory_preserves_database>
        Test that clearing completed tasks removes them from memory but preserves in database.
      <Coroutine test_run_task_persists_progress>
        Test that task progress is persisted during execution.
      <Coroutine test_run_task_handles_individual_chat_failures>
        Test that individual chat failures don't fail the entire task.
        
        The task should complete with partial results when some chats fail.
        This is intentional resilient behavior - we don't want one bad chat
        to fail an entire batch analysis.
      <Function test_get_task_queue_with_database>
        Test global get_task_queue function with database.
      <Function test_stale_task_detection_marks_old_tasks_as_failed>
        Test that tasks older than threshold are marked as FAILED on recovery.
      <Function test_stale_task_detection_resets_recent_tasks>
        Test that recent in-progress tasks are reset to PENDING on recovery.
      <Function test_stale_task_detection_uses_started_at_when_available>
        Test that stale detection uses started_at if available, else created_at.
      <Function test_stale_task_detection_uses_created_at_when_no_started_at>
        Test that stale detection uses created_at when started_at is None.
      <Function test_stale_task_detection_with_different_threshold>
        Test that stale detection respects the configured threshold.
      <Function test_stale_task_detection_mixed_recovery>
        Test recovery with mix of stale, recent, and pending tasks.
    <Module test_telegram_client.py>
      Tests for TelegramClientLoader and related functionality.
      <Class TestTelegramConfig>
        Tests for TelegramConfig class.
        <Function test_from_json_file_valid>
          Test loading valid config file.
        <Function test_repr_redacts_api_hash>
          Test that repr redacts api_hash for security.
        <Function test_str_redacts_api_hash>
          Test that str redacts api_hash for security.
        <Function test_from_secure_storage_success>
          Test loading config from secure storage.
        <Function test_from_secure_storage_credential_not_found>
          Test error when credentials not found in secure storage.
        <Function test_from_secure_storage_general_error>
          Test error handling for general errors in secure storage.
        <Function test_from_json_file_api_id_as_string>
          Test loading config with api_id as string (should convert).
        <Function test_from_json_file_not_found>
          Test error when config file doesn't exist.
        <Function test_from_json_file_invalid_json>
          Test error when config file is not valid JSON.
        <Function test_from_json_file_missing_api_id>
          Test error when api_id is missing.
        <Function test_from_json_file_missing_api_hash>
          Test error when api_hash is missing.
        <Function test_from_json_file_invalid_api_id_type>
          Test error when api_id cannot be converted to int.
        <Function test_from_json_file_invalid_api_hash_type>
          Test error when api_hash is not a string.
        <Function test_from_json_file_empty_api_hash>
          Test error when api_hash is empty.
      <Class TestValidateSessionFile>
        Tests for validate_session_file function.
        <Function test_valid_session>
          Test validation of valid session file.
        <Function test_session_not_found>
          Test error when session file doesn't exist.
        <Function test_invalid_file_not_sqlite>
          Test error when file is not a SQLite database.
        <Function test_empty_session_no_data>
          Test error when session file has no session data.
        <Function test_missing_required_tables>
          Test error when session file is missing required tables.
        <Function test_locked_session_file>
          Test error when session file is locked by another process.
        <Function test_telethon_2x_session_detected>
          Test that Telethon 2.x session format is detected and rejected.
      <Class TestTelegramClientLoader>
        Tests for TelegramClientLoader class.
        <Function test_validate_success>
          Test successful validation of both files.
          
          Note: Since validate() now requires proxy_id and proxy in pool,
          we manually set proxy_id and mock get_proxy_by_id for this test.
        <Function test_validate_invalid_config>
          Test validation fails on invalid config.
        <Function test_validate_invalid_session>
          Test validation fails on invalid session.
        <Function test_create_client>
          Test creating a Telethon client instance.
          
          Note: We use a fresh session path because Telethon's TelegramClient
          modifies the session file on creation. Using a path without .session
          extension lets Telethon create its own fresh session.
          
          This test uses explicit proxy to bypass proxy_id validation.
        <Function test_properties>
          Test session_path and config_path properties.
        <Function test_create_client_with_proxy>
          Test creating a client with explicit proxy configuration.
        <Function test_create_client_with_http_proxy>
          Test creating a client with HTTP proxy.
        <Function test_create_client_with_disabled_proxy>
          Test that disabled proxy results in no proxy being set.
        <Function test_create_client_without_proxy_raises_error>
          Test that creating client without proxy_id raises SessionBlockedError.
        <Function test_create_client_with_custom_timeout>
          Test creating client with custom timeout configuration.
        <Function test_create_client_uses_default_timeout_from_settings>
          Test that client uses default timeout from settings when not specified.
        <Function test_validate_with_secure_storage_and_fallback>
          Test validation with secure storage fallback to plaintext config.
          
          Note: Since validate() now requires proxy_id and proxy in pool,
          we test the fallback behavior by checking that credentials are loaded
          from plaintext. The proxy validation will fail (as expected for legacy
          sessions without proxy), which is caught by a separate test.
        <Function test_validate_with_secure_storage_no_fallback>
          Test validation with secure storage and no fallback available.
        <Function test_validate_no_config_path_secure_storage_disabled>
          Test error when no config_path and secure storage disabled.
        <Function test_validate_raises_error_when_api_id_is_zero>
          Test that validate() raises SessionBlockedError when api_id is 0.
        <Function test_validate_raises_error_when_api_hash_is_empty>
          Test that validate() raises SessionBlockedError when api_hash is empty.
        <Function test_validate_raises_error_when_proxy_id_is_missing>
          Test that validate() raises SessionBlockedError when proxy_id is None.
        <Function test_validate_raises_error_when_proxy_not_in_pool>
          Test that validate() raises SessionBlockedError when proxy_id not found in pool.
        <Function test_validate_succeeds_with_all_required_fields>
          Test that validate() succeeds when all required fields are valid.
      <Class TestDialogToChat>
        Tests for _dialog_to_chat helper function.
        <Function test_user_dialog>
          Test conversion of private chat (User) dialog.
        <Function test_saved_messages_dialog>
          Test conversion of Saved Messages (chat with yourself) dialog.
        <Function test_channel_dialog>
          Test conversion of channel dialog.
        <Function test_supergroup_dialog>
          Test conversion of supergroup dialog.
        <Function test_forum_dialog>
          Test conversion of forum dialog.
        <Function test_basic_group_dialog>
          Test conversion of basic group dialog.
        <Function test_unknown_entity_type>
          Test that unknown entity types return None.
      <Class TestGetDialogs>
        Tests for get_dialogs function.
        <Coroutine test_get_all_dialogs>
          Test fetching all dialogs.
        <Coroutine test_filter_by_chat_type>
          Test filtering dialogs by chat type.
        <Coroutine test_deduplication>
          Test that duplicate chat IDs are deduplicated.
        <Coroutine test_caching>
          Test session-scoped caching.
        <Coroutine test_cache_with_filter>
          Test that cache works correctly with type filtering.
        <Coroutine test_archived_chats>
          Test that archived chats are included with is_archived=True.
      <Class TestTelethonMessageToModel>
        Tests for _telethon_message_to_model helper function.
        <Function test_basic_message>
          Test conversion of basic text message.
        <Function test_message_with_media>
          Test conversion of media message with no text.
        <Function test_message_no_sender_uses_chat_id>
          Test that messages without sender use chat_id as author.
        <Function test_message_with_peer_user>
          Test handling of from_id as PeerUser object.
        <Function test_message_with_peer_channel>
          Test handling of sender_id as PeerChannel object.
        <Function test_message_with_negative_sender_id>
          Test that negative sender IDs are converted to positive.
        <Function test_message_without_timestamp_returns_none>
          Test that messages without timestamp return None.
        <Function test_message_with_naive_timestamp>
          Test that naive timestamps are made timezone-aware.
        <Function test_message_empty_returns_none>
          Test that empty/deleted messages return None.
        <Function test_message_timestamp_is_utc>
          Test that timestamp is timezone-aware UTC.
        <Function test_service_message_returns_none>
          Test that service messages (join/leave/pin) are filtered out.
        <Function test_service_message_join_returns_none>
          Test that user join service messages are filtered out.
        <Function test_service_message_pin_returns_none>
          Test that pin message service messages are filtered out.
      <Class TestGetMessages>
        Tests for get_messages function.
        <Coroutine test_get_messages_basic>
          Test fetching messages from a chat.
        <Coroutine test_get_messages_respects_limit>
          Test that limit is respected.
        <Coroutine test_get_messages_deduplication>
          Test that duplicate message IDs are deduplicated.
        <Coroutine test_get_messages_sorts_by_timestamp>
          Test that messages are sorted by timestamp (oldest first).
        <Coroutine test_get_messages_skips_empty>
          Test that empty/deleted messages are skipped.
        <Coroutine test_get_messages_invalid_limit>
          Test that invalid limit raises ValueError.
        <Coroutine test_get_messages_chat_not_found_error>
          Test error handling for non-existent chat.
        <Coroutine test_get_messages_access_denied_error>
          Test error handling for access denied (string-based).
        <Coroutine test_get_messages_chat_forbidden_error>
          Test error handling for ChatForbiddenError (user kicked/banned/left).
        <Coroutine test_get_messages_channel_private_error>
          Test error handling for ChannelPrivateError (private channel).
        <Coroutine test_get_messages_user_banned_in_channel_error>
          Test error handling for UserBannedInChannelError.
        <Coroutine test_get_messages_rate_limit_error>
          Test error handling for rate limiting.
        <Coroutine test_get_messages_forum_with_topics>
          Test fetching messages from a forum chat with multiple topics.
        <Coroutine test_get_messages_forum_no_topics>
          Test fetching messages from a forum with no topics (fallback).
        <Coroutine test_get_messages_non_forum>
          Test fetching messages from a non-forum chat.
        <Coroutine test_get_messages_connection_interrupted_with_resume>
          Test that connection interruption preserves partial messages and resumes.
        <Coroutine test_get_messages_connection_interrupted_max_retries>
          Test that max retries is respected and partial messages are returned.
      <Class TestParseChatReference>
        Tests for _parse_chat_reference helper function.
        <Function test_username_with_at>
          Test parsing @username format.
        <Function test_bare_username>
          Test parsing bare username without @.
        <Function test_public_link_https>
          Test parsing https://t.me/username link.
        <Function test_public_link_http>
          Test parsing http://t.me/username link.
        <Function test_public_link_no_scheme>
          Test parsing t.me/username link without scheme.
        <Function test_invite_link_joinchat>
          Test parsing https://t.me/joinchat/XXXXX link.
        <Function test_invite_link_plus>
          Test parsing https://t.me/+XXXXX link.
        <Function test_invite_link_telegram_me>
          Test parsing telegram.me invite link.
        <Function test_empty_string>
          Test that empty string returns (None, None).
        <Function test_whitespace_only>
          Test that whitespace-only string returns (None, None).
        <Function test_strips_whitespace>
          Test that leading/trailing whitespace is stripped.
      <Class TestJoinChat>
        Tests for join_chat function.
        <Coroutine test_join_by_username>
          Test joining chat by username.
        <Coroutine test_join_by_invite_link>
          Test joining chat by invite link.
        <Coroutine test_join_invalid_reference_raises_value_error>
          Test that invalid chat reference raises ValueError.
        <Coroutine test_join_expired_invite_raises_error>
          Test error handling for expired invite link.
        <Coroutine test_join_banned_user_raises_error>
          Test error handling when user is banned.
        <Coroutine test_join_rate_limit_raises_error>
          Test error handling for rate limiting.
        <Coroutine test_join_username_not_found_raises_error>
          Test error handling for non-existent username.
        <Coroutine test_join_forum_supergroup>
          Test joining a forum-enabled supergroup.
      <Class TestSecureDeleteFile>
        Tests for _secure_delete_file helper function.
        <Function test_secure_delete_existing_file>
          Test secure deletion of existing file.
        <Function test_secure_delete_nonexistent_file>
          Test that deleting nonexistent file doesn't raise error.
        <Function test_secure_delete_directory_does_nothing>
          Test that trying to delete directory doesn't raise error.
      <Class TestMigratePlaintextToSecure>
        Tests for _migrate_plaintext_to_secure function.
        <Function test_migrate_success>
          Test successful migration of plaintext config to secure storage.
      <Class TestGetChatSlowmode>
        Tests for get_chat_slowmode function.
        <Coroutine test_get_slowmode_channel_with_slowmode>
          Test getting slowmode for a channel with slowmode enabled.
        <Coroutine test_get_slowmode_channel_no_slowmode>
          Test getting slowmode for a channel with slowmode disabled (0).
        <Coroutine test_get_slowmode_non_channel>
          Test that non-channel entities return None.
        <Coroutine test_get_slowmode_error_returns_none>
          Test that errors are logged and None is returned.
      <Class TestGetMessagesSince>
        Tests for get_messages_since function.
        <Coroutine test_get_messages_since_basic>
          Test fetching messages newer than min_id.
        <Coroutine test_get_messages_since_invalid_min_id>
          Test that negative min_id raises ValueError.
        <Coroutine test_get_messages_since_invalid_limit>
          Test that invalid limit raises ValueError.
        <Coroutine test_get_messages_since_forum>
          Test fetching new messages from a forum chat.
      <Class TestGetMessagesStreaming>
        Tests for get_messages_streaming function.
        <Coroutine test_streaming_basic>
          Test streaming messages in batches.
        <Coroutine test_streaming_invalid_batch_size>
          Test that invalid batch_size raises ValueError.
        <Coroutine test_streaming_invalid_max_messages>
          Test that invalid max_messages raises ValueError.
        <Coroutine test_streaming_respects_max_messages>
          Test that max_messages limits total messages fetched.
      <Class TestGetAccountInfo>
        Tests for get_account_info function.
        <Coroutine test_get_account_info_basic>
          Test getting basic account info.
        <Coroutine test_get_account_info_premium>
          Test getting account info for Premium user.
        <Coroutine test_get_account_info_rate_limited>
          Test error handling when rate limited.
      <Class TestLeaveChat>
        Tests for leave_chat function.
        <Coroutine test_leave_channel>
          Test leaving a channel.
        <Coroutine test_leave_basic_group>
          Test leaving a basic group.
        <Coroutine test_leave_chat_not_member>
          Test error when not a member of chat.
        <Coroutine test_leave_chat_rate_limited>
          Test error handling for rate limiting.
      <Class TestJoinChatWithRotation>
        Tests for join_chat_with_rotation function.
        <Coroutine test_join_with_slots_available>
          Test joining when account has available slots.
        <Coroutine test_join_at_limit_with_rotation>
          Test joining when at limit and rotation list provided.
        <Coroutine test_join_at_limit_no_rotation_list>
          Test error when at limit and no rotation list provided.
    <Module test_telethon_api_contract.py>
      Contract tests for Telethon API compatibility.
      
      These tests verify that our code's assumptions about the Telethon API structure,
      method signatures, data types, and error handling remain valid across Telethon versions.
      
      Contract tests are different from unit tests in that they verify the external API
      we depend on (Telethon) rather than our own code's behavior.
      <Class TestTelethonTypeContracts>
        Verify that Telethon types have expected attributes and structure.
        <Function test_user_type_contract>
          Verify User type has expected attributes.
        <Function test_channel_type_contract>
          Verify Channel type has expected attributes.
        <Function test_chat_type_contract>
          Verify Chat type has expected attributes.
        <Function test_message_type_contract>
          Verify Message type has expected attributes.
        <Function test_message_service_type_exists>
          Verify MessageService type exists for filtering.
        <Function test_dialog_type_contract>
          Verify Dialog type has expected attributes.
        <Function test_peer_types_contract>
          Verify Peer types exist and have expected attributes.
      <Class TestTelethonClientContracts>
        Verify TelegramClient has expected methods and signatures.
        <Function test_telegram_client_exists>
          Verify TelegramClient class exists.
        <Function test_telegram_client_constructor_signature>
          Verify TelegramClient constructor accepts expected parameters.
        <Function test_iter_dialogs_method_exists>
          Verify iter_dialogs method exists.
        <Function test_iter_messages_method_exists>
          Verify iter_messages method exists.
        <Function test_get_entity_method_exists>
          Verify get_entity method exists.
        <Function test_call_method_exists>
          Verify __call__ method exists (for executing requests).
      <Class TestTelethonErrorContracts>
        Verify Telethon error types have expected structure.
        <Function test_chat_forbidden_error_exists>
          Verify ChatForbiddenError exists and has expected structure.
        <Function test_channel_private_error_exists>
          Verify ChannelPrivateError exists.
        <Function test_user_banned_in_channel_error_exists>
          Verify UserBannedInChannelError exists.
        <Function test_flood_wait_error_exists>
          Verify FloodWaitError exists and has expected structure.
      <Class TestTelethonRequestContracts>
        Verify Telethon request types exist.
        <Function test_get_forum_topics_request_exists>
          Verify GetForumTopicsRequest exists for forum support.
        <Function test_join_channel_request_exists>
          Verify JoinChannelRequest exists for joining chats.
        <Function test_import_chat_invite_request_exists>
          Verify ImportChatInviteRequest exists for invite links.
        <Function test_get_full_chat_request_exists>
          Verify GetFullChatRequest exists for chat details.
      <Class TestTelethonSessionFileContract>
        Verify Telethon 1.x session file format contract.
        <Function test_telethon_1x_session_schema>
          Verify Telethon 1.x session file has expected SQLite schema.
        <Function test_telethon_2x_session_detection>
          Verify we can detect Telethon 2.x session format (incompatible).
      <Class TestTelethonDataStructureContracts>
        Verify data structure contracts between Telethon and our models.
        <Function test_message_to_model_contract>
          Verify Message -> our Message model conversion contract.
        <Function test_dialog_to_chat_contract>
          Verify Dialog -> our Chat model conversion contract.
        <Function test_entity_types_distinguishable>
          Verify we can distinguish between User, Channel, and Chat entities.
        <Function test_channel_megagroup_and_forum_flags>
          Verify Channel has megagroup and forum flags.
      <Class TestTelethonVersionCompatibility>
        Verify Telethon version compatibility assumptions.
        <Function test_telethon_1x_version>
          Verify we're using Telethon 1.x (not 2.x).
        <Function test_telethon_minimum_version>
          Verify Telethon version meets minimum requirement.
      <Class TestTelethonAPIAssumptions>
        Document and verify Telethon API behavior assumptions.
        
        These tests verify assumptions about Telegram/Telethon API conventions that
        our code relies on. The assumptions are:
        
        1. **Negative IDs**: Telegram uses negative IDs for channels/groups in some contexts.
           - Users: positive IDs
           - Channels/Supergroups: negative IDs (or large positive IDs in some contexts)
           Our code handles both positive and negative chat IDs.
        
        2. **Folder IDs**: Telegram uses folder IDs to organize chats:
           - folder=0: main chat list
           - folder=1: archived chats
           Our code relies on this to fetch both main and archived dialogs.
        
        3. **Forum Topics**: In forum chats (Telegram Topics feature):
           - Each topic has a root message ID
           - Messages in a topic have reply_to set to the topic root message ID
           Our code filters messages by reply_to to get topic-specific messages.
        <Function test_peer_types_support_negative_ids>
          Verify Peer types can represent negative IDs (channels/groups).
        <Function test_dialog_has_folder_attribute>
          Verify Dialog type has folder_id attribute for archived chats.
        <Function test_message_has_reply_to_attribute>
          Verify Message type has reply_to for forum topic filtering.
      <Class TestTelethonImportPaths>
        Verify Telethon import paths remain stable.
        <Function test_telethon_client_import>
          Verify TelegramClient import path.
        <Function test_telethon_errors_import>
          Verify Telethon errors can be imported from telethon.errors.
        <Function test_telethon_tl_types_import>
          Verify TL types can be imported from telethon.tl.types.
        <Function test_telethon_tl_functions_import>
          Verify TL functions can be imported from telethon.tl.functions.
    <Module test_template_helpers.py>
      Tests for template helper functions.
      
      Tests cover:
      - get_template_context: context with CSRF, i18n, request
      <Class TestGetTemplateContext>
        Tests for get_template_context function.
        <Function test_returns_context_dict>
          Should return context dictionary.
        <Function test_includes_extra_kwargs>
          Should include additional kwargs in context.
        <Function test_csrf_token_present_in_context>
          CSRF token should be present in context with proper format.
    <Module test_translations.py>
      Tests for i18n translation utilities.
      
      Tests cover:
      - get_translations: loading translations
      - get_current_locale / set_current_locale: locale context
      - gettext_func / ngettext_func: translation functions
      <Class TestSupportedLanguages>
        Tests for language configuration.
        <Function test_supported_languages>
          Should have expected languages.
        <Function test_default_language>
          Default language should be English.
      <Class TestGetTranslations>
        Tests for get_translations function.
        <Function test_returns_translations>
          Should return translations object.
        <Function test_caches_translations>
          Should cache translations per locale.
        <Function test_falls_back_to_default>
          Should fall back to default for unsupported locale.
        <Function test_missing_mo_fallback>
          Should fallback gracefully when .mo files are missing.
      <Class TestGetSetCurrentLocale>
        Tests for get/set current locale functions.
        <Function test_get_current_locale_default>
          Should return default locale initially.
        <Function test_set_current_locale>
          Should set locale for current context.
        <Function test_set_unsupported_locale_falls_back>
          Should fall back to default for unsupported locale.
      <Class TestGettextFunc>
        Tests for gettext_func function.
        <Function test_returns_string>
          Should return translated string.
        <Function test_underscore_alias>
          _ should be alias for gettext_func.
      <Class TestNgettextFunc>
        Tests for ngettext_func function.
        <Function test_singular>
          Should return singular form for n=1.
        <Function test_plural>
          Should return plural form for n>1.
        <Function test_ngettext_alias>
          ngettext should be alias for ngettext_func.
    <Module test_version_checker.py>
      Tests for version checker service.
      
      Tests cover:
      - VersionInfo: version information dataclass
      - UpdateCheckResult: update check result
      - VersionChecker: update checking functionality
      - Version comparison logic
      <Class TestVersionInfo>
        Tests for VersionInfo dataclass.
        <Function test_creation>
          VersionInfo should initialize with correct values.
        <Function test_prerelease_default>
          is_prerelease should default to False.
      <Class TestUpdateCheckResult>
        Tests for UpdateCheckResult dataclass.
        <Function test_creation>
          UpdateCheckResult should initialize with correct values.
        <Function test_with_error>
          UpdateCheckResult should store error message.
      <Class TestVersionChecker>
        Tests for VersionChecker class.
        <Function test_initialization>
          Should initialize with correct values.
        <Function test_is_newer_version_true>
          Should detect newer versions correctly.
        <Function test_is_newer_version_false>
          Should detect same or older versions.
        <Function test_is_newer_version_different_lengths>
          Should handle version strings of different lengths.
        <Function test_is_newer_version_invalid>
          Should handle invalid version strings gracefully.
        <Function test_parse_version_info>
          Should parse GitHub release data correctly.
        <Function test_parse_version_info_prerelease>
          Should detect pre-release versions.
        <Coroutine test_check_for_updates_newer_available>
          Should detect when update is available.
        <Coroutine test_check_for_updates_no_update>
          Should detect when no update is available.
        <Coroutine test_check_for_updates_404>
          Should handle 404 (no releases) gracefully.
        <Coroutine test_check_for_updates_http_error>
          Should handle HTTP errors gracefully.
        <Coroutine test_check_for_updates_skips_prerelease>
          Should skip pre-releases by default.
    <Module test_web_app.py>
      Tests for FastAPI web application.
      <Class TestHealthEndpoint>
        Tests for /health endpoint.
        <Function test_health_returns_200>
          Test health endpoint returns 200 OK.
        <Function test_health_returns_status_ok>
          Test health endpoint returns ok status.
        <Function test_health_returns_version>
          Test health endpoint returns application version.
        <Function test_health_returns_uptime>
          Test health endpoint returns uptime.
        <Function test_health_returns_disk_space>
          Test health endpoint returns disk space information.
        <Function test_health_returns_telegram_status>
          Test health endpoint returns telegram connection status.
      <Class TestReadyEndpoint>
        Tests for /ready endpoint.
        <Function test_ready_returns_200>
          Test ready endpoint returns 200 OK.
        <Function test_ready_returns_ready_true>
          Test ready endpoint returns ready: true when not shutting down.
      <Class TestRequestIDMiddleware>
        Tests for request ID middleware.
        <Function test_response_has_request_id_header>
          Test that responses include X-Request-ID header.
        <Function test_request_id_is_uuid_format>
          Test that generated request ID is UUID format.
        <Function test_client_provided_request_id_is_preserved>
          Test that client-provided X-Request-ID is preserved.
      <Class TestCORSConfiguration>
        Tests for CORS middleware.
        <Function test_cors_headers_present_for_allowed_origin>
          Test CORS headers are present for allowed origins.
        <Function test_default_cors_allows_localhost>
          Test default CORS configuration allows localhost.
        <Function test_cors_allows_only_specified_methods>
          Test CORS only allows GET, POST, DELETE methods.
        <Function test_cors_allows_credentials>
          Test CORS allows credentials for secure cookie-based auth.
        <Function test_cors_default_origins_include_common_frontend_ports>
          Test default CORS origins include common frontend development ports.
        <Function test_cors_blocks_disallowed_origin>
          Test CORS blocks requests from non-allowed origins.
      <Class TestAppFactory>
        Tests for app factory pattern.
        <Function test_create_app_returns_fastapi_instance>
          Test that create_app returns FastAPI instance.
        <Function test_create_app_with_debug_mode>
          Test creating app with debug mode enabled.
        <Function test_create_app_default_not_debug>
          Test that debug mode is off by default.
        <Function test_multiple_app_instances_are_independent>
          Test that multiple app instances don't share state.
      <Class TestStaticFiles>
        Tests for static file serving.
        <Function test_static_css_served>
          Test that static CSS file is served.
        <Function test_static_404_for_missing_file>
          Test 404 for missing static files.
      <Class TestExportCsvEndpoint>
        Tests for /api/export/csv endpoint.
        <Function test_export_csv_returns_200>
          Test CSV export returns 200 OK.
        <Function test_export_csv_content_type>
          Test CSV export returns correct content type.
        <Function test_export_csv_content_disposition>
          Test CSV export has attachment disposition with unique filename.
        <Function test_export_csv_custom_filename>
          Test CSV export with custom filename gets unique suffix.
        <Function test_export_csv_concurrent_requests_unique_filenames>
          Test concurrent CSV export requests get unique filenames.
        <Function test_export_csv_includes_data>
          Test CSV export includes provided data.
        <Function test_export_csv_multiple_results>
          Test CSV export with multiple results.
        <Function test_export_csv_empty_results>
          Test CSV export with empty results returns header only.
        <Function test_export_csv_invalid_chat_type_returns_422>
          Test that invalid chat type returns validation error.
    <Package web>
      <Module test_sessions.py>
        Regression tests for session status logic.
        
        Bug 1 fix: get_session_config_status() must check SecureCredentialManager
        for encrypted credentials, not just plaintext config.json.
        <Class TestGetSessionConfigStatus>
          Tests for get_session_config_status() after Bug 1 fix.
          <Function test_encrypted_credentials_with_proxy>
            Test status with encrypted credentials and valid proxy.
            
            Scenario: Session has NO plaintext api_id/api_hash in config.json,
            but HAS encrypted credentials in SecureCredentialManager.
            Expected: Should return "disconnected" (ready to connect).
          <Function test_encrypted_credentials_missing>
            Test status when encrypted credentials don't exist.
            
            Scenario: Session has NO plaintext api_id/api_hash,
            and NO encrypted credentials in SecureCredentialManager.
            Expected: Should return "needs_config" with "API credentials required".
          <Function test_plaintext_credentials_backward_compatibility>
            Test backward compatibility with plaintext config.json.
            
            Scenario: Session has plaintext api_id/api_hash in config.json.
            Expected: Should NOT check SecureCredentialManager,
            proceed directly to proxy check, return "disconnected".
          <Function test_missing_config_file>
            Test status when config.json doesn't exist.
            
            Expected: Should return "needs_config" with "Configuration file missing".
          <Function test_corrupted_config_file>
            Test status when config.json is corrupted/invalid JSON.
            
            Expected: Should return "needs_config" with "Configuration file corrupted".
          <Function test_missing_proxy_id>
            Test status when proxy_id is missing from config.
            
            Expected: Should return "needs_config" with "Proxy configuration required".
          <Function test_proxy_not_found_in_pool>
            Test status when proxy_id references non-existent proxy.
            
            Expected: Should return "needs_config" with "Proxy not found in pool".
          <Function test_encrypted_credentials_check_error_handling>
            Test graceful handling of SecureCredentialManager errors.
            
            Scenario: SecureCredentialManager.has_credentials() raises exception
            (e.g., corrupted .credentials.enc file).
            Expected: Should treat as credentials absent, return "needs_config" with "API credentials required".
          <Function test_encrypted_credentials_with_only_api_id_null>
            Test encrypted check when only api_id is null (api_hash present).
            
            Scenario: api_id is None, but api_hash has value in config.
            Expected: Should check encrypted credentials (both must be present).
          <Function test_encrypted_credentials_with_only_api_hash_null>
            Test encrypted check when only api_hash is null (api_id present).
            
            Scenario: api_hash is None, but api_id has value in config.
            Expected: Should check encrypted credentials (both must be present).
        <Class TestConnectSessionErrorHandling>
          Regression tests for Bug 2: connect error handling.
          
          Bug 2 fixed silent failures when Connect is clicked. These tests verify
          that error messages are published via SSE and saved to config.json when:
          - Phone number is missing from account_info
          - Proxy is not found in pool
          - Network is unavailable (after retries)
          <Coroutine test_connect_session_publishes_error_when_phone_missing>
            Test that missing phone number triggers error event.
            
            Scenario: User clicks Connect but account_info.json has no phone number.
            Expected: Telethon raises PhoneNumberInvalidError, error event published.
          <Coroutine test_connect_session_publishes_error_when_proxy_fails>
            Test that proxy not found triggers needs_config event.
            
            Scenario: User clicks Connect but proxy_id references non-existent proxy.
            Expected: SSE event published with 'needs_config' state and error saved to config.json.
          <Coroutine test_connect_session_publishes_error_when_network_unavailable>
            Test that network error (after retries) triggers error event.
            
            Scenario: User clicks Connect but network is unavailable (ConnectionError on all retries).
            Expected: SSE event published with 'error' state, error_message saved with retry_available=True.

=============================== warnings summary ===============================
src/chatfilter/self_test.py:31
  /Users/m/Zen/Code/ChatFilter/src/chatfilter/self_test.py:31: PytestCollectionWarning: cannot collect test class 'TestResult' because it has a __init__ constructor (from: tests/test_self_test.py)
    @dataclass

src/chatfilter/self_test.py:22
  /Users/m/Zen/Code/ChatFilter/src/chatfilter/self_test.py:22: PytestCollectionWarning: cannot collect test class 'TestStatus' because it has a __init__ constructor (from: tests/test_self_test.py)
    class TestStatus(str, Enum):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
======================== 1954 tests collected in 1.13s =========================
