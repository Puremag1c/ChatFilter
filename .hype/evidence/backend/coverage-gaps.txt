# Coverage Gaps Analysis

Based on SPEC.md requirements vs existing tests:

## COVERED (existing tests)

✅ Database layer (test_group_database.py):
  - Group CRUD operations
  - Chat CRUD operations  
  - Result storage
  - Statistics aggregation
  - Foreign key constraints
  - Cascading deletes
  - JSON serialization

✅ Link parsing (test_importer_parser.py):
  - All link formats: t.me/xxx, t.me/+hash, @username, -100xxx
  - Google Sheets URL parsing
  - CSV/XLS/TXT parsing

✅ Google Sheets import (test_importer_google_sheets.py):
  - URL validation
  - Sheet fetching
  - Error handling

## GAPS (need backend tests)

❌ Groups API endpoints integration:
  - POST /api/groups (create group from CSV/URL/file)
  - GET /api/groups (list all groups)
  - GET /api/groups/{id} (get single group)
  - PATCH /api/groups/{id} (update group)
  - DELETE /api/groups/{id} (delete group)
  - POST /api/groups/{id}/start (start analysis)
  - POST /api/groups/{id}/stop (stop analysis)
  - GET /api/groups/{id}/export (CSV export)
  - PUT /api/groups/{id}/settings (update settings)

❌ GroupAnalysisEngine business logic:
  - Account distribution algorithm
  - Join/resolve/analyze/leave workflow
  - Error handling (FloodWait, ChatNotFound, etc.)
  - Progress tracking
  - Resume after restart

❌ Multi-account distribution:
  - Round-robin distribution
  - Load balancing
  - Account failure handling (reassignment)

❌ Chat type detection:
  - Group vs Channel vs Forum vs Dead link
  - Channels with/without comments detection

❌ Persistence & recovery:
  - Resume analysis after server restart
  - Proper status tracking (pending→in_progress→done)

## SEVERITY

- API endpoint tests: P1 (functional tester will catch most issues)
- GroupAnalysisEngine logic: P0 (core business logic, silent failures possible)
- Multi-account distribution: P1 (can be tested manually)
- Chat type detection: P1 (existing ChatAnalysisService has tests)
- Persistence: P2 (database layer already tested)

## RECOMMENDATION

Focus on GroupAnalysisEngine business logic tests:
- Test the full workflow: parse → join → resolve → analyze → leave
- Test error scenarios: dead links, FloodWait, banned accounts
- Test progress calculation
- Test settings application (message_limit, leave_after_analysis)

API endpoint tests are lower priority since:
1. Functional tester (Playwright) will verify the UI/API flow
2. Database layer is already well-tested
3. Endpoints are mostly thin wrappers around services

