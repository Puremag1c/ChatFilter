tests/test_leak_detection.py::test_cleanup_after_use PASSED              [ 40%]
tests/test_loading_states.py::TestLoadingStateConnect::test_connect_button_has_htmx_attributes PASSED [ 40%]
tests/test_loading_states.py::TestLoadingStateConnect::test_connect_button_disabled_during_loading PASSED [ 40%]
tests/test_loading_states.py::TestLoadingStateDisconnect::test_disconnect_button_has_htmx_attributes PASSED [ 40%]
tests/test_loading_states.py::TestLoadingStateDisconnect::test_disconnect_button_target_and_swap PASSED [ 40%]
tests/test_loading_states.py::TestLoadingStateReconnect::test_reconnect_button_appears_for_expired_session FAILED [ 40%]
tests/test_loading_states.py::TestLoadingStateReconnect::test_reconnect_button_target_and_swap FAILED [ 40%]
--
tests/test_loading_states.py::TestLoadingStateVerify2FA::test_2fa_modal_button_has_session_data PASSED [ 41%]
tests/test_loading_states.py::TestLoadingStateVerify2FA::test_2fa_modal_button_accessible PASSED [ 41%]
tests/test_loading_states.py::TestStatusCellSpinner::test_status_cell_shows_spinner_when_connecting PASSED [ 41%]
tests/test_loading_states.py::TestStatusCellSpinner::test_status_cell_shows_spinner_when_disconnecting PASSED [ 41%]
tests/test_loading_states.py::TestStatusCellSpinner::test_status_cell_updates_after_connection PASSED [ 41%]
tests/test_loading_states.py::TestStatusCellSpinner::test_status_cell_updates_after_disconnection FAILED [ 41%]
tests/test_loading_states.py::TestAllActionTypesComplete::test_all_six_action_types_present FAILED [ 41%]
--
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_concurrent_request_returns_connecting PASSED [ 77%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_timeout_returns_connecting PASSED [ 77%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_missing_session_file PASSED [ 77%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_invalid_session_auto_reauth PASSED [ 77%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_disconnect_session_invalid_name PASSED [ 77%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_disconnect_session_success FAILED [ 77%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_disconnect_session_not_connected FAILED [ 77%]
--
tests/test_sessions_router.py::TestAPICredentialReValidation::test_invalid_api_id_rejected_not_saved PASSED [ 77%]
tests/test_sessions_router.py::TestAPICredentialReValidation::test_valid_credentials_needing_auth_triggers_reconnect PASSED [ 77%]
tests/test_sessions_router.py::TestAPICredentialReValidation::test_credentials_not_saved_before_validation_success PASSED [ 77%]
tests/test_sessions_router.py::TestAPICredentialReValidation::test_network_error_during_validation_shows_proxy_error PASSED [ 77%]
tests/test_sessions_router.py::TestVerify2FA::test_password_validation_logic PASSED [ 77%]
tests/test_sessions_router.py::TestVerify2FA::test_verify_code_2fa_auto_fails_shows_manual_modal FAILED [ 78%]
--
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_empty_phone PASSED [ 78%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_phone_format_letters PASSED [ 78%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_phone_too_short PASSED [ 78%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_phone_too_long PASSED [ 78%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_phone_leading_zero PASSED [ 78%]
tests/test_sessions_router.py::TestVerifyCode2FAAutoEntry::test_verify_code_auto_2fa_success FAILED [ 78%]
tests/test_sessions_router.py::TestVerifyCode2FAAutoEntry::test_verify_code_auto_2fa_missing PASSED [ 79%]
tests/test_sessions_router.py::TestVerifyCode2FAAutoEntry::test_verify_code_auto_2fa_wrong PASSED [ 79%]
tests/test_sessions_router.py::TestSessionImport::test_validate_import_session_success PASSED [ 79%]
tests/test_sessions_router.py::TestSessionImport::test_validate_import_session_invalid_json_missing_phone PASSED [ 79%]
tests/test_sessions_router.py::TestSessionImport::test_validate_import_session_invalid_phone_format PASSED [ 79%]
tests/test_sessions_router.py::TestSessionImport::test_save_import_session_success FAILED [ 79%]
--
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_loading_states.py::TestLoadingStateReconnect::test_reconnect_button_appears_for_expired_session - assert 'Reconnect' in '\n\n<tr id="session-test_session" class="account-row">\n    <td class="account-name-cell">\n        <span class="account-name">test_session</span>\n    </td>\n    <td class="account-status-cell">\n        <span class="account-status status-session_expired"\n              title="Session has expired"\n              ><span class="status-icon" aria-hidden="true">?</span>\n                session_expired</span>\n    </td>\n    <td class="account-actions-cell">\n        <div class="account-actions">\n            \n            <div class="session-connection-btn-wrapper" id="session-connection-test_session">\n                \n                \n                <button class="btn btn-sm btn-secondary session-connect-btn" disabled\n                        aria-label="Not configured"\n                        title="Configure session first">\n                    <span class="btn-text">Connect</span>\n                </button>\n                \n            </div>\n            <button class="btn btn-sm btn-secondary session-config-btn"\n                    data-session-id="test_session"\n                    hx-get="/api/sessions/test_session/config"\n                    hx-target="#session-config-test_session"\n                    hx-swap="innerHTML"\n                    hx-disabled-elt="this"\n                    aria-label="Configure account"\n                    aria-expanded="false"\n                    aria-controls="session-config-test_session">\n                Edit\n            </button>\n            <button class="btn btn-sm btn-danger session-delete-btn"\n                    data-session-id="test_session"\n                    data-lock="session:test_session:delete"\n                    aria-label="Delete account">\n                Delete\n            </button>\n        </div>\n    </td>\n</tr>'
FAILED tests/test_loading_states.py::TestLoadingStateReconnect::test_reconnect_button_target_and_swap - assert 'hx-target="#session-test_session"' in '\n\n<tr id="session-test_session" class="account-row">\n    <td class="account-name-cell">\n        <span class="account-name">test_session</span>\n    </td>\n    <td class="account-status-cell">\n        <span class="account-status status-session_expired"\n              ><span class="status-icon" aria-hidden="true">?</span>\n                session_expired</span>\n    </td>\n    <td class="account-actions-cell">\n        <div class="account-actions">\n            \n            <div class="session-connection-btn-wrapper" id="session-connection-test_session">\n                \n                \n                <button class="btn btn-sm btn-secondary session-connect-btn" disabled\n                        aria-label="Not configured"\n                        title="Configure session first">\n                    <span class="btn-text">Connect</span>\n                </button>\n                \n            </div>\n            <button class="btn btn-sm btn-secondary session-config-btn"\n                    data-session-id="test_session"\n                    hx-get="/api/sessions/test_session/config"\n                    hx-target="#session-config-test_session"\n                    hx-swap="innerHTML"\n                    hx-disabled-elt="this"\n                    aria-label="Configure account"\n                    aria-expanded="false"\n                    aria-controls="session-config-test_session">\n                Edit\n            </button>\n            <button class="btn btn-sm btn-danger session-delete-btn"\n                    data-session-id="test_session"\n                    data-lock="session:test_session:delete"\n                    aria-label="Delete account">\n                Delete\n            </button>\n        </div>\n    </td>\n</tr>'
FAILED tests/test_loading_states.py::TestStatusCellSpinner::test_status_cell_updates_after_disconnection - assert 'Ready' in '\n\n<tr id="session-test_session" class="account-row">\n    <td class="account-name-cell">\n        <span class="account-name">test_session</span>\n    </td>\n    <td class="account-status-cell">\n        <span class="account-status status-disconnected status-needs-auth"\n              title="No cached session - authorization required"\n              ><span class="status-icon" aria-hidden="true">\U0001f4f1</span>\n                    Needs Auth</span>\n    </td>\n    <td class="account-actions-cell">\n        <div class="account-actions">\n            \n            <div class="session-connection-btn-wrapper" id="session-connection-test_session">\n                \n                <button class="btn btn-sm btn-success session-connect-btn"\n                        hx-post="/api/sessions/test_session/connect"\n                        hx-target="#session-test_session"\n                        hx-swap="outerHTML"\n                        hx-disabled-elt="this"\n                        aria-label="Authorize session">\n                    Authorize\n                </button>\n                \n            </div>\n            <button class="btn btn-sm btn-secondary session-config-btn"\n                    data-session-id="test_session"\n                    hx-get="/api/sessions/test_session/config"\n                    hx-target="#session-config-test_session"\n                    hx-swap="innerHTML"\n                    hx-disabled-elt="this"\n                    aria-label="Configure account"\n                    aria-expanded="false"\n                    aria-controls="session-config-test_session">\n                Edit\n            </button>\n            <button class="btn btn-sm btn-danger session-delete-btn"\n                    data-session-id="test_session"\n                    data-lock="session:test_session:delete"\n                    aria-label="Delete account">\n                Delete\n            </button>\n        </div>\n    </td>\n</tr>'
FAILED tests/test_loading_states.py::TestAllActionTypesComplete::test_all_six_action_types_present - assert 'Connect' in '\n\n<tr id="session-s1" class="account-row">\n    <td class="account-name-cell">\n        <span class="account-name">s1</span>\n    </td>\n    <td class="account-status-cell">\n        <span class="account-status status-disconnected status-needs-auth"\n              title="No cached session - authorization required"\n              ><span class="status-icon" aria-hidden="true">\U0001f4f1</span>\n                    Needs Auth</span>\n    </td>\n    <td class="account-actions-cell">\n        <div class="account-actions">\n            \n            <div class="session-connection-btn-wrapper" id="session-connection-s1">\n                \n                <button class="btn btn-sm btn-success session-connect-btn"\n                        hx-post="/api/sessions/s1/connect"\n                        hx-target="#session-s1"\n                        hx-swap="outerHTML"\n                        hx-disabled-elt="this"\n                        aria-label="Authorize session">\n                    Authorize\n                </button>\n                \n            </div>\n            <button class="btn btn-sm btn-secondary session-config-btn"\n                    data-session-id="s1"\n                    hx-get="/api/sessions/s1/config"\n                    hx-target="#session-config-s1"\n                    hx-swap="innerHTML"\n                    hx-disabled-elt="this"\n                    aria-label="Configure account"\n                    aria-expanded="false"\n                    aria-controls="session-config-s1">\n                Edit\n            </button>\n            <button class="btn btn-sm btn-danger session-delete-btn"\n                    data-session-id="s1"\n                    data-lock="session:s1:delete"\n                    aria-label="Delete account">\n                Delete\n            </button>\n        </div>\n    </td>\n</tr>'
FAILED tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_disconnect_session_success - assert 'Connect' in '\n\n<tr id="session-test_session" class="account-row">\n    <td class="account-name-cell">\n        <span class="account-name">test_session</span>\n    </td>\n    <td class="account-status-cell">\n        <span class="account-status status-disconnected status-needs-auth"\n              title="No cached session - authorization required"\n              ><span class="status-icon" aria-hidden="true">\U0001f4f1</span>\n                    Needs Auth</span>\n    </td>\n    <td class="account-actions-cell">\n        <div class="account-actions">\n            \n            <div class="session-connection-btn-wrapper" id="session-connection-test_session">\n                \n                <button class="btn btn-sm btn-success session-connect-btn"\n                        hx-post="/api/sessions/test_session/connect"\n                        hx-target="#session-test_session"\n                        hx-swap="outerHTML"\n                        hx-disabled-elt="this"\n                        aria-label="Authorize session">\n                    Authorize\n                </button>\n                \n            </div>\n            <button class="btn btn-sm btn-secondary session-config-btn"\n                    data-session-id="test_session"\n                    hx-get="/api/sessions/test_session/config"\n                    hx-target="#session-config-test_session"\n                    hx-swap="innerHTML"\n                    hx-disabled-elt="this"\n                    aria-label="Configure account"\n                    aria-expanded="false"\n                    aria-controls="session-config-test_session">\n                Edit\n            </button>\n            <button class="btn btn-sm btn-danger session-delete-btn"\n                    data-session-id="test_session"\n                    data-lock="session:test_session:delete"\n                    aria-label="Delete account">\n                Delete\n            </button>\n        </div>\n    </td>\n</tr>'
 +  where '\n\n<tr id="session-test_session" class="account-row">\n    <td class="account-name-cell">\n        <span class="account-name">test_session</span>\n    </td>\n    <td class="account-status-cell">\n        <span class="account-status status-disconnected status-needs-auth"\n              title="No cached session - authorization required"\n              ><span class="status-icon" aria-hidden="true">\U0001f4f1</span>\n                    Needs Auth</span>\n    </td>\n    <td class="account-actions-cell">\n        <div class="account-actions">\n            \n            <div class="session-connection-btn-wrapper" id="session-connection-test_session">\n                \n                <button class="btn btn-sm btn-success session-connect-btn"\n                        hx-post="/api/sessions/test_session/connect"\n                        hx-target="#session-test_session"\n                        hx-swap="outerHTML"\n                        hx-disabled-elt="this"\n                        aria-label="Authorize session">\n                    Authorize\n                </button>\n                \n            </div>\n            <button class="btn btn-sm btn-secondary session-config-btn"\n                    data-session-id="test_session"\n                    hx-get="/api/sessions/test_session/config"\n                    hx-target="#session-config-test_session"\n                    hx-swap="innerHTML"\n                    hx-disabled-elt="this"\n                    aria-label="Configure account"\n                    aria-expanded="false"\n                    aria-controls="session-config-test_session">\n                Edit\n            </button>\n            <button class="btn btn-sm btn-danger session-delete-btn"\n                    data-session-id="test_session"\n                    data-lock="session:test_session:delete"\n                    aria-label="Delete account">\n                Delete\n            </button>\n        </div>\n    </td>\n</tr>' = <Response [200 OK]>.text
FAILED tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_disconnect_session_not_connected - assert 'Connect' in '\n\n<tr id="session-test_session" class="account-row">\n    <td class="account-name-cell">\n        <span class="account-name">test_session</span>\n    </td>\n    <td class="account-status-cell">\n        <span class="account-status status-disconnected status-needs-auth"\n              title="No cached session - authorization required"\n              ><span class="status-icon" aria-hidden="true">\U0001f4f1</span>\n                    Needs Auth</span>\n    </td>\n    <td class="account-actions-cell">\n        <div class="account-actions">\n            \n            <div class="session-connection-btn-wrapper" id="session-connection-test_session">\n                \n                <button class="btn btn-sm btn-success session-connect-btn"\n                        hx-post="/api/sessions/test_session/connect"\n                        hx-target="#session-test_session"\n                        hx-swap="outerHTML"\n                        hx-disabled-elt="this"\n                        aria-label="Authorize session">\n                    Authorize\n                </button>\n                \n            </div>\n            <button class="btn btn-sm btn-secondary session-config-btn"\n                    data-session-id="test_session"\n                    hx-get="/api/sessions/test_session/config"\n                    hx-target="#session-config-test_session"\n                    hx-swap="innerHTML"\n                    hx-disabled-elt="this"\n                    aria-label="Configure account"\n                    aria-expanded="false"\n                    aria-controls="session-config-test_session">\n                Edit\n            </button>\n            <button class="btn btn-sm btn-danger session-delete-btn"\n                    data-session-id="test_session"\n                    data-lock="session:test_session:delete"\n                    aria-label="Delete account">\n                Delete\n            </button>\n        </div>\n    </td>\n</tr>'
 +  where '\n\n<tr id="session-test_session" class="account-row">\n    <td class="account-name-cell">\n        <span class="account-name">test_session</span>\n    </td>\n    <td class="account-status-cell">\n        <span class="account-status status-disconnected status-needs-auth"\n              title="No cached session - authorization required"\n              ><span class="status-icon" aria-hidden="true">\U0001f4f1</span>\n                    Needs Auth</span>\n    </td>\n    <td class="account-actions-cell">\n        <div class="account-actions">\n            \n            <div class="session-connection-btn-wrapper" id="session-connection-test_session">\n                \n                <button class="btn btn-sm btn-success session-connect-btn"\n                        hx-post="/api/sessions/test_session/connect"\n                        hx-target="#session-test_session"\n                        hx-swap="outerHTML"\n                        hx-disabled-elt="this"\n                        aria-label="Authorize session">\n                    Authorize\n                </button>\n                \n            </div>\n            <button class="btn btn-sm btn-secondary session-config-btn"\n                    data-session-id="test_session"\n                    hx-get="/api/sessions/test_session/config"\n                    hx-target="#session-config-test_session"\n                    hx-swap="innerHTML"\n                    hx-disabled-elt="this"\n                    aria-label="Configure account"\n                    aria-expanded="false"\n                    aria-controls="session-config-test_session">\n                Edit\n            </button>\n            <button class="btn btn-sm btn-danger session-delete-btn"\n                    data-session-id="test_session"\n                    data-lock="session:test_session:delete"\n                    aria-label="Delete account">\n                Delete\n            </button>\n        </div>\n    </td>\n</tr>' = <Response [200 OK]>.text
FAILED tests/test_sessions_router.py::TestVerify2FA::test_verify_code_2fa_auto_fails_shows_manual_modal - AssertionError: Expected sign_in to be called at least twice, got 1
assert 1 >= 2
FAILED tests/test_sessions_router.py::TestVerifyCode2FAAutoEntry::test_verify_code_auto_2fa_success - AssertionError: Expected sign_in to be called at least twice, got 1
assert 1 >= 2
FAILED tests/test_sessions_router.py::TestSessionImport::test_save_import_session_success - AssertionError: assert False
