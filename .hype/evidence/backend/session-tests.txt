============================= test session starts ==============================
platform darwin -- Python 3.12.11, pytest-9.0.2, pluggy-1.6.0 -- /Users/m/Zen/Code/ChatFilter/.venv/bin/python
cachedir: .pytest_cache
hypothesis profile 'default'
rootdir: /Users/m/Zen/Code/ChatFilter
configfile: pyproject.toml
plugins: anyio-4.12.1, timeout-2.4.0, asyncio-1.3.0, hypothesis-6.151.5
timeout: 30.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 1954 items / 1643 deselected / 311 selected

tests/integration/test_auth_flow_fixes.py::TestVerifyCodeNeeds2FA::test_verify_code_returns_session_row_on_needs_2fa PASSED [  0%]
tests/integration/test_auth_flow_fixes.py::TestVerify2FASuccess::test_verify_2fa_returns_session_row_on_success PASSED [  0%]
tests/test_analysis_router.py::TestAnalysisResultsEndpoint::test_get_results_clears_orphaned_session PASSED [  0%]
tests/test_analysis_router.py::TestStartAnalysisEndpoint::test_start_analysis_no_session PASSED [  1%]
tests/test_analysis_router.py::TestStartAnalysisEndpoint::test_start_analysis_session_not_found PASSED [  1%]
tests/test_analysis_router.py::TestCheckOrphanedEndpoint::test_check_orphaned_no_session_task PASSED [  1%]
tests/test_chats_router.py::TestChatsAPI::test_get_chats_session_not_found PASSED [  2%]
tests/test_chats_router.py::TestChatsAPI::test_get_chats_session_invalid_error PASSED [  2%]
tests/test_chats_router.py::TestChatsAPI::test_get_chats_session_reauth_required_error PASSED [  2%]
tests/test_chats_router.py::TestChatsAPI::test_get_chats_session_reauth_2fa_error PASSED [  3%]
tests/test_chats_router.py::TestChatsAPI::test_get_chats_json_no_session PASSED [  3%]
tests/test_chats_router.py::TestChatsAPI::test_get_chats_json_session_not_found PASSED [  3%]
tests/test_chats_router.py::TestChatsAPI::test_get_chats_json_session_invalid_error PASSED [  4%]
tests/test_chats_router.py::TestChatsAPI::test_get_chats_json_session_reauth_required PASSED [  4%]
tests/test_chats_router.py::TestAccountInfoAPI::test_get_account_info_no_session PASSED [  4%]
tests/test_chats_router.py::TestAccountInfoAPI::test_get_account_info_session_not_found PASSED [  5%]
tests/test_chats_router.py::TestAccountInfoAPI::test_get_account_info_json_no_session PASSED [  5%]
tests/test_chats_router.py::TestAccountInfoAPI::test_get_account_info_json_session_not_found PASSED [  5%]
tests/test_chats_router.py::TestHelperFunctions::test_get_session_paths_success PASSED [  6%]
tests/test_chats_router.py::TestHelperFunctions::test_get_session_paths_directory_not_found PASSED [  6%]
tests/test_chats_router.py::TestHelperFunctions::test_get_session_paths_missing_files PASSED [  6%]
tests/test_chats_router.py::TestHelperFunctions::test_cleanup_invalid_session PASSED [  7%]
tests/test_chats_router.py::TestHelperFunctions::test_cleanup_invalid_session_nonexistent PASSED [  7%]
tests/test_chats_router.py::TestHelperFunctions::test_cleanup_invalid_session_error_handling PASSED [  7%]
tests/test_chats_router.py::TestWebSessionPersistence::test_get_chats_stores_session_in_web_session PASSED [  8%]
tests/test_chats_router.py::TestWebSessionPersistence::test_get_chats_json_stores_session_in_web_session PASSED [  8%]
tests/test_cleanup.py::TestCleanupOldSessionFiles::test_skips_cleanup_when_disabled PASSED [  8%]
tests/test_cleanup.py::TestCleanupOldSessionFiles::test_delegates_to_storage_module PASSED [  9%]
tests/test_connect_flow_smoke.py::TestConnectFlowSmoke::test_scenario_3_expired_session_auto_send_code PASSED [  9%]
tests/test_connect_flow_smoke.py::TestConnectFlowSmoke::test_scenario_6_corrupted_session_auto_send_code PASSED [  9%]
tests/test_connect_flow_states.py::TestConnectFlowSessionExpiredRecovery::test_expired_session_auto_recovery PASSED [  9%]
tests/test_csrf.py::TestValidateCsrfToken::test_missing_session_token PASSED [ 10%]
tests/test_dependencies.py::TestGetWebSession::test_returns_session PASSED [ 10%]
tests/test_dependencies.py::TestGetSessionManager::test_creates_session_manager PASSED [ 10%]
tests/test_dependencies.py::TestGetSessionManager::test_returns_cached_instance PASSED [ 11%]
tests/test_device_confirmation.py::TestDeviceConfirmation::test_list_stored_sessions_needs_confirmation_state PASSED [ 11%]
tests/test_disk_utils.py::test_ensure_space_available_session_scenario PASSED [ 11%]
tests/test_e2e_integration.py::TestE2EIntegration::test_session_upload_with_invalid_file PASSED [ 12%]
tests/test_error_mapping.py::TestGetUserFriendlyMessage::test_error_message_pattern_matching_session PASSED [ 12%]
tests/test_events.py::TestSessionEventBus::test_initialization PASSED    [ 12%]
tests/test_events.py::TestSessionEventBus::test_subscribe_and_publish PASSED [ 13%]
tests/test_events.py::TestSessionEventBus::test_multiple_subscribers PASSED [ 13%]
tests/test_events.py::TestSessionEventBus::test_unsubscribe PASSED       [ 13%]
tests/test_events.py::TestSessionEventBus::test_duplicate_subscription PASSED [ 14%]
tests/test_events.py::TestSessionEventBus::test_unsubscribe_nonexistent PASSED [ 14%]
tests/test_events.py::TestSessionEventBus::test_publish_without_subscribers PASSED [ 14%]
tests/test_events.py::TestSessionEventBus::test_subscriber_exception_isolation PASSED [ 15%]
tests/test_events.py::TestSessionEventBus::test_multiple_events PASSED   [ 15%]
tests/test_events.py::TestSessionEventBus::test_clear_subscribers PASSED [ 15%]
tests/test_events.py::TestSessionEventBus::test_async_handler_execution PASSED [ 16%]
tests/test_events.py::TestEventBusIntegration::test_session_lifecycle_events PASSED [ 16%]
tests/test_events.py::TestEventBusIntegration::test_multiple_sessions PASSED [ 16%]
tests/test_events.py::TestEventThrottling::test_rate_limiting_per_session PASSED [ 17%]
tests/test_events.py::TestEventThrottling::test_reset_session_status_allows_duplicate PASSED [ 17%]
tests/test_events.py::TestEventThrottling::test_reset_session_status_nonexistent_session PASSED [ 17%]
tests/test_fuzz_parsing.py::TestFuzzSessionFile::test_fuzz_random_bytes_as_session PASSED [ 18%]
tests/test_fuzz_parsing.py::TestFuzzSessionFile::test_fuzz_valid_sqlite_random_data PASSED [ 18%]
tests/test_fuzz_parsing.py::TestFuzzSessionFile::test_fuzz_truncated_sqlite_file PASSED [ 18%]
tests/test_fuzz_parsing.py::TestFuzzSessionFile::test_fuzz_corrupted_sqlite_header PASSED [ 18%]
tests/test_fuzz_parsing.py::TestFuzzSessionFile::test_fuzz_appended_garbage PASSED [ 19%]
tests/test_fuzz_parsing.py::TestFuzzFileSizeLimits::test_fuzz_session_file_size_boundaries PASSED [ 19%]
tests/test_loading_states.py::TestLoadingStateReconnect::test_connect_button_for_disconnected_with_session_file PASSED [ 19%]
tests/test_loading_states.py::TestLoadingStateSendCode::test_code_modal_button_has_session_data PASSED [ 20%]
tests/test_loading_states.py::TestLoadingStateVerify2FA::test_2fa_modal_button_has_session_data PASSED [ 20%]
tests/test_logging.py::test_log_sanitization_session_tokens PASSED       [ 20%]
tests/test_middleware.py::TestSessionMiddleware::test_creates_session PASSED [ 21%]
tests/test_proxy_pool_api.py::TestGetSessionsUsingProxy::test_get_sessions_using_proxy_finds_match PASSED [ 21%]
tests/test_proxy_pool_api.py::TestGetSessionsUsingProxy::test_get_sessions_using_proxy_no_match PASSED [ 21%]
tests/test_security_credentials.py::TestEncryptedFileBackend::test_store_multiple_sessions PASSED [ 22%]
tests/test_security_credentials.py::TestEncryptedFileBackend::test_store_credentials_updates_existing_session PASSED [ 22%]
tests/test_security_credentials.py::TestEncryptedFileBackend::test_delete_credentials_keeps_other_sessions PASSED [ 22%]
tests/test_security_credentials.py::TestEncryptedFileBackend::test_delete_credentials_nonexistent_session PASSED [ 23%]
tests/test_security_credentials.py::TestEnvironmentBackend::test_retrieve_credentials_with_hyphens_in_session_id PASSED [ 23%]
tests/test_security_credentials.py::TestEnvironmentBackend::test_retrieve_credentials_with_lowercase_session_id PASSED [ 23%]
tests/test_security_credentials.py::TestSecureCredentialManager::test_integration_multiple_sessions PASSED [ 24%]
tests/test_security_credentials.py::TestErrorScenarios::test_empty_session_id PASSED [ 24%]
tests/test_security_credentials.py::TestErrorScenarios::test_special_characters_in_session_id PASSED [ 24%]
tests/test_security_credentials.py::TestErrorScenarios::test_very_long_session_id PASSED [ 25%]
tests/test_security_credentials.py::TestErrorScenarios::test_unicode_in_session_id PASSED [ 25%]
tests/test_service_layer.py::TestGetSessionPaths::test_get_session_paths_success PASSED [ 25%]
tests/test_service_layer.py::TestGetSessionPaths::test_get_session_paths_nonexistent_session PASSED [ 26%]
tests/test_service_layer.py::TestGetSessionPaths::test_get_session_paths_incomplete_session PASSED [ 26%]
tests/test_service_layer.py::TestValidateSession::test_validate_session_success PASSED [ 26%]
tests/test_service_layer.py::TestValidateSession::test_validate_session_not_found PASSED [ 27%]
tests/test_service_layer.py::TestValidateSession::test_validate_session_validation_error PASSED [ 27%]
tests/test_service_monitoring.py::TestEnsureLoader::test_ensure_loader_session_not_found PASSED [ 27%]
tests/test_service_monitoring.py::TestEnsureLoader::test_ensure_loader_missing_session_file PASSED [ 27%]
tests/test_service_monitoring.py::TestEnableMonitoring::test_enable_monitoring_session_not_found PASSED [ 28%]
tests/test_session.py::TestSessionData::test_creation PASSED             [ 28%]
tests/test_session.py::TestSessionData::test_get_missing_key PASSED      [ 28%]
tests/test_session.py::TestSessionData::test_get_existing_key PASSED     [ 29%]
tests/test_session.py::TestSessionData::test_set PASSED                  [ 29%]
tests/test_session.py::TestSessionData::test_delete PASSED               [ 29%]
tests/test_session.py::TestSessionData::test_delete_missing_key PASSED   [ 30%]
tests/test_session.py::TestSessionData::test_clear PASSED                [ 30%]
tests/test_session.py::TestSessionData::test_touch PASSED                [ 30%]
tests/test_session.py::TestSessionData::test_is_expired_false PASSED     [ 31%]
tests/test_session.py::TestSessionData::test_is_expired_true PASSED      [ 31%]
tests/test_session.py::TestSessionData::test_is_expired_custom_ttl PASSED [ 31%]
tests/test_session.py::TestSessionStore::test_create_session PASSED      [ 32%]
tests/test_session.py::TestSessionStore::test_create_session_unique_ids PASSED [ 32%]
tests/test_session.py::TestSessionStore::test_get_session_existing PASSED [ 32%]
tests/test_session.py::TestSessionStore::test_get_session_touches PASSED [ 33%]
tests/test_session.py::TestSessionStore::test_get_session_missing PASSED [ 33%]
tests/test_session.py::TestSessionStore::test_get_session_beyond_ttl PASSED [ 33%]
tests/test_session.py::TestSessionStore::test_delete_session PASSED      [ 34%]
tests/test_session.py::TestSessionStore::test_delete_session_missing PASSED [ 34%]
tests/test_session.py::TestSessionStore::test_cleanup_expired PASSED     [ 34%]
tests/test_session.py::TestSessionStore::test_get_session_count PASSED   [ 35%]
tests/test_session.py::TestSessionStore::test_thread_safety PASSED       [ 35%]
tests/test_session.py::TestGetSessionStore::test_returns_store PASSED    [ 35%]
tests/test_session.py::TestGetSessionStore::test_singleton PASSED        [ 36%]
tests/test_session.py::TestGetSession::test_creates_new_session PASSED   [ 36%]
tests/test_session.py::TestGetSession::test_returns_existing_session_from_state PASSED [ 36%]
tests/test_session.py::TestGetSession::test_returns_session_from_cookie PASSED [ 36%]
tests/test_session.py::TestGetSession::test_creates_new_if_cookie_invalid PASSED [ 37%]
tests/test_session.py::TestGetSession::test_attaches_to_request_state PASSED [ 37%]
tests/test_session.py::TestSetSessionCookie::test_sets_cookie PASSED     [ 37%]
tests/test_session.py::TestSetSessionCookie::test_cookie_security_settings PASSED [ 38%]
tests/test_session.py::TestDeleteSessionCookie::test_deletes_cookie PASSED [ 38%]
tests/test_session.py::TestSessionIntegration::test_full_session_lifecycle PASSED [ 38%]
tests/test_session.py::TestSessionIntegration::test_multiple_independent_sessions PASSED [ 39%]
tests/test_session_manager.py::TestSessionManagerRegistration::test_register_session PASSED [ 39%]
tests/test_session_manager.py::TestSessionManagerRegistration::test_list_sessions_empty PASSED [ 39%]
tests/test_session_manager.py::TestSessionManagerRegistration::test_unregister_session PASSED [ 40%]
tests/test_session_manager.py::TestSessionManagerConnect::test_connect_success PASSED [ 40%]
tests/test_session_manager.py::TestSessionManagerConnect::test_connect_already_connected PASSED [ 40%]
tests/test_session_manager.py::TestSessionManagerConnect::test_connect_failure PASSED [ 41%]
tests/test_session_manager.py::TestSessionManagerConnect::test_connect_timeout PASSED [ 41%]
tests/test_session_manager.py::TestSessionManagerConnect::test_connect_unregistered_session PASSED [ 41%]
tests/test_session_manager.py::TestSessionManagerDisconnect::test_disconnect_connected_session PASSED [ 42%]
tests/test_session_manager.py::TestSessionManagerDisconnect::test_disconnect_not_connected PASSED [ 42%]
tests/test_session_manager.py::TestSessionManagerDisconnect::test_disconnect_nonexistent PASSED [ 42%]
tests/test_session_manager.py::TestSessionManagerDisconnect::test_disconnect_all PASSED [ 43%]
tests/test_session_manager.py::TestSessionManagerContextManager::test_context_manager_auto_disconnect PASSED [ 43%]
tests/test_session_manager.py::TestSessionManagerContextManager::test_context_manager_no_auto_disconnect PASSED [ 43%]
tests/test_session_manager.py::TestSessionManagerContextManager::test_context_manager_exception_still_disconnects PASSED [ 44%]
tests/test_session_manager.py::TestSessionManagerHealthCheck::test_is_healthy_connected PASSED [ 44%]
tests/test_session_manager.py::TestSessionManagerHealthCheck::test_is_healthy_not_connected PASSED [ 44%]
tests/test_session_manager.py::TestSessionManagerHealthCheck::test_is_healthy_nonexistent PASSED [ 45%]
tests/test_session_manager.py::TestSessionManagerInfo::test_get_info_registered_not_connected PASSED [ 45%]
tests/test_session_manager.py::TestSessionManagerInfo::test_get_info_connected PASSED [ 45%]
tests/test_session_manager.py::TestSessionManagerInfo::test_get_info_nonexistent PASSED [ 45%]
tests/test_session_manager.py::TestSessionManagerLocking::test_concurrent_connects_rejected PASSED [ 46%]
tests/test_session_manager.py::TestSessionManagerLocking::test_unregister_connected_raises PASSED [ 46%]
tests/test_session_manager.py::TestSessionAuthErrors::test_connect_session_revoked_error PASSED [ 46%]
tests/test_session_manager.py::TestSessionAuthErrors::test_connect_auth_key_unregistered_error PASSED [ 47%]
tests/test_session_manager.py::TestSessionAuthErrors::test_connect_phone_banned_error PASSED [ 47%]
tests/test_session_manager.py::TestSessionAuthErrors::test_connect_user_deactivated_ban_error PASSED [ 47%]
tests/test_session_manager.py::TestSessionAuthErrors::test_connect_session_password_needed_error PASSED [ 48%]
tests/test_session_manager.py::TestSessionAuthErrors::test_connect_telethon_auth_expiry_error PASSED [ 48%]
tests/test_session_manager.py::TestSessionAuthErrors::test_invalid_session_state_and_error_message PASSED [ 48%]
tests/test_session_manager.py::TestSessionAuthErrors::test_reauth_required_state_and_error_message PASSED [ 49%]
tests/test_session_manager.py::TestNetworkSwitchHandling::test_is_network_switch_error_broken_pipe PASSED [ 49%]
tests/test_session_manager.py::TestNetworkSwitchHandling::test_is_network_switch_error_connection_reset PASSED [ 49%]
tests/test_session_manager.py::TestNetworkSwitchHandling::test_is_network_switch_error_connection_aborted PASSED [ 50%]
tests/test_session_manager.py::TestNetworkSwitchHandling::test_is_network_switch_error_oserror_with_errno PASSED [ 50%]
tests/test_session_manager.py::TestNetworkSwitchHandling::test_is_network_switch_error_oserror_by_message PASSED [ 50%]
tests/test_session_manager.py::TestNetworkSwitchHandling::test_is_network_switch_error_regular_error PASSED [ 51%]
tests/test_session_manager.py::TestNetworkSwitchHandling::test_handle_network_switch_reconnects PASSED [ 51%]
tests/test_session_manager.py::TestNetworkSwitchHandling::test_handle_network_switch_sets_recovery_flag PASSED [ 51%]
tests/test_session_manager.py::TestNetworkSwitchHandling::test_handle_network_switch_resets_error_tracking PASSED [ 52%]
tests/test_session_manager.py::TestNetworkSwitchHandling::test_network_error_tracking_in_info PASSED [ 52%]
tests/test_session_manager.py::TestNetworkSwitchHandling::test_health_check_clears_old_network_errors PASSED [ 52%]
tests/test_session_manager.py::TestNetworkSwitchIntegration::test_health_check_detects_and_recovers_from_network_switch PASSED [ 53%]
tests/test_session_manager.py::TestDeadSessionRecoveryFlow::test_dead_session_shows_expired_error_message PASSED [ 53%]
tests/test_session_manager.py::TestDeadSessionRecoveryFlow::test_dead_session_revoked_shows_distinct_status PASSED [ 53%]
tests/test_session_manager.py::TestDeadSessionRecoveryFlow::test_dead_session_banned_account_shows_permanent_status PASSED [ 54%]
tests/test_session_manager.py::TestDeadSessionRecoveryFlow::test_temporary_error_vs_permanent_session_death PASSED [ 54%]
tests/test_session_manager.py::TestDeadSessionRecoveryFlow::test_session_recovery_preserves_session_id PASSED [ 54%]
tests/test_session_manager.py::TestDeadSessionRecoveryFlow::test_reauth_required_error_is_recoverable PASSED [ 54%]
tests/test_session_manager.py::TestDeadSessionRecoveryFlow::test_reconnect_flow_same_session_id PASSED [ 55%]
tests/test_session_manager.py::TestAuthKeyUnregisteredAutoRecovery::test_connect_authkey_unregistered_auto_delete PASSED [ 55%]
tests/test_session_manager.py::TestAuthKeyUnregisteredAutoRecovery::test_session_file_deletion_signaled_for_authkey_unregistered PASSED [ 55%]
tests/test_session_manager.py::TestAuthKeyUnregisteredAutoRecovery::test_reregister_after_authkey_unregistered_allows_recovery PASSED [ 56%]
tests/test_session_manager.py::TestAuthKeyUnregisteredAutoRecovery::test_authkey_unregistered_vs_other_auth_errors PASSED [ 56%]
tests/test_session_recovery.py::test_authkey_unregistered_triggers_recovery PASSED [ 56%]
tests/test_session_recovery.py::test_session_revoked_triggers_recovery PASSED [ 57%]
tests/test_session_recovery.py::test_session_expired_triggers_recovery PASSED [ 57%]
tests/test_session_recovery.py::test_corrupted_session_file_triggers_recovery PASSED [ 57%]
tests/test_session_recovery.py::test_recovery_without_phone_publishes_error PASSED [ 58%]
tests/test_sessions_router.py::TestReadUploadWithSizeLimit::test_read_small_file PASSED [ 58%]
tests/test_sessions_router.py::TestReadUploadWithSizeLimit::test_read_file_exceeds_limit PASSED [ 58%]
tests/test_sessions_router.py::TestReadUploadWithSizeLimit::test_read_exact_limit PASSED [ 59%]
tests/test_sessions_router.py::TestReadUploadWithSizeLimit::test_read_chunked_file PASSED [ 59%]
tests/test_sessions_router.py::TestSanitizeSessionName::test_valid_name_alphanumeric PASSED [ 59%]
tests/test_sessions_router.py::TestSanitizeSessionName::test_valid_name_with_underscore PASSED [ 60%]
tests/test_sessions_router.py::TestSanitizeSessionName::test_valid_name_with_hyphen PASSED [ 60%]
tests/test_sessions_router.py::TestSanitizeSessionName::test_removes_path_traversal PASSED [ 60%]
tests/test_sessions_router.py::TestSanitizeSessionName::test_removes_special_characters PASSED [ 61%]
tests/test_sessions_router.py::TestSanitizeSessionName::test_empty_after_sanitization_raises PASSED [ 61%]
tests/test_sessions_router.py::TestSanitizeSessionName::test_truncates_long_name PASSED [ 61%]
tests/test_sessions_router.py::TestValidateSessionFileFormat::test_valid_session_file PASSED [ 62%]
tests/test_sessions_router.py::TestValidateSessionFileFormat::test_invalid_not_sqlite PASSED [ 62%]
tests/test_sessions_router.py::TestValidateSessionFileFormat::test_invalid_missing_sessions_table PASSED [ 62%]
tests/test_sessions_router.py::TestValidateSessionFileFormat::test_invalid_empty_sessions PASSED [ 63%]
tests/test_sessions_router.py::TestValidateSessionFileFormat::test_telethon_2x_session_rejected PASSED [ 63%]
tests/test_sessions_router.py::TestValidateSessionFileFormat::test_valid_telethon_1x_session PASSED [ 63%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_valid_config PASSED [ 63%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_valid_config_api_id_as_string PASSED [ 64%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_invalid_json PASSED [ 64%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_missing_api_id PASSED [ 64%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_missing_api_hash PASSED [ 65%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_invalid_api_id_type PASSED [ 65%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_empty_api_hash PASSED [ 65%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_empty_config_file PASSED [ 66%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_whitespace_only_config PASSED [ 66%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_not_json_object_array PASSED [ 66%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_not_json_object_string PASSED [ 67%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_invalid_utf8 PASSED [ 67%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_unknown_fields_lenient PASSED [ 67%]
tests/test_sessions_router.py::TestValidateConfigFileFormat::test_no_warning_for_known_fields_only PASSED [ 68%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_get_sessions_empty PASSED [ 68%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_home_page_loads PASSED [ 68%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_upload_session_invalid_name PASSED [ 69%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_upload_session_invalid_session_file PASSED [ 69%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_upload_session_invalid_config PASSED [ 69%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_delete_session_not_found PASSED [ 70%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_delete_session_invalid_name PASSED [ 70%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_upload_config_file_too_large PASSED [ 70%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_upload_session_file_too_large PASSED [ 71%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_upload_session_with_json_file PASSED [ 71%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_upload_session_json_invalid PASSED [ 71%]
tests/test_sessions_router.py::TestSessionsAPIEndpoints::test_upload_session_json_with_2fa PASSED [ 72%]
tests/test_sessions_router.py::TestMigrateLegacySessions::test_migrate_legacy_session_creates_config PASSED [ 72%]
tests/test_sessions_router.py::TestMigrateLegacySessions::test_migrate_skips_already_migrated PASSED [ 72%]
tests/test_sessions_router.py::TestMigrateLegacySessions::test_migrate_handles_missing_credentials PASSED [ 72%]
tests/test_sessions_router.py::TestMigrateLegacySessions::test_migrate_skips_non_session_directories PASSED [ 73%]
tests/test_sessions_router.py::TestSessionConfigAPI::test_get_session_config_success PASSED [ 73%]
tests/test_sessions_router.py::TestSessionConfigAPI::test_get_session_config_not_found PASSED [ 73%]
tests/test_sessions_router.py::TestSessionConfigAPI::test_get_session_config_invalid_name PASSED [ 74%]
tests/test_sessions_router.py::TestSessionConfigAPI::test_update_session_config_success PASSED [ 74%]
tests/test_sessions_router.py::TestSessionConfigAPI::test_update_session_config_proxy_required PASSED [ 74%]
tests/test_sessions_router.py::TestSessionConfigAPI::test_update_session_config_proxy_not_found PASSED [ 75%]
tests/test_sessions_router.py::TestSessionConfigAPI::test_update_session_config_session_not_found PASSED [ 75%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_not_found PASSED [ 75%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_invalid_name PASSED [ 76%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_not_configured PASSED [ 76%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_proxy_missing PASSED [ 76%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_success PASSED [ 77%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_failure PASSED [ 77%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_concurrent_request_returns_connecting PASSED [ 77%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_timeout_returns_connecting PASSED [ 78%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_missing_session_file PASSED [ 78%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_connect_session_invalid_session_auto_reauth PASSED [ 78%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_disconnect_session_invalid_name PASSED [ 79%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_disconnect_session_success PASSED [ 79%]
tests/test_sessions_router.py::TestSessionConnectDisconnectAPI::test_disconnect_session_not_connected PASSED [ 79%]
tests/test_sessions_router.py::TestDeadSessionRecoveryUX::test_dead_session_returns_connecting_state PASSED [ 80%]
tests/test_sessions_router.py::TestDeadSessionRecoveryUX::test_expired_session_connect_returns_connecting PASSED [ 80%]
tests/test_sessions_router.py::TestDeadSessionRecoveryUX::test_session_recovery_preserves_session_id PASSED [ 80%]
tests/test_sessions_router.py::TestDeadSessionRecoveryUX::test_temporary_error_vs_permanent_session_death_ui PASSED [ 81%]
tests/test_sessions_router.py::TestAPICredentialReValidation::test_change_api_id_triggers_disconnect_and_reauth PASSED [ 81%]
tests/test_sessions_router.py::TestAPICredentialReValidation::test_invalid_api_id_rejected_not_saved PASSED [ 81%]
tests/test_sessions_router.py::TestAPICredentialReValidation::test_valid_credentials_needing_auth_triggers_reconnect PASSED [ 81%]
tests/test_sessions_router.py::TestAPICredentialReValidation::test_credentials_not_saved_before_validation_success PASSED [ 82%]
tests/test_sessions_router.py::TestAPICredentialReValidation::test_network_error_during_validation_shows_proxy_error PASSED [ 82%]
tests/test_sessions_router.py::TestVerify2FA::test_password_validation_logic PASSED [ 82%]
tests/test_sessions_router.py::TestVerify2FA::test_verify_code_2fa_auto_fails_shows_manual_modal PASSED [ 83%]
tests/test_sessions_router.py::TestBackwardCompatibilityLegacySessions::test_list_stored_sessions_without_session_file PASSED [ 83%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_valid_json_minimal PASSED [ 83%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_valid_json_all_fields PASSED [ 84%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_valid_phone_without_plus PASSED [ 84%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_not_dict PASSED [ 84%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_unknown_fields PASSED [ 85%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_nested_object PASSED [ 85%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_nested_array PASSED [ 85%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_missing_phone PASSED [ 86%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_empty_phone PASSED [ 86%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_phone_format_letters PASSED [ 86%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_phone_too_short PASSED [ 87%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_phone_too_long PASSED [ 87%]
tests/test_sessions_router.py::TestValidateAccountInfoJson::test_invalid_phone_leading_zero PASSED [ 87%]
tests/test_sessions_router.py::TestVerifyCode2FAAutoEntry::test_verify_code_auto_2fa_success PASSED [ 88%]
tests/test_sessions_router.py::TestVerifyCode2FAAutoEntry::test_verify_code_auto_2fa_missing PASSED [ 88%]
tests/test_sessions_router.py::TestVerifyCode2FAAutoEntry::test_verify_code_auto_2fa_wrong PASSED [ 88%]
tests/test_sessions_router.py::TestSessionImport::test_validate_import_session_success PASSED [ 89%]
tests/test_sessions_router.py::TestSessionImport::test_validate_import_session_invalid_json_missing_phone PASSED [ 89%]
tests/test_sessions_router.py::TestSessionImport::test_validate_import_session_invalid_phone_format PASSED [ 89%]
tests/test_sessions_router.py::TestSessionImport::test_save_import_session_success PASSED [ 90%]
tests/test_sessions_router.py::TestSessionImport::test_save_import_session_duplicate_name PASSED [ 90%]
tests/test_startup_smoke.py::test_app_startup_and_sessions_endpoint PASSED [ 90%]
tests/test_storage.py::TestFileStorage::test_cleanup_old_session_files PASSED [ 90%]
tests/test_storage.py::TestFileStorage::test_cleanup_old_session_files_with_config PASSED [ 91%]
tests/test_storage.py::TestFileStorage::test_cleanup_old_session_files_nonexistent_dir PASSED [ 91%]
tests/test_storage.py::TestFileStorage::test_cleanup_old_session_files_empty_dir PASSED [ 91%]
tests/test_storage.py::TestFileStorage::test_cleanup_old_session_files_no_sessions_old_enough PASSED [ 92%]
tests/test_task_queue.py::TestTaskQueue::test_find_active_task_no_match_different_session PASSED [ 92%]
tests/test_telegram_client.py::TestValidateSessionFile::test_valid_session PASSED [ 92%]
tests/test_telegram_client.py::TestValidateSessionFile::test_session_not_found PASSED [ 93%]
tests/test_telegram_client.py::TestValidateSessionFile::test_invalid_file_not_sqlite PASSED [ 93%]
tests/test_telegram_client.py::TestValidateSessionFile::test_empty_session_no_data PASSED [ 93%]
tests/test_telegram_client.py::TestValidateSessionFile::test_missing_required_tables PASSED [ 94%]
tests/test_telegram_client.py::TestValidateSessionFile::test_locked_session_file PASSED [ 94%]
tests/test_telegram_client.py::TestValidateSessionFile::test_telethon_2x_session_detected PASSED [ 94%]
tests/test_telegram_client.py::TestTelegramClientLoader::test_validate_invalid_session PASSED [ 95%]
tests/test_telethon_api_contract.py::TestTelethonSessionFileContract::test_telethon_1x_session_schema PASSED [ 95%]
tests/test_telethon_api_contract.py::TestTelethonSessionFileContract::test_telethon_2x_session_detection PASSED [ 95%]
tests/web/test_sessions.py::TestGetSessionConfigStatus::test_encrypted_credentials_with_proxy PASSED [ 96%]
tests/web/test_sessions.py::TestGetSessionConfigStatus::test_encrypted_credentials_missing PASSED [ 96%]
tests/web/test_sessions.py::TestGetSessionConfigStatus::test_plaintext_credentials_backward_compatibility PASSED [ 96%]
tests/web/test_sessions.py::TestGetSessionConfigStatus::test_missing_config_file PASSED [ 97%]
tests/web/test_sessions.py::TestGetSessionConfigStatus::test_corrupted_config_file PASSED [ 97%]
tests/web/test_sessions.py::TestGetSessionConfigStatus::test_missing_proxy_id PASSED [ 97%]
tests/web/test_sessions.py::TestGetSessionConfigStatus::test_proxy_not_found_in_pool PASSED [ 98%]
tests/web/test_sessions.py::TestGetSessionConfigStatus::test_encrypted_credentials_check_error_handling PASSED [ 98%]
tests/web/test_sessions.py::TestGetSessionConfigStatus::test_encrypted_credentials_with_only_api_id_null PASSED [ 98%]
tests/web/test_sessions.py::TestGetSessionConfigStatus::test_encrypted_credentials_with_only_api_hash_null PASSED [ 99%]
tests/web/test_sessions.py::TestConnectSessionErrorHandling::test_connect_session_publishes_error_when_phone_missing PASSED [ 99%]
tests/web/test_sessions.py::TestConnectSessionErrorHandling::test_connect_session_publishes_error_when_proxy_fails PASSED [ 99%]
tests/web/test_sessions.py::TestConnectSessionErrorHandling::test_connect_session_publishes_error_when_network_unavailable PASSED [100%]

=============================== warnings summary ===============================
src/chatfilter/self_test.py:31
  /Users/m/Zen/Code/ChatFilter/src/chatfilter/self_test.py:31: PytestCollectionWarning: cannot collect test class 'TestResult' because it has a __init__ constructor (from: tests/test_self_test.py)
    @dataclass

src/chatfilter/self_test.py:22
  /Users/m/Zen/Code/ChatFilter/src/chatfilter/self_test.py:22: PytestCollectionWarning: cannot collect test class 'TestStatus' because it has a __init__ constructor (from: tests/test_self_test.py)
    class TestStatus(str, Enum):

tests/test_sessions_router.py::TestSessionConfigAPI::test_update_session_config_proxy_required
  /Users/m/Zen/Code/ChatFilter/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py:59: DeprecationWarning: 'HTTP_422_UNPROCESSABLE_ENTITY' is deprecated. Use 'HTTP_422_UNPROCESSABLE_CONTENT' instead.
    response = await handler(conn, exc)

tests/test_sessions_router.py::TestAPICredentialReValidation::test_invalid_api_id_rejected_not_saved
tests/test_sessions_router.py::TestAPICredentialReValidation::test_credentials_not_saved_before_validation_success
  /Users/m/Zen/Code/ChatFilter/src/chatfilter/web/routers/sessions.py:993: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    if client and client.is_connected():
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_sessions_router.py::TestAPICredentialReValidation::test_network_error_during_validation_shows_proxy_error
  /Users/m/Zen/Code/ChatFilter/src/chatfilter/web/routers/sessions.py:1002: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    if client and client.is_connected():
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
============== 311 passed, 1643 deselected, 6 warnings in 24.37s ===============
