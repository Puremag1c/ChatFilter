============================= test session starts ==============================
platform darwin -- Python 3.12.11, pytest-9.0.2, pluggy-1.6.0 -- /Users/m/Zen/Code/ChatFilter/.venv/bin/python
cachedir: .pytest_cache
hypothesis profile 'default'
rootdir: /Users/m/Zen/Code/ChatFilter
configfile: pyproject.toml
plugins: anyio-4.12.1, timeout-2.4.0, asyncio-1.3.0, hypothesis-6.151.5
timeout: 30.0s
timeout method: signal
timeout func_only: False
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 1 item

tests/test_connect_flow_states.py::TestConnectFlowCodeVerification::test_needs_code_to_connected_success FAILED

=================================== FAILURES ===================================
_____ TestConnectFlowCodeVerification.test_needs_code_to_connected_success _____
tests/test_connect_flow_states.py:309: in test_needs_code_to_connected_success
    assert any(
E   assert False
E    +  where False = any(<generator object TestConnectFlowCodeVerification.test_needs_code_to_connected_success.<locals>.<genexpr> at 0x10df328e0>)
------------------------------ Captured log call -------------------------------
ERROR    chatfilter.web.routers.sessions:sessions.py:3123 CRITICAL: adopt_client failed for 'test_session': object MagicMock can't be used in 'await' expression. Client is orphaned. Cleaning up connection and auth state.
ERROR    chatfilter.web.routers.sessions:sessions.py:4419 Failed to verify code for session 'test_session'
Traceback (most recent call last):
  File "/Users/m/Zen/Code/ChatFilter/src/chatfilter/web/routers/sessions.py", line 4134, in verify_code
    await _finalize_reconnect_auth(
  File "/Users/m/Zen/Code/ChatFilter/src/chatfilter/web/routers/sessions.py", line 3118, in _finalize_reconnect_auth
    await session_manager.adopt_client(safe_name, client)
TypeError: object MagicMock can't be used in 'await' expression
=========================== short test summary info ============================
FAILED tests/test_connect_flow_states.py::TestConnectFlowCodeVerification::test_needs_code_to_connected_success - assert False
 +  where False = any(<generator object TestConnectFlowCodeVerification.test_needs_code_to_connected_success.<locals>.<genexpr> at 0x10df328e0>)
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
============================== 1 failed in 0.75s ===============================
