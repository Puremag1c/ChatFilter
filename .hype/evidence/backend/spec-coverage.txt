# SPEC.md Coverage Analysis

## Must Have Requirements vs Tests

### 1. Save ≠ Connect (P0)
- Requirement: "Save" ONLY saves data, doesn't connect
- Test Coverage: NO DIRECT TEST FOUND
  - Need test: test_save_account_without_api_id_no_connect()
  - Need test: test_save_account_creates_disconnected_status()

### 2. Removed session_expired state (P0)
- Requirement: No session_expired state, auto-handle expired sessions
- Test Coverage: ✓ PARTIAL
  - tests/test_connect_flow_states.py::test_expired_session_auto_recovery ✓
  - Need test: verify templates don't have session_expired references

### 3. Removed corrupted_session state (P0)  
- Requirement: Auto-delete corrupted session, re-send code
- Test Coverage: NO DIRECT TEST FOUND
  - Need test: test_corrupted_session_auto_recovery()

### 4. Simplified Connect flow (P0)
- Requirement: 8-state model, handle all edge cases
- Test Coverage: ✓ GOOD
  - test_disconnected_to_needs_config_no_api_id ✓
  - test_disconnected_to_needs_config_no_proxy ✓
  - test_disconnected_to_needs_code_first_time ✓
  - test_needs_code_to_connected_success ✗ (FAILING - missing mocks)
  - test_needs_code_to_needs_2fa ✗ (FAILING - missing mocks)
  - test_needs_2fa_to_connected_success ✗ (FAILING - missing mocks)
  - test_banned_terminal_state ✓
  - test_error_to_recovery_via_retry ✓
  - test_expired_session_auto_recovery ✓

### 5. Final 8 states (P0)
- Requirement: Only 8 states exist in code/templates/i18n
- Test Coverage: ✓ PARTIAL
  - test_all_8_states_covered ✓
  - Need test: grep templates for removed states
  - Need test: grep i18n for removed states

## Test Coverage Gaps

### High Priority (P0)
1. test_save_without_connect() - verify Save doesn't call Telethon
2. test_corrupted_session_recovery() - verify auto-delete + re-send code
3. Fix 3 failing mock tests (add missing dependency mocks)

### Medium Priority (P1)  
4. test_template_states() - verify templates use only 8 states
5. test_i18n_states() - verify translations use only 8 states
6. test_banned_account_types() - test banned/frozen/deactivated all map to "banned"

### Low Priority (P2)
7. test_proxy_error_classification() - verify proxy errors → needs_config
8. test_flood_wait_error_classification() - verify flood wait → error with tooltip
